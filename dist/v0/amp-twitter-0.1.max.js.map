{"version":3,"sources":["node_modules/browserify/node_modules/browser-pack/_prelude.js","build/all/v0/amp-twitter-0.1.max.js","node_modules/browserify/node_modules/process/browser.js","src/3p-frame.js","src/asserts.js","src/document-info.js","src/event-helper.js","src/layout.js","src/mode.js","src/platform.js","src/preconnect.js","src/service.js","src/string.js","src/timer.js","src/url.js"],"names":[],"mappings":"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","file":"amp-twitter-0.1.max.js","sourceRoot":"/source/","sourcesContent":["(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require==\"function\"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error(\"Cannot find module '\"+o+\"'\");throw f.code=\"MODULE_NOT_FOUND\",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require==\"function\"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})","/**\n * Copyright 2015 The AMP HTML Authors. All Rights Reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS-IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n\nimport {getIframe, listen, prefetchBootstrap} from '../../../src/3p-frame';\nimport {isLayoutSizeDefined} from '../../../src/layout';\nimport {loadPromise} from '../../../src/event-helper';\n\n\nclass AmpTwitter extends AMP.BaseElement {\n  /** @override */\n  preconnectCallback(onLayout) {\n    // This domain serves the actual tweets as JSONP.\n    this.preconnect.url('https://syndication.twitter.com', onLayout);\n    // Hosts the script that renders tweets.\n    this.preconnect.prefetch('https://platform.twitter.com/widgets.js');\n    prefetchBootstrap(this.getWin());\n  }\n\n  /** @override */\n  isLayoutSupported(layout) {\n    return isLayoutSizeDefined(layout);\n  }\n\n  /** @override */\n  layoutCallback() {\n    // TODO(malteubl): Preconnect to twitter.\n    const iframe = getIframe(this.element.ownerDocument.defaultView,\n        this.element, 'twitter');\n    this.applyFillContent(iframe);\n    this.element.appendChild(iframe);\n    // Triggered by context.updateDimensions() inside the iframe.\n    listen(iframe, 'embed-size', data => {\n      iframe.height = data.height;\n      iframe.width = data.width;\n      const amp = iframe.parentElement;\n      amp.setAttribute('height', data.height);\n      amp.setAttribute('width', data.width);\n      this./*OK*/changeHeight(data.height);\n    });\n    return loadPromise(iframe);\n  }\n};\n\nAMP.registerElement('amp-twitter', AmpTwitter);\n","// shim for using process in browser\n\nvar process = module.exports = {};\nvar queue = [];\nvar draining = false;\nvar currentQueue;\nvar queueIndex = -1;\n\nfunction cleanUpNextTick() {\n    draining = false;\n    if (currentQueue.length) {\n        queue = currentQueue.concat(queue);\n    } else {\n        queueIndex = -1;\n    }\n    if (queue.length) {\n        drainQueue();\n    }\n}\n\nfunction drainQueue() {\n    if (draining) {\n        return;\n    }\n    var timeout = setTimeout(cleanUpNextTick);\n    draining = true;\n\n    var len = queue.length;\n    while(len) {\n        currentQueue = queue;\n        queue = [];\n        while (++queueIndex < len) {\n            if (currentQueue) {\n                currentQueue[queueIndex].run();\n            }\n        }\n        queueIndex = -1;\n        len = queue.length;\n    }\n    currentQueue = null;\n    draining = false;\n    clearTimeout(timeout);\n}\n\nprocess.nextTick = function (fun) {\n    var args = new Array(arguments.length - 1);\n    if (arguments.length > 1) {\n        for (var i = 1; i < arguments.length; i++) {\n            args[i - 1] = arguments[i];\n        }\n    }\n    queue.push(new Item(fun, args));\n    if (queue.length === 1 && !draining) {\n        setTimeout(drainQueue, 0);\n    }\n};\n\n// v8 likes predictible objects\nfunction Item(fun, array) {\n    this.fun = fun;\n    this.array = array;\n}\nItem.prototype.run = function () {\n    this.fun.apply(null, this.array);\n};\nprocess.title = 'browser';\nprocess.browser = true;\nprocess.env = {};\nprocess.argv = [];\nprocess.version = ''; // empty string to avoid regexp issues\nprocess.versions = {};\n\nfunction noop() {}\n\nprocess.on = noop;\nprocess.addListener = noop;\nprocess.once = noop;\nprocess.off = noop;\nprocess.removeListener = noop;\nprocess.removeAllListeners = noop;\nprocess.emit = noop;\n\nprocess.binding = function (name) {\n    throw new Error('process.binding is not supported');\n};\n\nprocess.cwd = function () { return '/' };\nprocess.chdir = function (dir) {\n    throw new Error('process.chdir is not supported');\n};\nprocess.umask = function() { return 0; };\n","/**\n * Copyright 2015 The AMP HTML Authors. All Rights Reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS-IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n\nimport {assert} from './asserts';\nimport {getLengthNumeral} from '../src/layout';\nimport {getService} from './service';\nimport {documentInfoFor} from './document-info';\nimport {getMode} from './mode';\nimport {preconnectFor} from './preconnect';\nimport {dashToCamelCase} from './string';\nimport {parseUrl, assertHttpsUrl} from './url';\n\n\n/** @type {!Object<string,number>} Number of 3p frames on the for that type. */\nconst count = {};\n\n\n/**\n * Produces the attributes for the ad template.\n * @param {!Window} parentWindow\n * @param {!Element} element\n * @param {string=} opt_type\n * @return {!Object} Contains\n *     - type, width, height, src attributes of <amp-ad> tag. These have\n *       precedence over the data- attributes.\n *     - data-* attributes of the <amp-ad> tag with the \"data-\" removed.\n *     - A _context object for internal use.\n */\nfunction getFrameAttributes(parentWindow, element, opt_type) {\n  const width = element.getAttribute('width');\n  const height = element.getAttribute('height');\n  const type = opt_type || element.getAttribute('type');\n  assert(type, 'Attribute type required for <amp-ad>: %s', element);\n  const attributes = {};\n  // Do these first, as the other attributes have precedence.\n  addDataAndJsonAttributes_(element, attributes);\n  attributes.width = getLengthNumeral(width);\n  attributes.height = getLengthNumeral(height);\n  const box = element.getLayoutBox();\n  attributes.initialWindowWidth = box.width;\n  attributes.initialWindowHeight = box.height;\n  attributes.type = type;\n  const docInfo = documentInfoFor(parentWindow);\n  attributes._context = {\n    referrer: parentWindow.document.referrer,\n    canonicalUrl: docInfo.canonicalUrl,\n    pageViewId: docInfo.pageViewId,\n    location: {\n      href: parentWindow.location.href\n    },\n    mode: getMode()\n  };\n  const adSrc = element.getAttribute('src');\n  if (adSrc) {\n    attributes.src = adSrc;\n  }\n  return attributes;\n}\n\n/**\n * Creates the iframe for the embed. Applies correct size and passes the embed\n * attributes to the frame via JSON inside the fragment.\n * @param {!Window} parentWindow\n * @param {!Element} element\n * @param {string=} opt_type\n * @return {!Element} The iframe.\n */\nexport function getIframe(parentWindow, element, opt_type) {\n  const attributes = getFrameAttributes(parentWindow, element, opt_type);\n  const iframe = document.createElement('iframe');\n  if (!count[attributes.type]) {\n    count[attributes.type] = 0;\n  }\n  iframe.name = 'frame_' + attributes.type + '_' + count[attributes.type]++;\n\n  // Pass ad attributes to iframe via the fragment.\n  const src = getBootstrapBaseUrl(parentWindow) + '#' +\n      JSON.stringify(attributes);\n\n  iframe.src = src;\n  iframe.ampLocation = parseUrl(src);\n  iframe.width = attributes.width;\n  iframe.height = attributes.height;\n  iframe.style.border = 'none';\n  iframe.setAttribute('scrolling', 'no');\n  iframe.onload = function() {\n    // Chrome does not reflect the iframe readystate.\n    this.readyState = 'complete';\n  };\n  return iframe;\n}\n\n/**\n * Allows listening for message from the iframe. Returns an unlisten\n * function to remove the listener.\n *\n * @param {!Element} iframe\n * @param {string} typeOfMessage\n * @param {function(!Object)} callback Called when a message of this type\n *     arrives for this iframe.\n * @return {!UnlistenDef}\n */\nexport function listen(iframe, typeOfMessage, callback) {\n  const win = iframe.ownerDocument.defaultView;\n  const origin = iframe.ampLocation.origin;\n  const listener = function(event) {\n    if (event.origin != origin) {\n      return;\n    }\n    if (event.source != iframe.contentWindow) {\n      return;\n    }\n    if (!event.data || event.data.sentinel != 'amp-3p') {\n      return;\n    }\n    if (event.data.type != typeOfMessage) {\n      return;\n    }\n    callback(event.data);\n  };\n\n  win.addEventListener('message', listener);\n\n  return function() {\n    win.removeEventListener('message', listener);\n  };\n}\n\n/**\n * Allows listening for a message from the iframe and then removes the listener\n *\n * @param {!Element} iframe\n * @param {string} typeOfMessage\n * @param {function(!Object)} callback Called when a message of this type\n *     arrives for this iframe.\n * @return {!UnlistenDef}\n */\nexport function listenOnce(iframe, typeOfMessage, callback) {\n  const unlisten = listen(iframe, typeOfMessage, data => {\n    unlisten();\n    return callback(data);\n  });\n  return unlisten;\n}\n\n/**\n * Posts a message to the iframe;\n * @param {!Element} element The 3p iframe.\n * @param {string} type Type of the message.\n * @param {!Object} object Message payload.\n */\nexport function postMessage(iframe, type, object) {\n  object.type = type;\n  object.sentinel = 'amp-3p';\n  iframe.contentWindow./*OK*/postMessage(object, iframe.ampLocation.origin);\n}\n\n/**\n * Copies data- attributes from the element into the attributes object.\n * Removes the data- from the name and capitalizes after -. If there\n * is an attribute called json, parses the JSON and adds it to the\n * attributes.\n * @param {!Element} element\n * @param {!Object} attributes The destination.\n * visibleForTesting\n */\nexport function addDataAndJsonAttributes_(element, attributes) {\n  for (let i = 0; i < element.attributes.length; i++) {\n    const attr = element.attributes[i];\n    if (attr.name.indexOf('data-') != 0) {\n      continue;\n    }\n    attributes[dashToCamelCase(attr.name.substr(5))] = attr.value;\n  }\n  const json = element.getAttribute('json');\n  if (json) {\n    let obj;\n    try {\n      obj = JSON.parse(json);\n    } catch (e) {\n      assert(false, 'Error parsing JSON in json attribute in element %s',\n          element);\n    }\n    for (const key in obj) {\n      attributes[key] = obj[key];\n    }\n  }\n}\n\n/**\n * Prefetches URLs related to the bootstrap iframe.\n * @param {!Window} parentWindow\n * @return {string}\n */\nexport function prefetchBootstrap(window) {\n  const url = getBootstrapBaseUrl(window);\n  const preconnect = preconnectFor(window);\n  preconnect.prefetch(url);\n  // While the URL may point to a custom domain, this URL will always be\n  // fetched by it.\n  preconnect.prefetch(\n      'https://3p.ampproject.net/$internalRuntimeVersion$/f.js');\n}\n\n/**\n * Returns the base URL for 3p bootstrap iframes.\n * @param {!Window} parentWindow\n * @return {string}\n * @visibleForTesting\n */\nexport function getBootstrapBaseUrl(parentWindow) {\n  return getService(window, 'bootstrapBaseUrl', () => {\n    return getCustomBootstrapBaseUrl(parentWindow) ||\n      getDefaultBootstrapBaseUrl(parentWindow);\n  });\n}\n\n/**\n * Returns the default base URL for 3p bootstrap iframes.\n * @param {!Window} parentWindow\n * @return {string}\n */\nfunction getDefaultBootstrapBaseUrl(parentWindow) {\n  let url =\n      'https://3p.ampproject.net/$internalRuntimeVersion$/frame.html';\n  if (getMode().localDev) {\n    url = 'http://ads.localhost:' + parentWindow.location.port +\n        '/dist.3p/current' +\n        (getMode().minified ? '-min/frame' : '/frame.max') +\n        '.html';\n  }\n  return url;\n}\n\n/**\n * Returns the custom base URL for 3p bootstrap iframes if it exists.\n * Otherwise null.\n * @param {!Window} parentWindow\n * @return {?string}\n */\nfunction getCustomBootstrapBaseUrl(parentWindow) {\n  const meta = parentWindow.document\n      .querySelector('meta[name=\"amp-3p-iframe-src\"]');\n  if (!meta) {\n    return null;\n  }\n  const url = assertHttpsUrl(meta.getAttribute('content'), meta);\n  assert(url.indexOf('?') == -1,\n      '3p iframe url must not include query string %s in element %s.',\n      url, meta);\n  // This is not a security primitive, we just don't want this to happen in\n  // practice. People could still redirect to the same origin, but they cannot\n  // redirect to the proxy origin which is the important one.\n  assert(parseUrl(url).origin != parseUrl(parentWindow.location.href).origin,\n      '3p iframe url must not be on the same origin as the current document ' +\n      '%s in element %s.', url, meta);\n  return url + '?$internalRuntimeVersion$';\n}\n","/**\n * Copyright 2015 The AMP HTML Authors. All Rights Reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS-IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n\n\n/**\n * Throws an error if the first argument isn't trueish.\n *\n * Supports argument substitution into the message via %s placeholders.\n *\n * Throws an error object that has two extra properties:\n * - associatedElement: This is the first element provided in the var args.\n *   It can be used for improved display of error messages.\n * - messageArray: The elements of the substituted message as non-stringified\n *   elements in an array. When e.g. passed to console.error this yields\n *   native displays of things like HTML elements.\n *\n * @param {T} shouldBeTrueish The value to assert. The assert fails if it does\n *     not evaluate to true.\n * @param {string} message The assertion message\n * @param {...*} var_args Arguments substituted into %s in the message.\n * @return {T} The value of shouldBeTrueish.\n * @template T\n */\n/*eslint \"google-camelcase/google-camelcase\": 0*/\nexport function assert(shouldBeTrueish, message, var_args) {\n  let firstElement;\n  if (!shouldBeTrueish) {\n    message = message || 'Assertion failed';\n    const splitMessage = message.split('%s');\n    const first = splitMessage.shift();\n    let formatted = first;\n    const messageArray = [];\n    pushIfNonEmpty(messageArray, first);\n    for (let i = 2; i < arguments.length; i++) {\n      const val = arguments[i];\n      if (val && val.tagName) {\n        firstElement = val;\n      }\n      const nextConstant = splitMessage.shift();\n      messageArray.push(val);\n      pushIfNonEmpty(messageArray, nextConstant.trim());\n      formatted += toString(val) + nextConstant;\n    }\n    const e = new Error(formatted);\n    e.fromAssert = true;\n    e.associatedElement = firstElement;\n    e.messageArray = messageArray;\n    throw e;\n  }\n  return shouldBeTrueish;\n}\n/*eslint \"google-camelcase/google-camelcase\": 2*/\n\n/**\n * @param {*} val\n * @return {string}\n */\nfunction toString(val) {\n  if (val instanceof Element) {\n    return val.tagName.toLowerCase() + (val.id ? '#' + val.id : '');\n  }\n  return val;\n}\n\n/**\n * @param {!Array} array\n * @param {*} val\n */\nfunction pushIfNonEmpty(array, val) {\n  if (val != '') {\n    array.push(val);\n  }\n}\n","/**\n * Copyright 2015 The AMP HTML Authors. All Rights Reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS-IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {getService} from './service';\nimport {assert} from './asserts';\nimport {parseUrl} from './url';\n\n/**\n * @param {!Window} win\n * @return {{canonicalUrl: string, pageViewId: string}} Info about the doc\n *     - canonicalUrl: The doc's canonical.\n *     - pageViewId: Id for this page view. Low entropy but should be unique\n *       for concurrent page views of a user.\n */\nexport function documentInfoFor(win) {\n  return getService(win, 'documentInfo', () => {\n    return {\n      canonicalUrl: parseUrl(assert(\n          win.document.querySelector('link[rel=canonical]'),\n              'AMP files are required to have a <link rel=canonical> tag.')\n              .href).href,\n      pageViewId: getPageViewId(win),\n    };\n  });\n}\n\n/**\n * Returns a relatively low entropy random string.\n * This should be called once per window and then cached for subsequent\n * access to the same value to be persistent per page.\n * @param {!Window} win\n * @return {string}\n */\nfunction getPageViewId(win) {\n  return String(Math.floor(win.Math.random() * 10000));\n}\n","/**\n * Copyright 2015 The AMP HTML Authors. All Rights Reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS-IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {timer} from './timer';\n\n\n/**\n * Listens for the specified event on the element and removes the listener\n * as soon as event has been received.\n * @param {!EventTarget} element\n * @param {string} eventType\n * @param {function(Event)} listener\n * @param {boolean=} opt_capture\n * @return {!UnlistenDef}\n */\nexport function listenOnce(element, eventType, listener, opt_capture) {\n  const capture = opt_capture || false;\n  let unlisten;\n  const proxy = event => {\n    listener(event);\n    unlisten();\n  };\n  unlisten = () => {\n    element.removeEventListener(eventType, proxy, capture);\n  };\n  element.addEventListener(eventType, proxy, capture);\n  return unlisten;\n}\n\n\n/**\n * Returns  a promise that will resolve as soon as the specified event has\n * fired on the element. Optionally, opt_timeout can be specified that will\n * reject the promise if the event has not fired by then.\n * @param {!EventTarget} element\n * @param {string} eventType\n * @param {boolean=} opt_capture\n * @param {number=} opt_timeout\n * @return {!Promise<!Event>}\n */\nexport function listenOncePromise(element, eventType, opt_capture,\n    opt_timeout) {\n  let unlisten;\n  const eventPromise = new Promise((resolve, unusedReject) => {\n    unlisten = listenOnce(element, eventType, resolve, opt_capture);\n  });\n  return racePromise_(eventPromise, unlisten, opt_timeout);\n}\n\n\n/**\n * Whether the specified element has been loaded already.\n * @param {!Element} element\n * @return {boolean}\n */\nexport function isLoaded(element) {\n  return element.complete || element.readyState == 'complete';\n}\n\n\n/**\n * Returns a promise that will resolve or fail based on the element's 'load'\n * and 'error' events. Optionally this method takes a timeout, which will reject\n * the promise if the resource has not loaded by then.\n * @param {!Element} element\n * @param {number=} opt_timeout\n * @return {!Promise<!Element>}\n */\nexport function loadPromise(element, opt_timeout) {\n  let unlistenLoad;\n  let unlistenError;\n  const loadingPromise = new Promise((resolve, reject) => {\n    if (isLoaded(element)) {\n      resolve(element);\n    } else {\n      // Listen once since IE 5/6/7 fire the onload event continuously for\n      // animated GIFs.\n      if (element.tagName === 'AUDIO' || element.tagName === 'VIDEO') {\n        unlistenLoad = listenOnce(element, 'loadstart', () => resolve(element));\n      } else {\n        unlistenLoad = listenOnce(element, 'load', () => resolve(element));\n      }\n      unlistenError = listenOnce(element, 'error', reject);\n    }\n  });\n  return racePromise_(loadingPromise, () => {\n    // It's critical that all listeners are removed.\n    if (unlistenLoad) {\n      unlistenLoad();\n    }\n    if (unlistenError) {\n      unlistenError();\n    }\n  }, opt_timeout);\n}\n\n\n/**\n * @param {!Promise<TYPE>} promise\n * @param {Unlisten|undefined} unlisten\n * @param {number|undefined} timeout\n * @return {!Promise<TYPE>}\n * @template TYPE\n */\nfunction racePromise_(promise, unlisten, timeout) {\n  let racePromise;\n  if (timeout === undefined) {\n    // Timeout is not specified: return promise.\n    racePromise = promise;\n  } else {\n    // Timeout has been specified: add a timeout condition.\n    racePromise = timer.timeoutPromise(timeout || 0, promise);\n  }\n  if (!unlisten) {\n    return racePromise;\n  }\n  return racePromise.then(result => {\n    unlisten();\n    return result;\n  }, reason => {\n    unlisten();\n    throw reason;\n  });\n}\n","/**\n * Copyright 2015 The AMP HTML Authors. All Rights Reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS-IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/**\n * @fileoverview Implements element layout. See https://goo.gl/9avXuT for\n * details.\n */\n\nimport {assert} from './asserts';\n\n\n/**\n * @enum {string}\n */\nexport const Layout = {\n  NODISPLAY: 'nodisplay',\n  FIXED: 'fixed',\n  FIXED_HEIGHT: 'fixed-height',\n  RESPONSIVE: 'responsive',\n  CONTAINER: 'container',\n  FILL: 'fill'\n};\n\n\n/**\n * CSS Length type. E.g. \"1px\" or \"20vh\".\n * @typedef {string}\n */\nlet LengthDef;\n\n\n/**\n * @typedef {{\n *   width: string,\n *   height: string\n * }}\n */\nlet DimensionsDef;\n\n\n/**\n * The set of elements with natural dimensions, that is, elements\n * which have a known dimension either based on their value specified here,\n * or, if the value is null, a dimension specific to the browser.\n * `hasNaturalDimensions` checks for membership in this set.\n * `getNaturalDimensions` determines the dimensions for an element in the\n *    set and caches it.\n * @type {!Object<string, ?DimensionsDef>}\n * @private  Visible for testing only!\n */\nexport const naturalDimensions_ = {\n  'AMP-PIXEL': {width: '1px', height: '1px'},\n  'AMP-ANALYTICS': {width: '1px', height: '1px'},\n  // TODO(dvoytenko): audio should have width:auto.\n  'AMP-AUDIO': null\n};\n\n\n/**\n * Elements that the progess can be shown for. This set has to be externalized\n * since the element's implementation may not be downloaded yet.\n * @enum {boolean}\n * @private  Visible for testing only!\n */\nexport const LOADING_ELEMENTS_ = {\n  'AMP-ANIM': true,\n  'AMP-BRIGHTCOVE': true,\n  'AMP-IFRAME': true,\n  'AMP-IMG': true,\n  'AMP-INSTAGRAM': true,\n  'AMP-LIST': true,\n  'AMP-PINTEREST': true,\n  'AMP-VIDEO': true\n};\n\n\n/**\n * @param {string} s\n * @return {Layout|undefined} Returns undefined in case of failure to parse\n *   the layout string.\n */\nexport function parseLayout(s) {\n  for (const k in Layout) {\n    if (Layout[k] == s) {\n      return Layout[k];\n    }\n  }\n  return undefined;\n}\n\n\n/**\n * @param {!Layout} layout\n * @return {string}\n */\nexport function getLayoutClass(layout) {\n  return '-amp-layout-' + layout;\n}\n\n\n/**\n * Whether an element with this layout inherently defines the size.\n * @param {!Layout} layout\n * @return {boolean}\n */\nexport function isLayoutSizeDefined(layout) {\n  return (layout == Layout.FIXED ||\n      layout == Layout.FIXED_HEIGHT ||\n      layout == Layout.RESPONSIVE ||\n      layout == Layout.FILL);\n}\n\n\n/**\n * Whether the tag is an internal (service) AMP tag.\n * @param {!Node|string} tag\n * @return {boolean}\n */\nexport function isInternalElement(tag) {\n  const tagName = (typeof tag == 'string') ? tag : tag.tagName;\n  return tagName && tagName.toLowerCase().indexOf('i-') == 0;\n}\n\n\n/**\n * Parses the CSS length value. If no units specified, the assumed value is\n * \"px\". Returns undefined in case of parsing error.\n * @param {string|undefined} s\n * @return {!LengthDef|undefined}\n */\nexport function parseLength(s) {\n  if (typeof s == 'number') {\n    return s + 'px';\n  }\n  if (!s) {\n    return undefined;\n  }\n  if (!/^\\d+(\\.\\d+)?(px|em|rem|vh|vw|vmin|vmax)?$/.test(s)) {\n    return undefined;\n  }\n  if (/^\\d+(\\.\\d+)?$/.test(s)) {\n    return s + 'px';\n  }\n  return s;\n}\n\n\n/**\n * Asserts that the supplied value is a CSS Length value.\n * @param {!LengthDef|string} length\n * @return {!LengthDef}\n */\nexport function assertLength(length) {\n  assert(/^\\d+(\\.\\d+)?(px|em|rem|vh|vw|vmin|vmax)$/.test(length),\n      'Invalid length value: %s', length);\n  return length;\n}\n\n\n/**\n * Returns units from the CSS length value.\n * @param {!LengthDef} length\n * @return {string}\n */\nexport function getLengthUnits(length) {\n  assertLength(length);\n  const m = assert(length.match(/[a-z]+/i),\n      'Failed to read units from %s', length);\n  return m[0];\n}\n\n\n/**\n * Returns the numeric value of a CSS length value.\n * @param {!LengthDef|string} length\n * @return {number}\n */\nexport function getLengthNumeral(length) {\n  return parseFloat(length);\n}\n\n\n/**\n * Determines whether the tagName is a known element that has natural dimensions\n * in our runtime or the browser.\n * @param {string} tagName The element tag name.\n * @return {DimensionsDef}\n */\nexport function hasNaturalDimensions(tagName) {\n  tagName = tagName.toUpperCase();\n  return naturalDimensions_[tagName] !== undefined;\n}\n\n\n/**\n * Determines the default dimensions for an element which could vary across\n * different browser implementations, like <audio> for instance.\n * This operation can only be completed for an element whitelisted by\n * `hasNaturalDimensions`.\n * @param {string} tagName The element tag name.\n * @return {DimensionsDef}\n */\nexport function getNaturalDimensions(tagName) {\n  tagName = tagName.toUpperCase();\n  assert(naturalDimensions_[tagName] !== undefined);\n  if (!naturalDimensions_[tagName]) {\n    const naturalTagName = tagName.replace(/^AMP\\-/, '');\n    const temp = document.createElement(naturalTagName);\n    // For audio, should no-op elsewhere.\n    temp.controls = true;\n    temp.style.position = 'absolute';\n    temp.style.visibility = 'hidden';\n    document.body.appendChild(temp);\n    naturalDimensions_[tagName] = {\n      width: (temp./*OK*/offsetWidth || 1) + 'px',\n      height: (temp./*OK*/offsetHeight || 1) + 'px'\n    };\n    document.body.removeChild(temp);\n  }\n  return naturalDimensions_[tagName];\n}\n\n\n/**\n * Whether the loading can be shown for the specified elemeent. This set has\n * to be externalized since the element's implementation may not be\n * downloaded yet.\n * @param {string} tagName The element tag name.\n * @return {boolean}\n */\nexport function isLoadingAllowed(tagName) {\n  return LOADING_ELEMENTS_[tagName.toUpperCase()] || false;\n}\n","/**\n * Copyright 2015 The AMP HTML Authors. All Rights Reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS-IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {parseQueryString} from './url';\n\n\n/**\n * @typedef {{\n *   localDev: boolean\n * }}\n */\nlet ModeDef;\n\n/** @typedef {?ModeDef} */\nlet mode = null;\n\n/**\n * Provides info about the current app.\n * @return {!ModeDef}\n */\nexport function getMode() {\n  if (mode) {\n    return mode;\n  }\n  return mode = getMode_();\n}\n\n/**\n * Set mode in a test. Pass null in afterEach function to reset.\n * @param {?ModeDef} m\n */\nexport function setModeForTesting(m) {\n  mode = m;\n}\n\n/**\n * Provides info about the current app.\n * @return {!ModeDef}\n */\nfunction getMode_() {\n  const isLocalDev = (location.hostname == 'localhost' ||\n      (location.ancestorOrigins && location.ancestorOrigins[0] &&\n          location.ancestorOrigins[0].indexOf('http://localhost:') == 0)) &&\n      // Filter out localhost running against a prod script.\n      // Because all allowed scripts are ours, we know that these can only\n      // occur during local dev.\n      !!document.querySelector('script[src*=\"/dist/\"],script[src*=\"/base/\"]');\n\n  const overrideDevelopment = parseQueryString(location.hash)['development'];\n  const development = overrideDevelopment != undefined\n      ? overrideDevelopment == '1'\n      : !!document.querySelector('script[development]');\n\n  return {\n    localDev: isLocalDev,\n    // Triggers validation\n    development: development,\n    minified: process.env.NODE_ENV == 'production',\n    test: window.AMP_TEST\n  };\n}\n","/**\n * Copyright 2015 The AMP HTML Authors. All Rights Reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS-IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {getService} from './service';\n\n\n/**\n * A helper class that provides information about device/OS/browser currently\n * running.\n */\nexport class Platform {\n\n  /**\n   * @param {!Window} win\n   */\n  constructor(win) {\n    /** @const {!Window} */\n    this.win = win;\n  }\n\n  /**\n   * Whether the current platform an iOS device.\n   * @return {boolean}\n   */\n  isIos() {\n    return /iPhone|iPad|iPod/i.test(this.win.navigator.userAgent);\n  }\n\n  /**\n   * Whether the current browser is Safari.\n   * @return {boolean}\n   */\n  isSafari() {\n    return /Safari/i.test(this.win.navigator.userAgent) && !this.isChrome();\n  }\n\n  /**\n   * Whether the current browser a Chrome browser.\n   * @return {boolean}\n   */\n  isChrome() {\n    // Also true for MS Edge :)\n    return /Chrome|CriOS/i.test(this.win.navigator.userAgent);\n  }\n};\n\n\n/**\n * @param {!Window} window\n * @return {!Platform}\n */\nexport function platformFor(window) {\n  return getService(window, 'platform', () => {\n    return new Platform(window);\n  });\n};\n\nexport const platform = platformFor(window);\n","/**\n * Copyright 2015 The AMP HTML Authors. All Rights Reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS-IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/**\n * @fileoverview Provides a services to preconnect to a url to warm up the\n * connection before the real request can be made.\n */\n\n\nimport {getService} from './service';\nimport {parseUrl} from './url';\nimport {timer} from './timer';\nimport {platformFor} from './platform';\n\nconst ACTIVE_CONNECTION_TIMEOUT_MS = 180 * 1000;\nconst PRECONNECT_TIMEOUT_MS = 10 * 1000;\n\nclass Preconnect {\n\n  /**\n   * @param {!Window} win\n   */\n  constructor(win) {\n    /** @private @const {!Element} */\n    this.head_ = win.document.head;\n    /**\n     * Origin we've preconnected to and when that connection\n     * expires as a timestamp in MS.\n     * @private @const {!Object<string, number>}\n     */\n    this.origins_ = {};\n    /**\n     * Urls we've prefetched.\n     * @private @const {!Object<string, boolean>}\n     */\n    this.urls_ = {};\n    /** @private @const {!Platform}  */\n    this.platform_ = platformFor(win);\n    // Mark current origin as preconnected.\n    this.origins_[parseUrl(win.location.href).origin] = true;\n  }\n\n  /**\n   * Preconnects to a URL. Always also does a dns-prefetch because\n   * browser support for that is better.\n   * @param {string} url\n   * @param {boolean=} opt_alsoConnecting Set this flag if you also just\n   *    did or are about to connect to this host. This is for the case\n   *    where preconnect is issued immediate before or after actual connect\n   *    and preconnect is used to flatten a deep HTTP request chain.\n   *    E.g. when you preconnect to a host that an embed will connect to\n   *    when it is more fully rendered, you already know that the connection\n   *    will be used very soon.\n   */\n  url(url, opt_alsoConnecting) {\n    if (!this.isInterestingUrl_(url)) {\n      return;\n    }\n    const origin = parseUrl(url).origin;\n    const now = timer.now();\n    const lastPreconnectTimeout = this.origins_[origin];\n    if (lastPreconnectTimeout && now < lastPreconnectTimeout) {\n      if (opt_alsoConnecting) {\n        this.origins_[origin] = now + ACTIVE_CONNECTION_TIMEOUT_MS ;\n      }\n      return;\n    }\n    // If we are about to use the connection, don't re-preconnect for\n    // 180 seconds.\n    const timeout = opt_alsoConnecting\n        ? ACTIVE_CONNECTION_TIMEOUT_MS\n        : PRECONNECT_TIMEOUT_MS;\n    this.origins_[origin] = now + timeout;\n    const dns = document.createElement('link');\n    dns.setAttribute('rel', 'dns-prefetch');\n    dns.setAttribute('href', origin);\n    const preconnect = document.createElement('link');\n    preconnect.setAttribute('rel', 'preconnect');\n    preconnect.setAttribute('href', origin);\n    this.head_.appendChild(dns);\n    this.head_.appendChild(preconnect);\n\n    // Remove the tags eventually to free up memory.\n    timer.delay(() => {\n      if (dns.parentNode) {\n        dns.parentNode.removeChild(dns);\n      }\n      if (preconnect.parentNode) {\n        preconnect.parentNode.removeChild(preconnect);\n      }\n    }, 10000);\n\n    this.preconnectPolyfill_(origin);\n  }\n\n  /**\n   * Asks the browser to prefetch a URL. Always also does a preconnect\n   * because browser support for that is better.\n   * @param {string} url\n   */\n  prefetch(url) {\n    if (!this.isInterestingUrl_(url)) {\n      return;\n    }\n    if (this.urls_[url]) {\n      return;\n    }\n    this.urls_[url] = true;\n    this.url(url, /* opt_alsoConnecting */ true);\n    const prefetch = document.createElement('link');\n    prefetch.setAttribute('rel', 'prefetch');\n    prefetch.setAttribute('href', url);\n    this.head_.appendChild(prefetch);\n    // As opposed to preconnect we do not clean this tag up, because there is\n    // no expectation as to it having an immediate effect.\n  }\n\n  isInterestingUrl_(url) {\n    if (url.indexOf('https:') == 0 || url.indexOf('http:') == 0) {\n      return true;\n    }\n    return false;\n  }\n\n  /**\n   * Safari does not support preconnecting, but due to its significant\n   * performance benefits we implement this crude polyfill.\n   *\n   * We make an image connection to a \"well-known\" file on the origin adding\n   * a random query string to bust the cache (no caching because we do want to\n   * actually open the connection).\n   *\n   * This should get us an open SSL connection to these hosts and significantly\n   * speed up the next connections.\n   *\n   * The actual URL is expected to 404. If you see errors for\n   * amp_preconnect_polyfill in your DevTools console or server log:\n   * This is expected and fine to leave as is. Its fine to send a non 404\n   * response, but please make it small :)\n   */\n  preconnectPolyfill_(origin) {\n    // Unfortunately there is no way to feature detect whether preconnect is\n    // supported, so we do this only in Safari, which is the most important\n    // browser without support for it. This needs to be removed should it\n    // ever add support.\n    if (!this.platform_.isSafari()) {\n      return;\n    }\n    // Don't attempt to preconnect for ACTIVE_CONNECTION_TIMEOUT_MS since\n    // we effectively create an active connection.\n    // TODO(@cramforce): Confirm actual http2 timeout in Safari.\n    this.origins_[origin] = timer.now() + ACTIVE_CONNECTION_TIMEOUT_MS;\n    const url = origin + '/amp_preconnect_polyfill?' + Math.random();\n    // We use an XHR without withCredentials(true), so we do not send cookies\n    // to the host and the host cannot set cookies.\n    const xhr = new XMLHttpRequest();\n    xhr.open('HEAD', url, true);\n    xhr.send();\n  }\n}\n\n/**\n * @param {!Window} window\n * @return {!Preconnect}\n */\nexport function preconnectFor(window) {\n  return getService(window, 'preconnect', () => {\n    return new Preconnect(window);\n  });\n};\n","/**\n * Copyright 2015 The AMP HTML Authors. All Rights Reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS-IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {assert} from './asserts';\n\n/**\n * Holds info about a service.\n * - obj: Actual service implementation when available.\n * - promise: Promise for the obj.\n * - resolve: Function to resolve the promise with the object.\n * @typedef {{\n *   obj: (?Object),\n *   promise: (?Promise|undefined),\n *   resolve: (?function(!Object)|undefined),\n * }}\n */\nlet ServiceHolderDef;\n\n/**\n * Returns a service for the given id and window (a per-window singleton).\n * If the service is not yet available the factory function is invoked and\n * expected to return the service.\n * Users should typically wrap this as a special purpose function (e.g.\n * viewportFor(win)) for type safety and because the factory should not be\n * passed around.\n * @param {!Window} win\n * @param {string} id of the service.\n * @param {function(!Window):!Object=} opt_factory Should create the service\n *     if it does not exist yet. If the factory is not given, it is an error\n *     if the service does not exist yet.\n * @return {*}\n */\nexport function getService(win, id, opt_factory) {\n  const services = getServices(win);\n  let s = services[id];\n  if (!s) {\n    s = services[id] = {};\n  }\n  if (!s.obj) {\n    assert(opt_factory, 'Factory not given and service missing %s', id);\n    s.obj = opt_factory(win);\n    // The service may have been requested already, in which case we have a\n    // pending promise we need to fulfill.\n    if (s.resolve) {\n      s.resolve(s.obj);\n    }\n  }\n  return s.obj;\n}\n\n/**\n * Returns a promise for a service for the given id and window. Also expects\n * an element that has the actual implementation. The promise resolves when\n * the implementation loaded.\n * Users should typically wrap this as a special purpose function (e.g.\n * viewportFor(win)) for type safety and because the factory should not be\n * passed around.\n * @param {!Window} win\n * @param {string} id of the service.\n * @param {string} provideByElement Name of the custom element that provides\n *     the implementation of this service.\n * @return {!Promise<*>}\n */\nexport function getElementService(win, id, providedByElement) {\n  // Call `getElementService_` in a micro-task to ensure that `stubElements`\n  // has been called.\n  return Promise.resolve().then(() => {\n    return getElementService_(win, id, providedByElement);\n  });\n}\n\n/**\n * @param {!Window} win\n * @param {string} id of the service.\n * @param {string} provideByElement Name of the custom element that provides\n *     the implementation of this service.\n * @return {!Promise<*>}\n * @private\n */\nfunction getElementService_(win, id, providedByElement) {\n  assert(isElementScheduled(win, providedByElement),\n      'Service %s was requested to be provided through %s, ' +\n      'but %s is not loaded in the current page. To fix this ' +\n      'problem load the JavaScript file for %s in this page.',\n      id, providedByElement, providedByElement, providedByElement);\n  const services = getServices(win);\n  const s = services[id];\n  if (s) {\n    // If a service was registered with getService, we make a promise from it\n    // which we will return in future invocations.\n    if (!s.promise) {\n      s.promise = Promise.resolve(s.obj);\n    }\n    return s.promise;\n  }\n  // TODO(@cramforce): Add a check that if the element is eventually registered\n  // that the service is actually provided and this promise resolves.\n  let resolve;\n  const p = new Promise(r => {\n    resolve = r;\n  });\n  services[id] = {\n    obj: null,\n    promise: p,\n    resolve: resolve,\n  };\n\n  return p;\n}\n\n/**\n * @param {!Window} win\n * @param {string} elementName Name of an extended custom element.\n * @return {boolean} Whether this element is scheduled to be loaded.\n */\nfunction isElementScheduled(win, elementName) {\n  assert(win.ampExtendedElements, 'win.ampExtendedElements not created yet');\n  return !!win.ampExtendedElements[elementName];\n}\n\n/**\n * In order to provide better error messages we only allow to retrieve\n * services from other elements if those elements are loaded in the page.\n * This makes it possible to mark an element as loaded in a test.\n * @param {!Window} win\n * @param {string} elementName Name of an extended custom element.\n */\nexport function markElementScheduledForTesting(win, elementName) {\n  if (!win.ampExtendedElements) {\n    win.ampExtendedElements = {};\n  }\n  win.ampExtendedElements[elementName] = true;\n}\n\n/**\n * Returns the object that holds the services registered in a window.\n * @param {!Window} win\n * @return {!Object<string,!ServiceHolderDef>}\n */\nfunction getServices(win) {\n  let services = win.services;\n  if (!services) {\n    services = win.services = {};\n  }\n  return services;\n}\n\n/**\n * Resets a single service, so it gets recreated on next getService invocation.\n * @param {!Window} win\n * @param {string} id of the service.\n */\nexport function resetServiceForTesting(win, id) {\n  if (win.services) {\n    win.services[id] = null;\n  }\n}\n","/**\n * Copyright 2015 The AMP HTML Authors. All Rights Reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS-IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/**\n * @param {string} name Attribute name with dashes\n * @return {string} Dashes removed and character after to upper case.\n * visibleForTesting\n */\nexport function dashToCamelCase(name) {\n  return name.replace(/-([a-z])/g, function(_all, character) {\n    return character.toUpperCase();\n  });\n}\n\n/**\n * Expands placeholders in a given template string with values.\n *\n * Placeholders use ${key-name} syntax and are replaced with the value\n * returned from the given getter function.\n *\n * @param {string} template The template string to expand.\n * @param {!function(string):*} getter Function used to retrieve a value for a\n *   placeholder. Returns values will be coerced into strings.\n * @param {number=1} optMaxIterations Number of times to expand the template.\n *   Defaults to 1, but should be set to a larger value your placeholder tokens\n *   can be expanded to other placeholder tokens. Take caution with large values\n *   as recursively expanding a string can be exponentially expensive.\n */\nexport function expandTemplate(template, getter, opt_maxIterations) {\n  const maxIterations = opt_maxIterations || 1;\n  for (let i = 0; i < maxIterations; i++) {\n    let matches = 0;\n    template = template.replace(/\\${([^}]*)}/g, (_a, b) => {\n      matches++;\n      return getter(b);\n    });\n    if (!matches) {\n      break;\n    }\n  }\n  return template;\n}\n\n","/**\n * Copyright 2015 The AMP HTML Authors. All Rights Reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS-IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/**\n * Helper with all things Timer.\n */\nexport class Timer {\n\n  /**\n   * @param {!Window} win\n   */\n  constructor(win) {\n    /** @const {!Window} */\n    this.win = win;\n\n    /** @private @const {!Promise}  */\n    this.resolved_ = Promise.resolve();\n\n    this.taskCount_ = 0;\n\n    this.canceled_ = {};\n\n    /** @const {number} */\n    this.startTime_ = this.now();\n  }\n\n  /**\n   * Returns the current EPOC time in milliseconds.\n   * @return {number}\n   */\n  now() {\n    // TODO(dvoytenko): when can we use Date.now?\n    return Number(new Date());\n  }\n\n /**\n  * Returns time since start in milliseconds.\n  * @return {number}\n  */\n  timeSinceStart() {\n    return this.now() - this.startTime_;\n  }\n\n  /**\n   * Runs the provided callback after the specified delay. This uses a micro\n   * task for 0 or no specified time. This means that the delay will actually\n   * be close to 0 and this will NOT yield to the event queue.\n   *\n   * Returns the timer ID that can be used to cancel the timer (cancel method).\n   * @param {!function()} callback\n   * @param {number=} opt_delay\n   * @return {number|string}\n   */\n  delay(callback, opt_delay) {\n    if (!opt_delay) {\n      // For a delay of zero,  schedule a promise based micro task since\n      // they are predictably fast.\n      const id = 'p' + this.taskCount_++;\n      this.resolved_.then(() => {\n        if (this.canceled_[id]) {\n          delete this.canceled_[id];\n          return;\n        }\n        callback();\n      });\n      return id;\n    }\n    return this.win.setTimeout(callback, opt_delay);\n  }\n\n  /**\n   * Cancels the previously scheduled callback.\n   * @param {number|string} timeoutId\n   */\n  cancel(timeoutId) {\n    if (typeof timeoutId == 'string') {\n      this.canceled_[timeoutId] = true;\n      return;\n    }\n    this.win.clearTimeout(timeoutId);\n  }\n\n  /**\n   * Returns a promise that will resolve after the delay. Optionally, the\n   * resolved value can be provided as opt_result argument.\n   * @param {number=} opt_delay\n   * @param {RESULT=} opt_result\n   * @return {!Promise<RESULT>}\n   * @template RESULT\n   */\n  promise(opt_delay, opt_result) {\n    let timerKey = null;\n    return new Promise((resolve, reject) => {\n      timerKey = this.delay(() => {\n        timerKey = -1;\n        resolve(opt_result);\n      }, opt_delay);\n      if (timerKey == -1) {\n        reject(new Error('Failed to schedule timer.'));\n      }\n    }).catch(error => {\n      // Clear the timer. The most likely reason is \"cancel\" signal.\n      if (timerKey != -1) {\n        this.cancel(timerKey);\n      }\n      return Promise.reject(error);\n    });\n  }\n\n  /**\n   * Returns a promise that will fail after the specified delay. Optionally,\n   * this method can take opt_racePromise parameter. In this case, the\n   * resulting promise will either fail when the specified delay expires or\n   * will resolve based on the opt_racePromise, whichever happens first.\n   * @param {number} delay\n   * @param {!Promise<RESULT>|undefined} opt_racePromise\n   * @return {!Promise<RESULT>}\n   * @template RESULT\n   */\n  timeoutPromise(delay, opt_racePromise) {\n    let timerKey = null;\n    const delayPromise = new Promise((_resolve, reject) => {\n      timerKey = this.delay(() => {\n        timerKey = -1;\n        reject('timeout');\n      }, delay);\n      if (timerKey == -1) {\n        reject(new Error('Failed to schedule timer.'));\n      }\n    }).catch(error => {\n      // Clear the timer. The most likely reason is \"cancel\" signal.\n      if (timerKey != -1) {\n        this.cancel(timerKey);\n      }\n      return Promise.reject(error);\n    });\n    if (!opt_racePromise) {\n      return delayPromise;\n    }\n    // Avoids Promise->race due to presubmit check against it.\n    return new Promise((resolve, reject) => {\n      delayPromise.then(resolve, reject);\n      opt_racePromise.then(resolve, reject);\n    });\n  }\n}\n\n\nexport const timer = new Timer(window);\n","/**\n * Copyright 2015 The AMP HTML Authors. All Rights Reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS-IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {assert} from './asserts';\n\n\n/**\n * Returns a Location-like object for the given URL. If it is relative,\n * the URL gets resolved.\n * @param {string} url\n * @return {!Location}\n */\nexport function parseUrl(url) {\n  const a = document.createElement('a');\n  a.href = url;\n  const info = {\n    href: a.href,\n    protocol: a.protocol,\n    host: a.host,\n    hostname: a.hostname,\n    port: a.port == '0' ? '' : a.port,\n    pathname: a.pathname,\n    search: a.search,\n    hash: a.hash\n  };\n  // For data URI a.origin is equal to the string 'null' which is not useful.\n  // We instead return the actual origin which is the full URL.\n  info.origin = (a.origin && a.origin != 'null') ? a.origin : getOrigin(info);\n  assert(info.origin, 'Origin must exist');\n  return info;\n}\n\n\n/**\n * Asserts that a given url is HTTPS or protocol relative.\n * Provides an exception for localhost.\n * @param {string} urlString\n * @param {!Element} elementContext Element where the url was found.\n * @return {string}\n */\nexport function assertHttpsUrl(urlString, elementContext) {\n  const url = parseUrl(urlString);\n  assert(\n      url.protocol == 'https:' || /^(\\/\\/)/.test(urlString) ||\n      url.hostname == 'localhost' ||\n          url.hostname.lastIndexOf('.localhost') ==\n          // Poor person's endsWith\n          url.hostname.length - '.localhost'.length,\n      '%s source must start with ' +\n      '\"https://\" or \"//\" or be relative and served from ' +\n      'either https or from localhost. Invalid value: %s',\n      elementContext, urlString);\n  return urlString;\n}\n\n\n/**\n * Parses the query string of an URL. This method returns a simple key/value\n * map. If there are duplicate keys the latest value is returned.\n * @param {string} queryString\n * @return {!Object<string, string>}\n */\nexport function parseQueryString(queryString) {\n  const params = Object.create(null);\n  if (!queryString) {\n    return params;\n  }\n  if (queryString.indexOf('?') == 0 || queryString.indexOf('#') == 0) {\n    queryString = queryString.substr(1);\n  }\n  const pairs = queryString.split('&');\n  for (let i = 0; i < pairs.length; i++) {\n    const pair = pairs[i];\n    const eqIndex = pair.indexOf('=');\n    let name;\n    let value;\n    if (eqIndex != -1) {\n      name = decodeURIComponent(pair.substring(0, eqIndex)).trim();\n      value = decodeURIComponent(pair.substring(eqIndex + 1)).trim();\n    } else {\n      name = decodeURIComponent(pair).trim();\n      value = '';\n    }\n    if (name) {\n      params[name] = value;\n    }\n  }\n  return params;\n}\n\n\n/**\n * Don't use this directly, only exported for testing. The value\n * is available via the origin property of the object returned by\n * parseUrl.\n * @param {!Location} info\n * @return {string}\n * @visibleForTesting\n */\nexport function getOrigin(info) {\n  if (info.protocol == 'data:' || !info.host) {\n    return info.href;\n  }\n  return info.protocol + '//' + info.host;\n}\n\n\n/**\n * Returns the URL without fragment. If URL doesn't contain fragment, the same\n * string is returned.\n * @param {string} url\n * @return {string}\n */\nexport function removeFragment(url) {\n  const index = url.indexOf('#');\n  if (index == -1) {\n    return url;\n  }\n  return url.substring(0, index);\n}\n"]}