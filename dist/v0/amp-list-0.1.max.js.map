{"version":3,"sources":["node_modules/browserify/node_modules/browser-pack/_prelude.js","build/all/v0/amp-list-0.1.max.js","node_modules/browserify/node_modules/process/browser.js","src/asserts.js","src/cid.js","src/document-info.js","src/dom.js","src/layout.js","src/log.js","src/mode.js","src/service.js","src/template.js","src/url-replacements.js","src/url.js","src/user-notification.js","src/viewport.js","src/vsync.js","src/xhr.js"],"names":[],"mappings":"AAAA;;;;;;;;;;;;;;;;;;kCCgBiC,+BAA+B;;sBACnC,kBAAkB;;yBACb,qBAAqB;;2BAC5B,uBAAuB;;sBAC7B,kBAAkB;;;AAIvC,IAAM,MAAM,GAAG,GAAG,CAAC,MAAM,CAAC;;;;;;;IAOb,OAAO;wBAAP,OAAO;;WAAP,OAAO;sCAAP,OAAO;;;;;;;AAAP,SAAO,WAGlB,iBAAiB,GAAA,2BAAC,MAAM,EAAE;AACxB,WAAO,+BAAoB,MAAM,CAAC,CAAC;GACpC;;;;AALU,SAAO,WAQlB,aAAa,GAAA,yBAAG;;AAEd,QAAI,CAAC,UAAU,GAAG,IAAI,CAAC,MAAM,EAAE,CAAC,QAAQ,CAAC,aAAa,CAAC,KAAK,CAAC,CAAC;AAC9D,QAAI,CAAC,gBAAgB,CAAC,IAAI,CAAC,UAAU,EAAE,IAAI,CAAC,CAAC;AAC7C,QAAI,CAAC,OAAO,CAAC,WAAW,CAAC,IAAI,CAAC,UAAU,CAAC,CAAC;AAC1C,QAAI,CAAC,IAAI,CAAC,OAAO,CAAC,YAAY,CAAC,MAAM,CAAC,EAAE;AACtC,UAAI,CAAC,OAAO,CAAC,YAAY,CAAC,MAAM,EAAE,MAAM,CAAC,CAAC;KAC3C;;;AAGD,QAAI,CAAC,gBAAgB,GAAG,uCAAmB,IAAI,CAAC,MAAM,EAAE,CAAC,CAAC;GAC3D;;;;AAnBU,SAAO,WAsBlB,cAAc,GAAA,0BAAG;;;AACf,WAAO,IAAI,CAAC,gBAAgB,CAAC,MAAM,CAAC,uBAChC,IAAI,CAAC,OAAO,CAAC,YAAY,CAAC,KAAK,CAAC,EAAE,IAAI,CAAC,OAAO,CAAC,CAAC,CAAC,IAAI,CAAC,UAAA,GAAG,EAAI;AAC3D,UAAM,IAAI,GAAG;AACX,mBAAW,EAAE,MAAK,OAAO,CAAC,YAAY,CAAC,aAAa,CAAC;OACtD,CAAC;AACF,aAAO,eAAO,MAAK,MAAM,EAAE,CAAC,CAAC,SAAS,CAAC,GAAG,EAAE,IAAI,CAAC,CAAC;KACnD,CAAC,CAAC,IAAI,CAAC,UAAA,IAAI,EAAI;AACd,YAAM,CAAC,OAAO,IAAI,IAAI,QAAQ,IAAI,KAAK,CAAC,OAAO,CAAC,IAAI,CAAC,OAAO,CAAC,CAAC,EAC1D,2CAA2C,EAC3C,MAAK,OAAO,EAAE,IAAI,CAAC,CAAC;AACxB,UAAM,KAAK,GAAG,IAAI,CAAC,OAAO,CAAC,CAAC;AAC5B,aAAO,0BAAa,MAAK,MAAM,EAAE,CAAC,CAAC,0BAA0B,CACzD,MAAK,OAAO,EAAE,KAAK,CAAC,CAAC,IAAI,CAAC,MAAK,SAAS,CAAC,IAAI,OAAM,CAAC,CAAC;KAC1D,CAAC,CAAC;GACR;;;;;;;AArCU,SAAO,WA2ClB,SAAS,GAAA,mBAAC,QAAQ,EAAE;;;AAClB,YAAQ,CAAC,OAAO,CAAC,UAAA,OAAO,EAAI;AAC1B,UAAI,CAAC,OAAO,CAAC,YAAY,CAAC,MAAM,CAAC,EAAE;AACjC,eAAO,CAAC,YAAY,CAAC,MAAM,EAAE,UAAU,CAAC,CAAC;OAC1C;AACD,aAAK,UAAU,CAAC,WAAW,CAAC,OAAO,CAAC,CAAC;KACtC,CAAC,CAAC;;;AAGH,QAAI,CAAC,QAAQ,EAAE,CAAC,OAAO,CAAC,YAAM;AAC5B,UAAM,YAAY,GAAG,OAAK,UAAU,QAAO,YAAY,CAAC;AACxD,UAAM,MAAM,GAAG,OAAK,OAAO,QAAO,YAAY,CAAC;AAC/C,UAAI,YAAY,GAAG,MAAM,EAAE;AACzB,eAAK,mBAAmB,CAAC,YAAY,CAAC,CAAC;OACxC;KACF,CAAC,CAAC;GACJ;;SA3DU,OAAO;GAAS,GAAG,CAAC,WAAW;;;;AA8D5C,GAAG,CAAC,eAAe,CAAC,UAAU,EAAE,OAAO,CAAC,CAAC;;;AC7FzC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACrDO,SAAS,MAAM,CAAC,eAAe,EAAE,OAAO,EAAE,QAAQ,EAAE;AACzD,MAAI,YAAY,YAAA,CAAC;AACjB,MAAI,CAAC,eAAe,EAAE;AACpB,WAAO,GAAG,OAAO,IAAI,kBAAkB,CAAC;AACxC,QAAM,YAAY,GAAG,OAAO,CAAC,KAAK,CAAC,IAAI,CAAC,CAAC;AACzC,QAAM,KAAK,GAAG,YAAY,CAAC,KAAK,EAAE,CAAC;AACnC,QAAI,SAAS,GAAG,KAAK,CAAC;AACtB,QAAM,YAAY,GAAG,EAAE,CAAC;AACxB,kBAAc,CAAC,YAAY,EAAE,KAAK,CAAC,CAAC;AACpC,SAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,SAAS,CAAC,MAAM,EAAE,CAAC,EAAE,EAAE;AACzC,UAAM,GAAG,GAAG,SAAS,CAAC,CAAC,CAAC,CAAC;AACzB,UAAI,GAAG,IAAI,GAAG,CAAC,OAAO,EAAE;AACtB,oBAAY,GAAG,GAAG,CAAC;OACpB;AACD,UAAM,YAAY,GAAG,YAAY,CAAC,KAAK,EAAE,CAAC;AAC1C,kBAAY,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC;AACvB,oBAAc,CAAC,YAAY,EAAE,YAAY,CAAC,IAAI,EAAE,CAAC,CAAC;AAClD,eAAS,IAAI,QAAQ,CAAC,GAAG,CAAC,GAAG,YAAY,CAAC;KAC3C;AACD,QAAM,CAAC,GAAG,IAAI,KAAK,CAAC,SAAS,CAAC,CAAC;AAC/B,KAAC,CAAC,UAAU,GAAG,IAAI,CAAC;AACpB,KAAC,CAAC,iBAAiB,GAAG,YAAY,CAAC;AACnC,KAAC,CAAC,YAAY,GAAG,YAAY,CAAC;AAC9B,UAAM,CAAC,CAAC;GACT;AACD,SAAO,eAAe,CAAC;CACxB;;;;;;;;AAOD,SAAS,QAAQ,CAAC,GAAG,EAAE;AACrB,MAAI,GAAG,YAAY,OAAO,EAAE;AAC1B,WAAO,GAAG,CAAC,OAAO,CAAC,WAAW,EAAE,IAAI,GAAG,CAAC,EAAE,GAAG,GAAG,GAAG,GAAG,CAAC,EAAE,GAAG,EAAE,CAAA,AAAC,CAAC;GACjE;AACD,SAAO,GAAG,CAAC;CACZ;;;;;;AAMD,SAAS,cAAc,CAAC,KAAK,EAAE,GAAG,EAAE;AAClC,MAAI,GAAG,IAAI,EAAE,EAAE;AACb,SAAK,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC;GACjB;CACF;;;;;;;;;;;;;;;;;;;;;;;;;uBClE+B,WAAW;;;;;;;AAMpC,SAAS,MAAM,CAAC,MAAM,EAAE;AAC7B,SAAO,2BAAkB,MAAM,EAAE,KAAK,EAAE,eAAe,CAAC,CAAC;CAC1D;;AAAA,CAAC;;;;;;;;;;;;;;;;;;;;;uBCZuB,WAAW;;uBACf,WAAW;;mBACT,OAAO;;;;;;;;;;AASvB,SAAS,eAAe,CAAC,GAAG,EAAE;AACnC,SAAO,oBAAW,GAAG,EAAE,cAAc,EAAE,YAAM;AAC3C,WAAO;AACL,kBAAY,EAAE,cAAS,gBACnB,GAAG,CAAC,QAAQ,CAAC,aAAa,CAAC,qBAAqB,CAAC,EAC7C,4DAA4D,CAAC,CAC5D,IAAI,CAAC,CAAC,IAAI;AACnB,gBAAU,EAAE,aAAa,CAAC,GAAG,CAAC;KAC/B,CAAC;GACH,CAAC,CAAC;CACJ;;;;;;;;;AASD,SAAS,aAAa,CAAC,GAAG,EAAE;AAC1B,SAAO,MAAM,CAAC,IAAI,CAAC,KAAK,CAAC,GAAG,CAAC,IAAI,CAAC,MAAM,EAAE,GAAG,KAAK,CAAC,CAAC,CAAC;CACtD;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AC3BM,SAAS,aAAa,CAAC,OAAO,EAAE;AACrC,MAAI,OAAO,CAAC,aAAa,EAAE;AACzB,WAAO,CAAC,aAAa,CAAC,WAAW,CAAC,OAAO,CAAC,CAAC;GAC5C;CACF;;;;;;;AAOM,SAAS,cAAc,CAAC,MAAM,EAAE;AACrC,SAAO,MAAM,CAAC,UAAU,EAAE;AACxB,UAAM,CAAC,WAAW,CAAC,MAAM,CAAC,UAAU,CAAC,CAAC;GACvC;CACF;;;;;;;;;;AAUM,SAAS,YAAY,CAAC,IAAI,EAAE,EAAE,EAAE;AACrC,MAAM,IAAI,GAAG,EAAE,CAAC,aAAa,CAAC,sBAAsB,EAAE,CAAC;AACvD,OAAK,IAAI,CAAC,GAAG,IAAI,CAAC,UAAU,EAAE,CAAC,EAAE,CAAC,GAAG,CAAC,CAAC,WAAW,EAAE;AAClD,QAAI,CAAC,WAAW,CAAC,CAAC,CAAC,SAAS,CAAC,IAAI,CAAC,CAAC,CAAC;GACrC;AACD,IAAE,CAAC,WAAW,CAAC,IAAI,CAAC,CAAC;CACtB;;;;;;;;;;AAUM,SAAS,OAAO,CAAC,OAAO,EAAE,QAAQ,EAAE;AACzC,OAAK,IAAI,EAAE,GAAG,OAAO,EAAE,EAAE,EAAE,EAAE,GAAG,EAAE,CAAC,aAAa,EAAE;AAChD,QAAI,QAAQ,CAAC,EAAE,CAAC,EAAE;AAChB,aAAO,EAAE,CAAC;KACX;GACF;AACD,SAAO,IAAI,CAAC;CACb;;;;;;;;;;AAUM,SAAS,YAAY,CAAC,OAAO,EAAE,OAAO,EAAE;AAC7C,SAAO,GAAG,OAAO,CAAC,WAAW,EAAE,CAAC;AAChC,SAAO,OAAO,CAAC,OAAO,EAAE,UAAA,EAAE,EAAI;AAC5B,WAAO,EAAE,CAAC,OAAO,IAAI,OAAO,CAAC;GAC9B,CAAC,CAAC;CACJ;;;;;;;;;AASM,SAAS,YAAY,CAAC,OAAO,EAAE,OAAO,EAAE;AAC7C,MAAM,QAAQ,GAAG,OAAO,CAAC,oBAAoB,CAAC,OAAO,CAAC,CAAC;AACvD,SAAO,QAAQ,CAAC,MAAM,GAAG,CAAC,GAAG,QAAQ,CAAC,CAAC,CAAC,GAAG,IAAI,CAAC;CACjD;;;;;;;;;AASM,SAAS,YAAY,CAAC,MAAM,EAAE,QAAQ,EAAE;AAC7C,MAAM,QAAQ,GAAG,MAAM,CAAC,QAAQ,CAAC;AACjC,OAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,QAAQ,CAAC,MAAM,EAAE,CAAC,EAAE,EAAE;AACxC,QAAI,QAAQ,CAAC,QAAQ,CAAC,CAAC,CAAC,CAAC,EAAE;AACzB,aAAO,QAAQ,CAAC,CAAC,CAAC,CAAC;KACpB;GACF;AACD,SAAO,IAAI,CAAC;CACb;;;;;;;;;;;AAWM,SAAS,kBAAkB,CAAC,MAAM,EAAE,IAAI,EAAE,SAAS,EAAE;AAC1D,SAAO,YAAY,CAAC,MAAM,EAAE,UAAA,EAAE,EAAI;AAChC,QAAI,CAAC,EAAE,CAAC,YAAY,CAAC,IAAI,CAAC,EAAE;AAC1B,aAAO,KAAK,CAAC;KACd;AACD,QAAI,SAAS,KAAK,SAAS,IAAI,EAAE,CAAC,YAAY,CAAC,IAAI,CAAC,IAAI,SAAS,EAAE;AACjE,aAAO,KAAK,CAAC;KACd;AACD,WAAO,IAAI,CAAC;GACb,CAAC,CAAC;CACJ;;;;;;;;;AASM,SAAS,iBAAiB,CAAC,MAAM,EAAE,OAAO,EAAE;AACjD,SAAO,GAAG,OAAO,CAAC,WAAW,EAAE,CAAC;AAChC,SAAO,YAAY,CAAC,MAAM,EAAE,UAAA,EAAE,EAAI;AAChC,WAAO,EAAE,CAAC,OAAO,IAAI,OAAO,CAAC;GAC9B,CAAC,CAAC;CACJ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;uBC/HoB,WAAW;;;;;AAMzB,IAAM,MAAM,GAAG;AACpB,WAAS,EAAE,WAAW;AACtB,OAAK,EAAE,OAAO;AACd,cAAY,EAAE,cAAc;AAC5B,YAAU,EAAE,YAAY;AACxB,WAAS,EAAE,WAAW;AACtB,MAAI,EAAE,MAAM;CACb,CAAC;;;;;;;AAOF,IAAI,SAAS,YAAA,CAAC;;;;;;;;AASd,IAAI,aAAa,YAAA,CAAC;;;;;;;;;;;;AAaX,IAAM,kBAAkB,GAAG;AAChC,aAAW,EAAE,EAAC,KAAK,EAAE,KAAK,EAAE,MAAM,EAAE,KAAK,EAAC;AAC1C,iBAAe,EAAE,EAAC,KAAK,EAAE,KAAK,EAAE,MAAM,EAAE,KAAK,EAAC;;AAE9C,aAAW,EAAE,IAAI;CAClB,CAAC;;;;;;;;;AASK,IAAM,iBAAiB,GAAG;AAC/B,YAAU,EAAE,IAAI;AAChB,kBAAgB,EAAE,IAAI;AACtB,cAAY,EAAE,IAAI;AAClB,WAAS,EAAE,IAAI;AACf,iBAAe,EAAE,IAAI;AACrB,YAAU,EAAE,IAAI;AAChB,iBAAe,EAAE,IAAI;AACrB,aAAW,EAAE,IAAI;CAClB,CAAC;;;;;;;;;AAQK,SAAS,WAAW,CAAC,CAAC,EAAE;AAC7B,OAAK,IAAM,CAAC,IAAI,MAAM,EAAE;AACtB,QAAI,MAAM,CAAC,CAAC,CAAC,IAAI,CAAC,EAAE;AAClB,aAAO,MAAM,CAAC,CAAC,CAAC,CAAC;KAClB;GACF;AACD,SAAO,SAAS,CAAC;CAClB;;;;;;;AAOM,SAAS,cAAc,CAAC,MAAM,EAAE;AACrC,SAAO,cAAc,GAAG,MAAM,CAAC;CAChC;;;;;;;;AAQM,SAAS,mBAAmB,CAAC,MAAM,EAAE;AAC1C,SAAQ,MAAM,IAAI,MAAM,CAAC,KAAK,IAC1B,MAAM,IAAI,MAAM,CAAC,YAAY,IAC7B,MAAM,IAAI,MAAM,CAAC,UAAU,IAC3B,MAAM,IAAI,MAAM,CAAC,IAAI,CAAE;CAC5B;;;;;;;;AAQM,SAAS,iBAAiB,CAAC,GAAG,EAAE;AACrC,MAAM,OAAO,GAAG,AAAC,OAAO,GAAG,IAAI,QAAQ,GAAI,GAAG,GAAG,GAAG,CAAC,OAAO,CAAC;AAC7D,SAAO,OAAO,IAAI,OAAO,CAAC,WAAW,EAAE,CAAC,OAAO,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;CAC5D;;;;;;;;;AASM,SAAS,WAAW,CAAC,CAAC,EAAE;AAC7B,MAAI,OAAO,CAAC,IAAI,QAAQ,EAAE;AACxB,WAAO,CAAC,GAAG,IAAI,CAAC;GACjB;AACD,MAAI,CAAC,CAAC,EAAE;AACN,WAAO,SAAS,CAAC;GAClB;AACD,MAAI,CAAC,2CAA2C,CAAC,IAAI,CAAC,CAAC,CAAC,EAAE;AACxD,WAAO,SAAS,CAAC;GAClB;AACD,MAAI,eAAe,CAAC,IAAI,CAAC,CAAC,CAAC,EAAE;AAC3B,WAAO,CAAC,GAAG,IAAI,CAAC;GACjB;AACD,SAAO,CAAC,CAAC;CACV;;;;;;;;AAQM,SAAS,YAAY,CAAC,MAAM,EAAE;AACnC,kBAAO,0CAA0C,CAAC,IAAI,CAAC,MAAM,CAAC,EAC1D,0BAA0B,EAAE,MAAM,CAAC,CAAC;AACxC,SAAO,MAAM,CAAC;CACf;;;;;;;;AAQM,SAAS,cAAc,CAAC,MAAM,EAAE;AACrC,cAAY,CAAC,MAAM,CAAC,CAAC;AACrB,MAAM,CAAC,GAAG,gBAAO,MAAM,CAAC,KAAK,CAAC,SAAS,CAAC,EACpC,8BAA8B,EAAE,MAAM,CAAC,CAAC;AAC5C,SAAO,CAAC,CAAC,CAAC,CAAC,CAAC;CACb;;;;;;;;AAQM,SAAS,gBAAgB,CAAC,MAAM,EAAE;AACvC,SAAO,UAAU,CAAC,MAAM,CAAC,CAAC;CAC3B;;;;;;;;;AASM,SAAS,oBAAoB,CAAC,OAAO,EAAE;AAC5C,SAAO,GAAG,OAAO,CAAC,WAAW,EAAE,CAAC;AAChC,SAAO,kBAAkB,CAAC,OAAO,CAAC,KAAK,SAAS,CAAC;CAClD;;;;;;;;;;;AAWM,SAAS,oBAAoB,CAAC,OAAO,EAAE;AAC5C,SAAO,GAAG,OAAO,CAAC,WAAW,EAAE,CAAC;AAChC,kBAAO,kBAAkB,CAAC,OAAO,CAAC,KAAK,SAAS,CAAC,CAAC;AAClD,MAAI,CAAC,kBAAkB,CAAC,OAAO,CAAC,EAAE;AAChC,QAAM,cAAc,GAAG,OAAO,CAAC,OAAO,CAAC,QAAQ,EAAE,EAAE,CAAC,CAAC;AACrD,QAAM,IAAI,GAAG,QAAQ,CAAC,aAAa,CAAC,cAAc,CAAC,CAAC;;AAEpD,QAAI,CAAC,QAAQ,GAAG,IAAI,CAAC;AACrB,QAAI,CAAC,KAAK,CAAC,QAAQ,GAAG,UAAU,CAAC;AACjC,QAAI,CAAC,KAAK,CAAC,UAAU,GAAG,QAAQ,CAAC;AACjC,YAAQ,CAAC,IAAI,CAAC,WAAW,CAAC,IAAI,CAAC,CAAC;AAChC,sBAAkB,CAAC,OAAO,CAAC,GAAG;AAC5B,WAAK,EAAE,CAAC,IAAI,QAAO,WAAW,IAAI,CAAC,CAAA,GAAI,IAAI;AAC3C,YAAM,EAAE,CAAC,IAAI,QAAO,YAAY,IAAI,CAAC,CAAA,GAAI,IAAI;KAC9C,CAAC;AACF,YAAQ,CAAC,IAAI,CAAC,WAAW,CAAC,IAAI,CAAC,CAAC;GACjC;AACD,SAAO,kBAAkB,CAAC,OAAO,CAAC,CAAC;CACpC;;;;;;;;;;AAUM,SAAS,gBAAgB,CAAC,OAAO,EAAE;AACxC,SAAO,iBAAiB,CAAC,OAAO,CAAC,WAAW,EAAE,CAAC,IAAI,KAAK,CAAC;CAC1D;;;;;;;;;;;;;;;;;;;;oBCrOqB,QAAQ;;;AAG9B,IAAM,KAAK,GAAG,IAAI,IAAI,EAAE,CAAC,OAAO,EAAE,CAAC;;;;;;;;;;IAUtB,GAAG;;;;;;AAKH,WALA,GAAG,CAKF,GAAG,EAAE;sCALN,GAAG;;;;;;;AAWZ,QAAI,CAAC,GAAG,GAAG,GAAG,CAAC,QAAQ,GAAG,GAAG,CAAC,MAAM,GAAG,GAAG,CAAC;;;AAG3C,QAAI,CAAC,UAAU,GAAG,IAAI,CAAC,gBAAgB,EAAE,CAAC;GAC3C;;AAfU,KAAG,WAiBd,gBAAgB,GAAA,4BAAG;AACjB,QAAI,CAAC,IAAI,CAAC,GAAG,CAAC,OAAO,IAAI,CAAC,IAAI,CAAC,GAAG,CAAC,OAAO,CAAC,GAAG,EAAE;AAC9C,aAAO,KAAK,CAAC;KACd;;AAED,QAAM,KAAK,GAAG,IAAI,CAAC,GAAG,CAAC,QAAQ,CAAC,IAAI,CAAC,KAAK,CAAC,UAAU,CAAC,CAAC;AACvD,QAAM,SAAS,GAAG,KAAK,IAAI,KAAK,CAAC,CAAC,CAAC,CAAC;AACpC,QAAI,eAAS,CAAC,QAAQ,IAAI,SAAS,IAAI,GAAG,EAAE;AAC1C,aAAO,IAAI,CAAC;KACb;AACD,QAAI,IAAI,CAAC,GAAG,CAAC,QAAQ,CAAC,IAAI,IAAI,SAAS,IAAI,GAAG,EAAE;AAC9C,aAAO,IAAI,CAAC;KACb;AACD,WAAO,KAAK,CAAC;GACd;;;;;;;;;AA/BU,KAAG,WAuCd,IAAI,GAAA,cAAC,GAAG,EAAE,KAAK,EAAE,QAAQ,EAAE;AACzB,QAAI,IAAI,CAAC,UAAU,EAAE;AACnB,UAAI,EAAE,GAAG,IAAI,CAAC,GAAG,CAAC,OAAO,CAAC,GAAG,CAAC;AAC9B,UAAI,KAAK,IAAI,OAAO,EAAE;AACpB,UAAE,GAAG,IAAI,CAAC,GAAG,CAAC,OAAO,CAAC,KAAK,IAAI,EAAE,CAAC;OACnC,MAAM,IAAI,KAAK,IAAI,MAAM,EAAE;AAC1B,UAAE,GAAG,IAAI,CAAC,GAAG,CAAC,OAAO,CAAC,IAAI,IAAI,EAAE,CAAC;OAClC,MAAM,IAAI,KAAK,IAAI,MAAM,EAAE;AAC1B,UAAE,GAAG,IAAI,CAAC,GAAG,CAAC,OAAO,CAAC,IAAI,IAAI,EAAE,CAAC;OAClC;AACD,cAAQ,CAAC,OAAO,CAAC,IAAI,IAAI,EAAE,CAAC,OAAO,EAAE,GAAG,KAAK,EAAE,GAAG,GAAG,GAAG,GAAG,GAAG,CAAC,CAAC;AAChE,QAAE,CAAC,KAAK,CAAC,IAAI,CAAC,GAAG,CAAC,OAAO,EAAE,QAAQ,CAAC,CAAC;KACtC;GACF;;;;;;;AApDU,KAAG,WA0Dd,IAAI,GAAA,cAAC,GAAG,EAAE,QAAQ,EAAE;AAClB,QAAI,IAAI,CAAC,UAAU,EAAE;AACnB,UAAI,CAAC,IAAI,CAAC,GAAG,EAAE,MAAM,EAAE,KAAK,CAAC,SAAS,CAAC,KAAK,CAAC,IAAI,CAAC,SAAS,EAAE,CAAC,CAAC,CAAC,CAAC;KAClE;GACF;;;;;;;AA9DU,KAAG,WAoEd,IAAI,GAAA,cAAC,GAAG,EAAE,QAAQ,EAAE;AAClB,QAAI,IAAI,CAAC,UAAU,EAAE;AACnB,UAAI,CAAC,IAAI,CAAC,GAAG,EAAE,MAAM,EAAE,KAAK,CAAC,SAAS,CAAC,KAAK,CAAC,IAAI,CAAC,SAAS,EAAE,CAAC,CAAC,CAAC,CAAC;KAClE;GACF;;;;;;;AAxEU,KAAG,WA8Ed,IAAI,GAAA,cAAC,GAAG,EAAE,QAAQ,EAAE;AAClB,QAAI,IAAI,CAAC,UAAU,EAAE;AACnB,UAAI,CAAC,IAAI,CAAC,GAAG,EAAE,MAAM,EAAE,KAAK,CAAC,SAAS,CAAC,KAAK,CAAC,IAAI,CAAC,SAAS,EAAE,CAAC,CAAC,CAAC,CAAC;KAClE;GACF;;;;;;;;AAlFU,KAAG,WAyFd,KAAK,GAAA,eAAC,GAAG,EAAE,QAAQ,EAAE;AACnB,QAAI,IAAI,CAAC,UAAU,EAAE;AACnB,UAAI,CAAC,IAAI,CAAC,GAAG,EAAE,OAAO,EAAE,KAAK,CAAC,SAAS,CAAC,KAAK,CAAC,IAAI,CAAC,SAAS,EAAE,CAAC,CAAC,CAAC,CAAC;KACnE;GACF;;SA7FU,GAAG;;;;AA8Ff,CAAC;;AAGK,IAAM,GAAG,GAAG,IAAI,GAAG,CAAC,MAAM,CAAC,CAAC;;;;;;;;;;;;;;;;;;;;;;;;mBC9GJ,OAAO;;;;;;;AAQtC,IAAI,OAAO,YAAA,CAAC;;;AAGZ,IAAI,IAAI,GAAG,IAAI,CAAC;;;;;;;AAMT,SAAS,OAAO,GAAG;AACxB,MAAI,IAAI,EAAE;AACR,WAAO,IAAI,CAAC;GACb;AACD,SAAO,IAAI,GAAG,QAAQ,EAAE,CAAC;CAC1B;;;;;;;AAMM,SAAS,iBAAiB,CAAC,CAAC,EAAE;AACnC,MAAI,GAAG,CAAC,CAAC;CACV;;;;;;AAMD,SAAS,QAAQ,GAAG;AAClB,MAAM,UAAU,GAAG,CAAC,QAAQ,CAAC,QAAQ,IAAI,WAAW,IAC/C,QAAQ,CAAC,eAAe,IAAI,QAAQ,CAAC,eAAe,CAAC,CAAC,CAAC,IACpD,QAAQ,CAAC,eAAe,CAAC,CAAC,CAAC,CAAC,OAAO,CAAC,mBAAmB,CAAC,IAAI,CAAC,CAAC;;;;AAIlE,GAAC,CAAC,QAAQ,CAAC,aAAa,CAAC,6CAA6C,CAAC,CAAC;;AAE5E,MAAM,mBAAmB,GAAG,sBAAiB,QAAQ,CAAC,IAAI,CAAC,CAAC,aAAa,CAAC,CAAC;AAC3E,MAAM,WAAW,GAAG,mBAAmB,IAAI,SAAS,GAC9C,mBAAmB,IAAI,GAAG,GAC1B,CAAC,CAAC,QAAQ,CAAC,aAAa,CAAC,qBAAqB,CAAC,CAAC;;AAEtD,SAAO;AACL,YAAQ,EAAE,UAAU;;AAEpB,eAAW,EAAE,WAAW;AACxB,YAAQ,EAAE,OAAO,CAAC,GAAG,CAAC,QAAQ,IAAI,YAAY;AAC9C,QAAI,EAAE,MAAM,CAAC,QAAQ;GACtB,CAAC;CACH;;;;;;;;;;;;;;;;;;;;;;;;;;uBCzDoB,WAAW;;;;;;;;;;;;;AAahC,IAAI,gBAAgB,YAAA,CAAC;;;;;;;;;;;;;;;;;AAgBd,SAAS,UAAU,CAAC,GAAG,EAAE,EAAE,EAAE,WAAW,EAAE;AAC/C,MAAM,QAAQ,GAAG,WAAW,CAAC,GAAG,CAAC,CAAC;AAClC,MAAI,CAAC,GAAG,QAAQ,CAAC,EAAE,CAAC,CAAC;AACrB,MAAI,CAAC,CAAC,EAAE;AACN,KAAC,GAAG,QAAQ,CAAC,EAAE,CAAC,GAAG,EAAE,CAAC;GACvB;AACD,MAAI,CAAC,CAAC,CAAC,GAAG,EAAE;AACV,oBAAO,WAAW,EAAE,0CAA0C,EAAE,EAAE,CAAC,CAAC;AACpE,KAAC,CAAC,GAAG,GAAG,WAAW,CAAC,GAAG,CAAC,CAAC;;;AAGzB,QAAI,CAAC,CAAC,OAAO,EAAE;AACb,OAAC,CAAC,OAAO,CAAC,CAAC,CAAC,GAAG,CAAC,CAAC;KAClB;GACF;AACD,SAAO,CAAC,CAAC,GAAG,CAAC;CACd;;;;;;;;;;;;;;;;AAeM,SAAS,iBAAiB,CAAC,GAAG,EAAE,EAAE,EAAE,iBAAiB,EAAE;;;AAG5D,SAAO,OAAO,CAAC,OAAO,EAAE,CAAC,IAAI,CAAC,YAAM;AAClC,WAAO,kBAAkB,CAAC,GAAG,EAAE,EAAE,EAAE,iBAAiB,CAAC,CAAC;GACvD,CAAC,CAAC;CACJ;;;;;;;;;;AAUD,SAAS,kBAAkB,CAAC,GAAG,EAAE,EAAE,EAAE,iBAAiB,EAAE;AACtD,kBAAO,kBAAkB,CAAC,GAAG,EAAE,iBAAiB,CAAC,EAC7C,sDAAsD,GACtD,wDAAwD,GACxD,uDAAuD,EACvD,EAAE,EAAE,iBAAiB,EAAE,iBAAiB,EAAE,iBAAiB,CAAC,CAAC;AACjE,MAAM,QAAQ,GAAG,WAAW,CAAC,GAAG,CAAC,CAAC;AAClC,MAAM,CAAC,GAAG,QAAQ,CAAC,EAAE,CAAC,CAAC;AACvB,MAAI,CAAC,EAAE;;;AAGL,QAAI,CAAC,CAAC,CAAC,OAAO,EAAE;AACd,OAAC,CAAC,OAAO,GAAG,OAAO,CAAC,OAAO,CAAC,CAAC,CAAC,GAAG,CAAC,CAAC;KACpC;AACD,WAAO,CAAC,CAAC,OAAO,CAAC;GAClB;;;AAGD,MAAI,OAAO,YAAA,CAAC;AACZ,MAAM,CAAC,GAAG,IAAI,OAAO,CAAC,UAAA,CAAC,EAAI;AACzB,WAAO,GAAG,CAAC,CAAC;GACb,CAAC,CAAC;AACH,UAAQ,CAAC,EAAE,CAAC,GAAG;AACb,OAAG,EAAE,IAAI;AACT,WAAO,EAAE,CAAC;AACV,WAAO,EAAE,OAAO;GACjB,CAAC;;AAEF,SAAO,CAAC,CAAC;CACV;;;;;;;AAOD,SAAS,kBAAkB,CAAC,GAAG,EAAE,WAAW,EAAE;AAC5C,kBAAO,GAAG,CAAC,mBAAmB,EAAE,yCAAyC,CAAC,CAAC;AAC3E,SAAO,CAAC,CAAC,GAAG,CAAC,mBAAmB,CAAC,WAAW,CAAC,CAAC;CAC/C;;;;;;;;;;AASM,SAAS,8BAA8B,CAAC,GAAG,EAAE,WAAW,EAAE;AAC/D,MAAI,CAAC,GAAG,CAAC,mBAAmB,EAAE;AAC5B,OAAG,CAAC,mBAAmB,GAAG,EAAE,CAAC;GAC9B;AACD,KAAG,CAAC,mBAAmB,CAAC,WAAW,CAAC,GAAG,IAAI,CAAC;CAC7C;;;;;;;AAOD,SAAS,WAAW,CAAC,GAAG,EAAE;AACxB,MAAI,QAAQ,GAAG,GAAG,CAAC,QAAQ,CAAC;AAC5B,MAAI,CAAC,QAAQ,EAAE;AACb,YAAQ,GAAG,GAAG,CAAC,QAAQ,GAAG,EAAE,CAAC;GAC9B;AACD,SAAO,QAAQ,CAAC;CACjB;;;;;;;;AAOM,SAAS,sBAAsB,CAAC,GAAG,EAAE,EAAE,EAAE;AAC9C,MAAI,GAAG,CAAC,QAAQ,EAAE;AAChB,OAAG,CAAC,QAAQ,CAAC,EAAE,CAAC,GAAG,IAAI,CAAC;GACzB;CACF;;;;;;;;;;;;;;;;;;;;;;uBCzJoB,WAAW;;mBACA,OAAO;;uBACd,WAAW;;;;;;;;;;;AAYpC,IAAM,gBAAgB,GAAG,EAAE,CAAC;;;AAG5B,IAAM,KAAK,GAAG,aAAa,CAAC;;;AAG5B,IAAM,aAAa,GAAG,aAAa,CAAC;;;;;;IAMvB,YAAY;;;;AAGZ,WAHA,YAAY,CAGX,OAAO,EAAE;sCAHV,YAAY;;;AAKrB,QAAI,CAAC,OAAO,GAAG,OAAO,CAAC;;AAEvB,QAAI,CAAC,eAAe,EAAE,CAAC;GACxB;;;;;;;AARU,cAAY,WAWvB,MAAM,GAAA,kBAAG;AACP,WAAO,IAAI,CAAC,OAAO,CAAC,aAAa,CAAC,WAAW,CAAC;GAC/C;;;;;;;AAbU,cAAY,WAmBvB,eAAe,GAAA,2BAAG,EAEjB;;;;;;;;AAAA;;AArBU,cAAY,WA4BvB,MAAM,GAAA,gBAAC,UAAU,EAAE;AACjB,UAAM,IAAI,KAAK,CAAC,iBAAiB,CAAC,CAAC;GACpC;;;;;;;;;;;AA9BU,cAAY,WAwCvB,MAAM,GAAA,gBAAC,IAAI,EAAE;AACX,QAAI,aAAa,GAAG,IAAI,CAAC;AACzB,SAAK,IAAI,CAAC,GAAG,IAAI,CAAC,UAAU,EAAE,CAAC,IAAI,IAAI,EAAE,CAAC,GAAG,CAAC,CAAC,WAAW,EAAE;AAC1D,UAAI,CAAC,CAAC,QAAQ,cAAe,CAAC,EAAE;AAC9B,YAAI,CAAC,CAAC,WAAW,CAAC,IAAI,EAAE,EAAE;;AAExB,uBAAa,GAAG,IAAI,CAAC;AACrB,gBAAM;SACP;OACF,MAAM,IAAI,CAAC,CAAC,QAAQ,iBAAkB,CAAC,EAAE;;OAEzC,MAAM,IAAI,CAAC,CAAC,QAAQ,iBAAkB,CAAC,EAAE;AACxC,cAAI,CAAC,aAAa,EAAE;AAClB,yBAAa,0BAA4B,CAAC,AAAC,CAAC;WAC7C,MAAM;;AAEL,yBAAa,GAAG,IAAI,CAAC;AACrB,kBAAM;WACP;SACF,MAAM;AACL,uBAAa,GAAG,IAAI,CAAC;SACtB;KACF;AACD,WAAO,aAAa,IAAI,IAAI,CAAC;GAC9B;;SAhEU,YAAY;;;;;IAsEZ,SAAS;;;AAET,WAFA,SAAS,CAER,GAAG,EAAE;sCAFN,SAAS;;;AAIlB,QAAI,CAAC,IAAI,GAAG,GAAG,CAAC;;;;;;AAMhB,QAAI,CAAC,iBAAiB,GAAG,EAAE,CAAC;;;;;;;AAO5B,QAAI,CAAC,uBAAuB,GAAG,EAAE,CAAC;;;AAGlC,QAAI,CAAC,kBAAkB,CAAC;GACzB;;;;;;;;;;;;;;;;;;AArBU,WAAS,WA6BpB,cAAc,GAAA,wBAAC,eAAe,EAAE,IAAI,EAAE;AACpC,WAAO,IAAI,CAAC,kBAAkB,CAAC,eAAe,CAAC,CAAC,IAAI,CAAC,UAAA,IAAI,EAAI;AAC3D,aAAO,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC,CAAC;KAC1B,CAAC,CAAC;GACJ;;;;;;;;;;AAjCU,WAAS,WA0CpB,mBAAmB,GAAA,6BAAC,eAAe,EAAE,KAAK,EAAE;AAC1C,QAAI,KAAK,CAAC,MAAM,IAAI,CAAC,EAAE;AACrB,aAAO,OAAO,CAAC,OAAO,CAAC,EAAE,CAAC,CAAC;KAC5B;AACD,WAAO,IAAI,CAAC,kBAAkB,CAAC,eAAe,CAAC,CAAC,IAAI,CAAC,UAAA,IAAI,EAAI;AAC3D,aAAO,KAAK,CAAC,GAAG,CAAC,UAAA,IAAI,EAAI;AACvB,eAAO,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC,CAAC;OAC1B,CAAC,CAAC;KACJ,CAAC,CAAC;GACJ;;;;;;;;;;;;AAnDU,WAAS,WA8DpB,qBAAqB,GAAA,+BAAC,MAAM,EAAE,IAAI,EAAE;AAClC,WAAO,IAAI,CAAC,cAAc,CAAC,IAAI,CAAC,aAAa,CAAC,MAAM,CAAC,EAAE,IAAI,CAAC,CAAC;GAC9D;;;;;;;;;;;;;AAhEU,WAAS,WA4EpB,0BAA0B,GAAA,oCAAC,MAAM,EAAE,KAAK,EAAE;AACxC,WAAO,IAAI,CAAC,mBAAmB,CAAC,IAAI,CAAC,aAAa,CAAC,MAAM,CAAC,EAAE,KAAK,CAAC,CAAC;GACpE;;;;;;;;;;;AA9EU,WAAS,WAwFpB,aAAa,GAAA,uBAAC,MAAM,EAAE;AACpB,QAAI,eAAe,GAAG,IAAI,CAAC;AAC3B,QAAM,UAAU,GAAG,MAAM,CAAC,YAAY,CAAC,UAAU,CAAC,CAAC;AACnD,QAAI,UAAU,EAAE;AACd,qBAAe,GAAG,MAAM,CAAC,aAAa,CAAC,cAAc,CAAC,UAAU,CAAC,CAAC;KACnE,MAAM;AACL,qBAAe,GAAG,uBAAkB,MAAM,EAAE,UAAU,CAAC,CAAC;KACzD;AACD,oBAAO,eAAe,EAAE,2BAA2B,EAAE,MAAM,CAAC,CAAC;AAC7D,oBAAO,eAAe,CAAC,OAAO,IAAI,UAAU,EACxC,8CAA8C,EAAE,eAAe,CAAC,CAAC;AACrE,WAAO,eAAe,CAAC;GACxB;;;;;;;;;;AApGU,WAAS,WA6GpB,kBAAkB,GAAA,4BAAC,OAAO,EAAE;AAC1B,QAAM,IAAI,GAAG,OAAO,CAAC,KAAK,CAAC,CAAC;AAC5B,QAAI,IAAI,EAAE;AACR,aAAO,OAAO,CAAC,OAAO,CAAC,IAAI,CAAC,CAAC;KAC9B;;AAED,QAAM,IAAI,GAAG,gBAAO,OAAO,CAAC,YAAY,CAAC,MAAM,CAAC,EAC5C,4BAA4B,EAAE,OAAO,CAAC,CAAC;;AAE3C,QAAI,OAAO,GAAG,OAAO,CAAC,aAAa,CAAC,CAAC;AACrC,QAAI,OAAO,EAAE;AACX,aAAO,OAAO,CAAC;KAChB;;AAED,WAAO,GAAG,IAAI,CAAC,qBAAqB,CAAC,OAAO,EAAE,IAAI,CAAC,CAAC,IAAI,CAAC,UAAA,aAAa,EAAI;AACxE,UAAM,IAAI,GAAG,OAAO,CAAC,KAAK,CAAC,GAAG,IAAI,aAAa,CAAC,OAAO,CAAC,CAAC;AACzD,aAAO,OAAO,CAAC,aAAa,CAAC,CAAC;AAC9B,aAAO,IAAI,CAAC;KACb,CAAC,CAAC;AACH,WAAO,CAAC,aAAa,CAAC,GAAG,OAAO,CAAC;AACjC,WAAO,OAAO,CAAC;GAChB;;;;;;;;;;;AAlIU,WAAS,WA4IpB,qBAAqB,GAAA,+BAAC,OAAO,EAAE,IAAI,EAAE;AACnC,QAAI,IAAI,CAAC,iBAAiB,CAAC,IAAI,CAAC,EAAE;AAChC,aAAO,IAAI,CAAC,iBAAiB,CAAC,IAAI,CAAC,CAAC;KACrC;;AAED,QAAI,CAAC,sBAAsB,CAAC,OAAO,EAAE,IAAI,CAAC,CAAC;AAC3C,QAAI,QAAQ,YAAA,CAAC;AACb,QAAM,OAAO,GAAG,IAAI,OAAO,CAAC,UAAC,OAAO,EAAE,YAAY,EAAK;AACrD,cAAQ,GAAG,OAAO,CAAC;KACpB,CAAC,CAAC;AACH,QAAI,CAAC,iBAAiB,CAAC,IAAI,CAAC,GAAG,OAAO,CAAC;AACvC,QAAI,CAAC,uBAAuB,CAAC,IAAI,CAAC,GAAG,QAAQ,CAAC;AAC9C,WAAO,OAAO,CAAC;GAChB;;;;;;;;;;AAzJU,WAAS,WAmKpB,sBAAsB,GAAA,gCAAC,OAAO,EAAE,IAAI,EAAE;AACpC,QAAI,CAAC,IAAI,CAAC,kBAAkB,EAAE;AAC5B,UAAI,CAAC,kBAAkB,GAAG,IAAI,CAAC,IAAI,CAAC,MAAM,CAAC,MAAM,CAAC,IAAI,CAAC,CAAC;AACxD,UAAM,UAAU,GAAG,IAAI,CAAC,IAAI,CAAC,QAAQ,CAAC,gBAAgB,CAClD,yBAAyB,CAAC,CAAC;AAC/B,WAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,UAAU,CAAC,MAAM,EAAE,CAAC,EAAE,EAAE;AAC1C,YAAI,CAAC,kBAAkB,CAAC,UAAU,CAAC,CAAC,CAAC,CAAC,YAAY,CAC9C,iBAAiB,CAAC,CAAC,GAAG,IAAI,CAAC;OAChC;KACF;AACD,oBAAO,IAAI,CAAC,kBAAkB,CAAC,IAAI,CAAC,EAChC,iEAAiE,EACjE,OAAO,EAAE,IAAI,CAAC,CAAC;GACpB;;;;;;;;;;AAhLU,WAAS,WAyLpB,iBAAiB,GAAA,2BAAC,IAAI,EAAE,aAAa,EAAE;AACrC,QAAI,CAAC,IAAI,CAAC,iBAAiB,CAAC,IAAI,CAAC,EAAE;AACjC,UAAI,CAAC,iBAAiB,CAAC,IAAI,CAAC,GAAG,OAAO,CAAC,OAAO,CAAC,aAAa,CAAC,CAAC;KAC/D,MAAM;AACL,UAAM,QAAQ,GAAG,IAAI,CAAC,uBAAuB,CAAC,IAAI,CAAC,CAAC;AACpD,sBAAO,QAAQ,EAAE,6BAA6B,EAAE,IAAI,CAAC,CAAC;AACtD,aAAO,IAAI,CAAC,uBAAuB,CAAC,IAAI,CAAC,CAAC;AAC1C,cAAQ,CAAC,aAAa,CAAC,CAAC;KACzB;GACF;;SAlMU,SAAS;;;;;AA8Mf,SAAS,wBAAwB,CAAC,GAAG,EAAE,IAAI,EAAE,aAAa,EAAE;AACjE,SAAO,YAAY,CAAC,GAAG,CAAC,CAAC,iBAAiB,CAAC,IAAI,EAAE,aAAa,CAAC,CAAC;CACjE;;;;;;;AAOM,SAAS,YAAY,CAAC,MAAM,EAAE;AACnC,SAAO,oBAAW,MAAM,EAAE,WAAW,EAAE,YAAM;AAC3C,WAAO,IAAI,SAAS,CAAC,MAAM,CAAC,CAAC;GAC9B,CAAC,CAAC;CACJ;;AAAA,CAAC;;;;;;;;;;;;;;;;;;;;;mBC3TmB,OAAO;;4BACE,iBAAiB;;uBACtB,WAAW;;gCACK,qBAAqB;;mBAC5C,OAAO;;mBACc,OAAO;;wBACpB,YAAY;;qBACf,SAAS;;;AAGhC,IAAM,IAAI,GAAG,iBAAiB,CAAC;;;;;;IAKzB,eAAe;;;AAER,WAFP,eAAe,CAEP,GAAG,EAAE;;;sCAFb,eAAe;;;AAIjB,QAAI,CAAC,IAAI,GAAG,GAAG,CAAC;;;AAGhB,QAAI,CAAC,gBAAgB,CAAC;;;AAGtB,QAAI,CAAC,aAAa,GAAG,IAAI,CAAC,IAAI,CAAC,MAAM,CAAC,MAAM,CAAC,IAAI,CAAC,CAAC;;;AAGnD,QAAI,CAAC,IAAI,CAAC,QAAQ,EAAE,YAAM;AACxB,aAAO,IAAI,CAAC,MAAM,EAAE,CAAC;KACtB,CAAC,CAAC;;;AAGH,QAAI,CAAC,IAAI,CAAC,eAAe,EAAE,YAAM;AAC/B,aAAO,8BAAgB,MAAK,IAAI,CAAC,CAAC,YAAY,CAAC;KAChD,CAAC,CAAC;;;AAGH,QAAI,CAAC,IAAI,CAAC,gBAAgB,EAAE,YAAM;AAChC,UAAM,GAAG,GAAG,cAAS,8BAAgB,MAAK,IAAI,CAAC,CAAC,YAAY,CAAC,CAAC;AAC9D,aAAO,GAAG,IAAI,GAAG,CAAC,QAAQ,CAAC;KAC5B,CAAC,CAAC;;;AAGH,QAAI,CAAC,IAAI,CAAC,gBAAgB,EAAE,YAAM;AAChC,UAAM,GAAG,GAAG,cAAS,8BAAgB,MAAK,IAAI,CAAC,CAAC,YAAY,CAAC,CAAC;AAC9D,aAAO,GAAG,IAAI,GAAG,CAAC,QAAQ,CAAC;KAC5B,CAAC,CAAC;;;AAGH,QAAI,CAAC,IAAI,CAAC,mBAAmB,EAAE,YAAM;AACnC,aAAO,MAAK,IAAI,CAAC,QAAQ,CAAC,QAAQ,CAAC;KACpC,CAAC,CAAC;;;AAGH,QAAI,CAAC,IAAI,CAAC,OAAO,EAAE,YAAM;AACvB,aAAO,MAAK,IAAI,CAAC,QAAQ,CAAC,KAAK,CAAC;KACjC,CAAC,CAAC;;;AAGH,QAAI,CAAC,IAAI,CAAC,YAAY,EAAE,YAAM;AAC5B,aAAO,oBAAe,MAAK,IAAI,CAAC,QAAQ,CAAC,IAAI,CAAC,CAAC;KAChD,CAAC,CAAC;;;AAGH,QAAI,CAAC,IAAI,CAAC,aAAa,EAAE,YAAM;AAC7B,UAAM,GAAG,GAAG,cAAS,MAAK,IAAI,CAAC,QAAQ,CAAC,IAAI,CAAC,CAAC;AAC9C,aAAO,GAAG,IAAI,GAAG,CAAC,QAAQ,CAAC;KAC5B,CAAC,CAAC;;;;;AAKH,QAAI,CAAC,IAAI,CAAC,cAAc,EAAE,YAAM;AAC9B,aAAO,8BAAgB,MAAK,IAAI,CAAC,CAAC,UAAU,CAAC;KAC9C,CAAC,CAAC;;AAEH,QAAI,CAAC,IAAI,CAAC,WAAW,EAAE,UAAC,QAAQ,EAAE,sBAAsB,EAAK;AAC3D,UAAI,OAAO,GAAG,OAAO,CAAC,OAAO,EAAE,CAAC;;;;AAIhC,UAAI,sBAAsB,EAAE;AAC1B,eAAO,GAAG,6CAA2B,MAAK,IAAI,CAAC,CAAC,IAAI,CAAC,UAAA,OAAO,EAAI;AAC9D,iBAAO,OAAO,CAAC,GAAG,CAAC,sBAAsB,CAAC,CAAC;SAC5C,CAAC,CAAC;OACJ;;AAED,aAAO,YAAO,MAAK,IAAI,CAAC,CAAC,IAAI,CAAC,UAAA,GAAG,EAAI;AACnC,eAAO,GAAG,CAAC,GAAG,CAAC,QAAQ,EAAE,OAAO,CAAC,CAAC;OACnC,CAAC,CAAC;KACJ,CAAC,CAAC;;;AAGH,QAAI,CAAC,IAAI,CAAC,WAAW,EAAE,YAAM;AAC3B,aAAO,IAAI,IAAI,EAAE,CAAC,OAAO,EAAE,CAAC;KAC7B,CAAC,CAAC;;;AAGH,QAAI,CAAC,IAAI,CAAC,UAAU,EAAE,YAAM;AAC1B,aAAO,IAAI,IAAI,EAAE,CAAC,iBAAiB,EAAE,CAAC;KACvC,CAAC,CAAC;;;AAGH,QAAI,CAAC,IAAI,CAAC,YAAY,EAAE,YAAM;AAC5B,aAAO,gBAAS,MAAK,IAAI,CAAC,CAAC,cAAc,CACvC;eAAM,sBAAY,MAAK,IAAI,CAAC,CAAC,YAAY,EAAE;OAAA,CAAC,CAAC;KAChD,CAAC,CAAC;;;AAGH,QAAI,CAAC,IAAI,CAAC,aAAa,EAAE,YAAM;AAC7B,aAAO,gBAAS,MAAK,IAAI,CAAC,CAAC,cAAc,CACvC;eAAM,sBAAY,MAAK,IAAI,CAAC,CAAC,aAAa,EAAE;OAAA,CAAC,CAAC;KACjD,CAAC,CAAC;;;AAGH,QAAI,CAAC,IAAI,CAAC,eAAe,EAAE,YAAM;AAC/B,aAAO,gBAAS,MAAK,IAAI,CAAC,CAAC,cAAc,CACvC;eAAM,sBAAY,MAAK,IAAI,CAAC,CAAC,eAAe,EAAE;OAAA,CAAC,CAAC;KACnD,CAAC,CAAC;;;AAGH,QAAI,CAAC,IAAI,CAAC,cAAc,EAAE,YAAM;AAC9B,aAAO,MAAK,IAAI,CAAC,MAAM,CAAC,KAAK,CAAC;KAC/B,CAAC,CAAC;;;AAGH,QAAI,CAAC,IAAI,CAAC,eAAe,EAAE,YAAM;AAC/B,aAAO,MAAK,IAAI,CAAC,MAAM,CAAC,MAAM,CAAC;KAChC,CAAC,CAAC;GACJ;;;;;;;;;;;;;;;;AAnHG,iBAAe,WA6HnB,IAAI,GAAA,cAAC,OAAO,EAAE,QAAQ,EAAE;AACtB,QAAI,CAAC,aAAa,CAAC,OAAO,CAAC,GAAG,QAAQ,CAAC;AACvC,QAAI,CAAC,gBAAgB,GAAG,SAAS,CAAC;AAClC,WAAO,IAAI,CAAC;GACb;;;;;;;;;;;AAjIG,iBAAe,WA2InB,MAAM,GAAA,gBAAC,GAAG,EAAE,YAAY,EAAE;;;AACxB,QAAM,IAAI,GAAG,IAAI,CAAC,QAAQ,CAAC,YAAY,CAAC,CAAC;AACzC,QAAI,kBAAkB,YAAA,CAAC;AACvB,QAAM,WAAW,GAAG,UAAA,GAAG,EAAI;;;AAGzB,UAAI,CAAC,GAAG,IAAI,GAAG,KAAK,CAAC,EAAE;AACrB,WAAG,GAAG,EAAE,CAAC;OACV;AACD,aAAO,kBAAkB,CAAC,GAAG,CAAC,CAAC;KAChC,CAAC;AACF,OAAG,GAAG,GAAG,CAAC,OAAO,CAAC,IAAI,EAAE,UAAC,KAAK,EAAE,IAAI,EAAE,WAAW,EAAK;AACpD,UAAI,IAAI,GAAG,EAAE,CAAC;AACd,UAAI,OAAO,WAAW,IAAI,QAAQ,EAAE;AAClC,YAAI,GAAG,WAAW,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC;OAC/B;AACD,UAAM,GAAG,GACL,AAAC,IAAI,CAAC,MAAM,IAAI,CAAC,IAAI,YAAY,IAAK,IAAI,IAAI,YAAY,AAAC,GAC3D,YAAY,CAAC,IAAI,CAAC,GAClB,OAAK,aAAa,CAAC,IAAI,CAAC,CAAC,KAAK,CAAC,OAAK,aAAa,EAAE,IAAI,CAAC,CAAC;;;AAG7D,UAAI,GAAG,IAAI,GAAG,CAAC,IAAI,EAAE;;AACnB,cAAM,CAAC,GAAG,GAAG,CAAC,IAAI,CAAC,UAAA,CAAC,EAAI;AACtB,eAAG,GAAG,GAAG,CAAC,OAAO,CAAC,KAAK,EAAE,WAAW,CAAC,CAAC,CAAC,CAAC,CAAC;WAC1C,EAAE,UAAA,GAAG,EAAI;AACR,qBAAI,KAAK,CAAC,IAAI,EAAE,oBAAoB,GAAG,IAAI,EAAE,GAAG,CAAC,CAAC;WACnD,CAAC,CAAC;AACH,cAAI,kBAAkB,EAAE;AACtB,8BAAkB,GAAG,kBAAkB,CAAC,IAAI,CAAC;qBAAM,CAAC;aAAA,CAAC,CAAC;WACvD,MAAM;AACL,8BAAkB,GAAG,CAAC,CAAC;WACxB;AACD;eAAO,KAAK;YAAC;;;;OACd;AACD,aAAO,WAAW,CAAC,GAAG,CAAC,CAAC;KACzB,CAAC,CAAC;;AAEH,QAAI,kBAAkB,EAAE;AACtB,wBAAkB,GAAG,kBAAkB,CAAC,IAAI,CAAC;eAAM,GAAG;OAAA,CAAC,CAAC;KACzD;;AAED,WAAO,kBAAkB,IAAI,OAAO,CAAC,OAAO,CAAC,GAAG,CAAC,CAAC;GACnD;;;;;;;;AAtLG,iBAAe,WA6LnB,QAAQ,GAAA,kBAAC,YAAY,EAAE;;;AACrB,QAAM,cAAc,GAAG,YAAY,GAAG,MAAM,CAAC,IAAI,CAAC,YAAY,CAAC,GAAG,IAAI,CAAC;AACvE,QAAI,cAAc,IAAI,cAAc,CAAC,MAAM,GAAG,CAAC,EAAE;;AAC/C,YAAM,OAAO,GAAG,MAAM,CAAC,IAAI,CAAC,OAAK,aAAa,CAAC,CAAC;AAChD,sBAAc,CAAC,OAAO,CAAC,UAAA,GAAG,EAAI;AAC5B,cAAI,OAAO,CAAC,GAAG,CAAC,KAAK,SAAS,EAAE;AAC9B,mBAAO,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC;WACnB;SACF,CAAC,CAAC;AACH;aAAO,OAAK,UAAU,CAAC,OAAO,CAAC;UAAC;;;;KACjC;AACD,QAAI,CAAC,IAAI,CAAC,gBAAgB,EAAE;AAC1B,UAAI,CAAC,gBAAgB,GAAG,IAAI,CAAC,UAAU,CAAC,MAAM,CAAC,IAAI,CAAC,IAAI,CAAC,aAAa,CAAC,CAAC,CAAC;KAC1E;AACD,WAAO,IAAI,CAAC,gBAAgB,CAAC;GAC9B;;;;;;;;AA5MG,iBAAe,WAmNnB,UAAU,GAAA,oBAAC,IAAI,EAAE;AACf,QAAM,GAAG,GAAG,IAAI,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC;;;;;;;AAO3B,WAAO,IAAI,MAAM,CAAC,OAAO,GAAG,GAAG,GAAG,+BAA+B,EAAE,GAAG,CAAC,CAAC;GACzE;;SA5NG,eAAe;;;AAmOd,SAAS,kBAAkB,CAAC,MAAM,EAAE;AACzC,SAAO,oBAAW,MAAM,EAAE,aAAa,EAAE,YAAM;AAC7C,WAAO,IAAI,eAAe,CAAC,MAAM,CAAC,CAAC;GACpC,CAAC,CAAC;CACJ;;AAAA,CAAC;;;;;;;;;;;;;;;;;;;;;;;;;uBCtPmB,WAAW;;;;;;;;;AASzB,SAAS,QAAQ,CAAC,GAAG,EAAE;AAC5B,MAAM,CAAC,GAAG,QAAQ,CAAC,aAAa,CAAC,GAAG,CAAC,CAAC;AACtC,GAAC,CAAC,IAAI,GAAG,GAAG,CAAC;AACb,MAAM,IAAI,GAAG;AACX,QAAI,EAAE,CAAC,CAAC,IAAI;AACZ,YAAQ,EAAE,CAAC,CAAC,QAAQ;AACpB,QAAI,EAAE,CAAC,CAAC,IAAI;AACZ,YAAQ,EAAE,CAAC,CAAC,QAAQ;AACpB,QAAI,EAAE,CAAC,CAAC,IAAI,IAAI,GAAG,GAAG,EAAE,GAAG,CAAC,CAAC,IAAI;AACjC,YAAQ,EAAE,CAAC,CAAC,QAAQ;AACpB,UAAM,EAAE,CAAC,CAAC,MAAM;AAChB,QAAI,EAAE,CAAC,CAAC,IAAI;GACb,CAAC;;;AAGF,MAAI,CAAC,MAAM,GAAG,AAAC,CAAC,CAAC,MAAM,IAAI,CAAC,CAAC,MAAM,IAAI,MAAM,GAAI,CAAC,CAAC,MAAM,GAAG,SAAS,CAAC,IAAI,CAAC,CAAC;AAC5E,kBAAO,IAAI,CAAC,MAAM,EAAE,mBAAmB,CAAC,CAAC;AACzC,SAAO,IAAI,CAAC;CACb;;;;;;;;;;AAUM,SAAS,cAAc,CAAC,SAAS,EAAE,cAAc,EAAE;AACxD,MAAM,GAAG,GAAG,QAAQ,CAAC,SAAS,CAAC,CAAC;AAChC,kBACI,GAAG,CAAC,QAAQ,IAAI,QAAQ,IAAI,SAAS,CAAC,IAAI,CAAC,SAAS,CAAC,IACrD,GAAG,CAAC,QAAQ,IAAI,WAAW,IACvB,GAAG,CAAC,QAAQ,CAAC,WAAW,CAAC,YAAY,CAAC;;AAEtC,KAAG,CAAC,QAAQ,CAAC,MAAM,GAAG,YAAY,CAAC,MAAM,EAC7C,4BAA4B,GAC5B,oDAAoD,GACpD,mDAAmD,EACnD,cAAc,EAAE,SAAS,CAAC,CAAC;AAC/B,SAAO,SAAS,CAAC;CAClB;;;;;;;;;AASM,SAAS,gBAAgB,CAAC,WAAW,EAAE;AAC5C,MAAM,MAAM,GAAG,MAAM,CAAC,MAAM,CAAC,IAAI,CAAC,CAAC;AACnC,MAAI,CAAC,WAAW,EAAE;AAChB,WAAO,MAAM,CAAC;GACf;AACD,MAAI,WAAW,CAAC,OAAO,CAAC,GAAG,CAAC,IAAI,CAAC,IAAI,WAAW,CAAC,OAAO,CAAC,GAAG,CAAC,IAAI,CAAC,EAAE;AAClE,eAAW,GAAG,WAAW,CAAC,MAAM,CAAC,CAAC,CAAC,CAAC;GACrC;AACD,MAAM,KAAK,GAAG,WAAW,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC;AACrC,OAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,KAAK,CAAC,MAAM,EAAE,CAAC,EAAE,EAAE;AACrC,QAAM,IAAI,GAAG,KAAK,CAAC,CAAC,CAAC,CAAC;AACtB,QAAM,OAAO,GAAG,IAAI,CAAC,OAAO,CAAC,GAAG,CAAC,CAAC;AAClC,QAAI,KAAI,YAAA,CAAC;AACT,QAAI,KAAK,YAAA,CAAC;AACV,QAAI,OAAO,IAAI,CAAC,CAAC,EAAE;AACjB,WAAI,GAAG,kBAAkB,CAAC,IAAI,CAAC,SAAS,CAAC,CAAC,EAAE,OAAO,CAAC,CAAC,CAAC,IAAI,EAAE,CAAC;AAC7D,WAAK,GAAG,kBAAkB,CAAC,IAAI,CAAC,SAAS,CAAC,OAAO,GAAG,CAAC,CAAC,CAAC,CAAC,IAAI,EAAE,CAAC;KAChE,MAAM;AACL,WAAI,GAAG,kBAAkB,CAAC,IAAI,CAAC,CAAC,IAAI,EAAE,CAAC;AACvC,WAAK,GAAG,EAAE,CAAC;KACZ;AACD,QAAI,KAAI,EAAE;AACR,YAAM,CAAC,KAAI,CAAC,GAAG,KAAK,CAAC;KACtB;GACF;AACD,SAAO,MAAM,CAAC;CACf;;;;;;;;;;;AAWM,SAAS,SAAS,CAAC,IAAI,EAAE;AAC9B,MAAI,IAAI,CAAC,QAAQ,IAAI,OAAO,IAAI,CAAC,IAAI,CAAC,IAAI,EAAE;AAC1C,WAAO,IAAI,CAAC,IAAI,CAAC;GAClB;AACD,SAAO,IAAI,CAAC,QAAQ,GAAG,IAAI,GAAG,IAAI,CAAC,IAAI,CAAC;CACzC;;;;;;;;;AASM,SAAS,cAAc,CAAC,GAAG,EAAE;AAClC,MAAM,KAAK,GAAG,GAAG,CAAC,OAAO,CAAC,GAAG,CAAC,CAAC;AAC/B,MAAI,KAAK,IAAI,CAAC,CAAC,EAAE;AACf,WAAO,GAAG,CAAC;GACZ;AACD,SAAO,GAAG,CAAC,SAAS,CAAC,CAAC,EAAE,KAAK,CAAC,CAAC;CAChC;;;;;;;;;;;;;;;;;;;;;;;;;uBChH+B,WAAW;;;;;;;AAOpC,SAAS,0BAA0B,CAAC,MAAM,EAAE;AACjD,SAAO,2BAAkB,MAAM,EAAE,yBAAyB,EACtD,uBAAuB,CAAC,CAAC;CAC9B;;;;;;;;;;;;;;;;;;;;;uBCdwB,WAAW;;;;;;;AAM7B,SAAS,WAAW,CAAC,MAAM,EAAE;AAClC,SAAO,oBAAW,MAAM,EAAE,UAAU,CAAC,CAAC;CACvC;;AAAA,CAAC;;;;;;;;;;;;;;;;;;;;;uBCRuB,WAAW;;;;;;;AAO7B,SAAS,QAAQ,CAAC,MAAM,EAAE;AAC/B,SAAO,oBAAW,MAAM,EAAE,OAAO,CAAC,CAAC;CACpC;;AAAA,CAAC;;;;;;;;;;;;;;;;;;;;;;;uBCTmB,WAAW;;uBACP,WAAW;;;;;;;;;;;;;;;AAgBpC,IAAI,YAAY,YAAA,CAAC;;;AAGjB,IAAM,eAAe,GAAG,CAAC,KAAK,EAAE,MAAM,CAAC,CAAC;;;AAGxC,IAAM,iBAAiB,GAAG,CAAC,iBAAiB,EAAE,gBAAgB,CAAC,CAAC;;;;;;IAM1D,GAAG;;;;;;AAKI,WALP,GAAG,CAKK,GAAG,EAAE;sCALb,GAAG;;;;;;;AAWL,QAAI,CAAC,MAAM,GAAG,CAAC,GAAG,CAAC,KAAK,IAAI,aAAa,CAAA,CAAE,IAAI,CAAC,IAAI,CAAC,CAAC;GACvD;;;;;;;;;;;;;;;;;;;AAZG,KAAG,WAuBP,SAAS,GAAA,mBAAC,KAAK,EAAE,QAAQ,EAAE;AACzB,QAAM,IAAI,GAAG,QAAQ,IAAI,EAAE,CAAC;AAC5B,QAAI,CAAC,MAAM,GAAG,gBAAgB,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC;AAC5C,cAAU,CAAC,IAAI,CAAC,CAAC;;AAEjB,WAAO,IAAI,CAAC,MAAM,CAAC,KAAK,EAAE,IAAI,CAAC,CAAC,IAAI,CAAC,UAAA,QAAQ,EAAI;AAC/C,aAAO,aAAa,CAAC,QAAQ,CAAC,CAAC,IAAI,EAAE,CAAC;KACvC,CAAC,CAAC;GACJ;;;;;;;;;;;;AA/BG,KAAG,WA0CP,UAAU,GAAA,oBAAC,KAAK,EAAE,QAAQ,EAAE;AAC1B,WAAO,IAAI,CAAC,MAAM,CAAC,KAAK,EAAE,QAAQ,CAAC,CAAC,IAAI,CAAC,UAAA,QAAQ,EAAI;AACnD,mBAAa,CAAC,QAAQ,CAAC,CAAC;KACzB,CAAC,CAAC;GACJ;;SA9CG,GAAG;;;AAwDF,SAAS,gBAAgB,CAAC,MAAM,EAAE;AACvC,MAAI,MAAM,KAAK,SAAS,EAAE;AACxB,WAAO,KAAK,CAAC;GACd;AACD,SAAO,MAAM,CAAC,WAAW,EAAE,CAAC;CAC7B;;;;;;;AAOD,SAAS,UAAU,CAAC,IAAI,EAAE;AACxB,kBAAO,eAAe,CAAC,OAAO,CAAC,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC,CAAC,EAAE,cAAc,GAC7D,eAAe,CAAC,IAAI,CAAC,IAAI,CAAC,GAAG,+BAA+B,EAC5D,IAAI,CAAC,MAAM,CAAC,CAAC;;AAEjB,MAAI,CAAC,OAAO,GAAG;AACb,YAAQ,EAAE,kBAAkB;GAC7B,CAAC;;AAEF,MAAI,IAAI,CAAC,MAAM,IAAI,MAAM,EAAE;AACzB,QAAM,QAAQ,GAAG,MAAM,CAAC,SAAS,CAAC,QAAQ,CAAC,IAAI,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;;;;AAI3D,oBAAO,iBAAiB,CAAC,OAAO,CAAC,QAAQ,CAAC,GAAG,CAAC,CAAC,EAC3C,0CAA0C,EAC1C,IAAI,CAAC,IAAI,CAAC,CAAC;;AAEf,QAAI,CAAC,OAAO,CAAC,cAAc,CAAC,GAAG,gCAAgC,CAAC;AAChE,QAAI,CAAC,IAAI,GAAG,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;GACvC;CACF;;;;;;;;;;;;;;;;AAgBM,SAAS,aAAa,CAAC,KAAK,EAAE,QAAQ,EAAE;AAC7C,kBAAO,OAAO,KAAK,IAAI,QAAQ,EAAE,wBAAwB,EAAE,KAAK,CAAC,CAAC;AAClE,MAAM,IAAI,GAAG,QAAQ,IAAI,EAAE,CAAC;AAC5B,kBAAO,CAAC,IAAI,CAAC,WAAW,IAAI,IAAI,CAAC,WAAW,IAAI,SAAS,EACrD,sCAAsC,EAAE,IAAI,CAAC,WAAW,CAAC,CAAC;;AAE9D,SAAO,IAAI,OAAO,CAAC,UAAS,OAAO,EAAE,MAAM,EAAE;AAC3C,QAAM,GAAG,GAAG,gBAAgB,CAAC,IAAI,CAAC,MAAM,IAAI,KAAK,EAAE,KAAK,EAAE,IAAI,CAAC,CAAC;;AAEhE,QAAI,IAAI,CAAC,WAAW,IAAI,SAAS,EAAE;AACjC,SAAG,CAAC,eAAe,GAAG,IAAI,CAAC;KAC5B;;AAED,OAAG,CAAC,kBAAkB,GAAG,YAAM;AAC7B,UAAI,GAAG,CAAC,UAAU,wBAAyB,CAAC,EAAE;AAC5C,eAAO;OACR;AACD,UAAI,GAAG,CAAC,MAAM,GAAG,GAAG,IAAI,GAAG,CAAC,MAAM,GAAG,GAAG,EAAE;AACxC,WAAG,CAAC,kBAAkB,GAAG,IAAI,CAAC;AAC9B,cAAM,CAAC,IAAI,KAAK,0BAAwB,GAAG,CAAC,MAAM,CAAG,CAAC,CAAC;AACvD,eAAO;OACR;;;;;AAKD,UAAI,GAAG,CAAC,UAAU,kBAAmB,CAAC,EAAE;AACtC,eAAO,CAAC,IAAI,aAAa,CAAC,GAAG,CAAC,CAAC,CAAC;OACjC;KACF,CAAC;AACF,OAAG,CAAC,OAAO,GAAG,YAAM;AAClB,YAAM,CAAC,IAAI,KAAK,CAAC,iBAAiB,CAAC,CAAC,CAAC;KACtC,CAAC;AACF,OAAG,CAAC,OAAO,GAAG,YAAM;AAClB,YAAM,CAAC,IAAI,KAAK,CAAC,iBAAiB,CAAC,CAAC,CAAC;KACtC,CAAC;;AAEF,QAAI,IAAI,CAAC,MAAM,IAAI,MAAM,EAAE;AACzB,SAAG,CAAC,IAAI,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;KACrB,MAAM;AACL,SAAG,CAAC,IAAI,EAAE,CAAC;KACZ;GACF,CAAC,CAAC;CACJ;;;;;;;;;AAUD,SAAS,gBAAgB,CAAC,MAAM,EAAE,GAAG,EAAE,IAAI,EAAE;AAC3C,MAAI,GAAG,GAAG,IAAI,cAAc,EAAE,CAAC;AAC/B,MAAI,iBAAiB,IAAI,GAAG,EAAE;AAC5B,OAAG,CAAC,IAAI,CAAC,MAAM,EAAE,GAAG,EAAE,IAAI,CAAC,CAAC;GAC7B,MAAM,IAAI,OAAO,cAAc,IAAI,WAAW,EAAE;;AAE/C,OAAG,GAAG,IAAI,cAAc,EAAE,CAAC;AAC3B,OAAG,CAAC,IAAI,CAAC,MAAM,EAAE,GAAG,CAAC,CAAC;GACvB,MAAM;AACL,UAAM,IAAI,KAAK,CAAC,uBAAuB,CAAC,CAAC;GAC1C;;AAED,MAAI,IAAI,CAAC,OAAO,EAAE;AAChB,UAAM,CAAC,IAAI,CAAC,IAAI,CAAC,OAAO,CAAC,CAAC,OAAO,CAAC,UAAS,MAAM,EAAE;AACjD,SAAG,CAAC,gBAAgB,CAAC,MAAM,EAAE,IAAI,CAAC,OAAO,CAAC,MAAM,CAAC,CAAC,CAAC;KACpD,CAAC,CAAC;GACJ;AACD,SAAO,GAAG,CAAC;CACZ;;;;;;;AAQD,SAAS,aAAa,CAAC,QAAQ,EAAE;AAC/B,MAAI,QAAQ,CAAC,MAAM,GAAG,GAAG,IAAI,QAAQ,CAAC,MAAM,GAAG,GAAG,EAAE;AAClD,UAAM,IAAI,KAAK,iBAAe,QAAQ,CAAC,MAAM,CAAG,CAAC;GAClD;AACD,SAAO,QAAQ,CAAC;CACjB;;;;;;;;IAQK,aAAa;;;;;AAIN,WAJP,aAAa,CAIL,GAAG,EAAE;sCAJb,aAAa;;;AAMf,QAAI,CAAC,IAAI,GAAG,GAAG,CAAC;;;AAGhB,QAAI,CAAC,MAAM,GAAG,IAAI,CAAC,IAAI,CAAC,MAAM,CAAC;;;AAG/B,QAAI,CAAC,QAAQ,GAAG,KAAK,CAAC;GACvB;;;;;;;;;;;;;AAbG,eAAa,WAoBjB,UAAU,GAAA,sBAAG;AACX,oBAAO,CAAC,IAAI,CAAC,QAAQ,EAAE,mBAAmB,CAAC,CAAC;AAC5C,QAAI,CAAC,QAAQ,GAAG,IAAI,CAAC;AACrB,WAAO,OAAO,CAAC,OAAO,CAAC,IAAI,CAAC,IAAI,CAAC,YAAY,CAAC,CAAC;GAChD;;;;;;;AAxBG,eAAa,WA8BjB,IAAI,GAAA,gBAAG;AACL,WAAO,IAAI,CAAC,UAAU,EAAE,CAAC,IAAI,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC;GAC3C;;SAhCG,aAAa;;;AAwCZ,SAAS,MAAM,CAAC,MAAM,EAAE;AAC7B,SAAO,oBAAW,MAAM,EAAE,KAAK,EAAE,YAAM;AACrC,WAAO,IAAI,GAAG,CAAC,MAAM,CAAC,CAAC;GACxB,CAAC,CAAC;CACJ;;AAAA,CAAC","file":"amp-list-0.1.max.js","sourceRoot":"/source/","sourcesContent":["(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require==\"function\"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error(\"Cannot find module '\"+o+\"'\");throw f.code=\"MODULE_NOT_FOUND\",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require==\"function\"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})","/**\n * Copyright 2015 The AMP HTML Authors. All Rights Reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS-IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {urlReplacementsFor} from '../../../src/url-replacements';\nimport {assertHttpsUrl} from '../../../src/url';\nimport {isLayoutSizeDefined} from '../../../src/layout';\nimport {templatesFor} from '../../../src/template';\nimport {xhrFor} from '../../../src/xhr';\n\n\n/** @const {!Function} */\nconst assert = AMP.assert;\n\n\n/**\n * The implementation of `amp-list` component. See {@link ../amp-list.md} for\n * the spec.\n */\nexport class AmpList extends AMP.BaseElement {\n\n  /** @override */\n  isLayoutSupported(layout) {\n    return isLayoutSizeDefined(layout);\n  }\n\n  /** @override */\n  buildCallback() {\n    /** @const {!Element} */\n    this.container_ = this.getWin().document.createElement('div');\n    this.applyFillContent(this.container_, true);\n    this.element.appendChild(this.container_);\n    if (!this.element.hasAttribute('role')) {\n      this.element.setAttribute('role', 'list');\n    }\n\n    /** @private @const {!UrlReplacements} */\n    this.urlReplacements_ = urlReplacementsFor(this.getWin());\n  }\n\n  /** @override */\n  layoutCallback() {\n    return this.urlReplacements_.expand(assertHttpsUrl(\n        this.element.getAttribute('src'), this.element)).then(src => {\n          const opts = {\n            credentials: this.element.getAttribute('credentials')\n          };\n          return xhrFor(this.getWin()).fetchJson(src, opts);\n        }).then(data => {\n          assert(typeof data == 'object' && Array.isArray(data['items']),\n              'Response must be {items: []} object %s %s',\n              this.element, data);\n          const items = data['items'];\n          return templatesFor(this.getWin()).findAndRenderTemplateArray(\n              this.element, items).then(this.rendered_.bind(this));\n        });\n  }\n\n  /**\n   * @param {!Array<!Element>} elements\n   * @private\n   */\n  rendered_(elements) {\n    elements.forEach(element => {\n      if (!element.hasAttribute('role')) {\n        element.setAttribute('role', 'listitem');\n      }\n      this.container_.appendChild(element);\n    });\n\n    // Change height if needed.\n    this.getVsync().measure(() => {\n      const scrollHeight = this.container_./*OK*/scrollHeight;\n      const height = this.element./*OK*/offsetHeight;\n      if (scrollHeight > height) {\n        this.requestChangeHeight(scrollHeight);\n      }\n    });\n  }\n}\n\nAMP.registerElement('amp-list', AmpList);\n","// shim for using process in browser\n\nvar process = module.exports = {};\nvar queue = [];\nvar draining = false;\nvar currentQueue;\nvar queueIndex = -1;\n\nfunction cleanUpNextTick() {\n    draining = false;\n    if (currentQueue.length) {\n        queue = currentQueue.concat(queue);\n    } else {\n        queueIndex = -1;\n    }\n    if (queue.length) {\n        drainQueue();\n    }\n}\n\nfunction drainQueue() {\n    if (draining) {\n        return;\n    }\n    var timeout = setTimeout(cleanUpNextTick);\n    draining = true;\n\n    var len = queue.length;\n    while(len) {\n        currentQueue = queue;\n        queue = [];\n        while (++queueIndex < len) {\n            if (currentQueue) {\n                currentQueue[queueIndex].run();\n            }\n        }\n        queueIndex = -1;\n        len = queue.length;\n    }\n    currentQueue = null;\n    draining = false;\n    clearTimeout(timeout);\n}\n\nprocess.nextTick = function (fun) {\n    var args = new Array(arguments.length - 1);\n    if (arguments.length > 1) {\n        for (var i = 1; i < arguments.length; i++) {\n            args[i - 1] = arguments[i];\n        }\n    }\n    queue.push(new Item(fun, args));\n    if (queue.length === 1 && !draining) {\n        setTimeout(drainQueue, 0);\n    }\n};\n\n// v8 likes predictible objects\nfunction Item(fun, array) {\n    this.fun = fun;\n    this.array = array;\n}\nItem.prototype.run = function () {\n    this.fun.apply(null, this.array);\n};\nprocess.title = 'browser';\nprocess.browser = true;\nprocess.env = {};\nprocess.argv = [];\nprocess.version = ''; // empty string to avoid regexp issues\nprocess.versions = {};\n\nfunction noop() {}\n\nprocess.on = noop;\nprocess.addListener = noop;\nprocess.once = noop;\nprocess.off = noop;\nprocess.removeListener = noop;\nprocess.removeAllListeners = noop;\nprocess.emit = noop;\n\nprocess.binding = function (name) {\n    throw new Error('process.binding is not supported');\n};\n\nprocess.cwd = function () { return '/' };\nprocess.chdir = function (dir) {\n    throw new Error('process.chdir is not supported');\n};\nprocess.umask = function() { return 0; };\n","/**\n * Copyright 2015 The AMP HTML Authors. All Rights Reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS-IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n\n\n/**\n * Throws an error if the first argument isn't trueish.\n *\n * Supports argument substitution into the message via %s placeholders.\n *\n * Throws an error object that has two extra properties:\n * - associatedElement: This is the first element provided in the var args.\n *   It can be used for improved display of error messages.\n * - messageArray: The elements of the substituted message as non-stringified\n *   elements in an array. When e.g. passed to console.error this yields\n *   native displays of things like HTML elements.\n *\n * @param {T} shouldBeTrueish The value to assert. The assert fails if it does\n *     not evaluate to true.\n * @param {string} message The assertion message\n * @param {...*} var_args Arguments substituted into %s in the message.\n * @return {T} The value of shouldBeTrueish.\n * @template T\n */\n/*eslint \"google-camelcase/google-camelcase\": 0*/\nexport function assert(shouldBeTrueish, message, var_args) {\n  let firstElement;\n  if (!shouldBeTrueish) {\n    message = message || 'Assertion failed';\n    const splitMessage = message.split('%s');\n    const first = splitMessage.shift();\n    let formatted = first;\n    const messageArray = [];\n    pushIfNonEmpty(messageArray, first);\n    for (let i = 2; i < arguments.length; i++) {\n      const val = arguments[i];\n      if (val && val.tagName) {\n        firstElement = val;\n      }\n      const nextConstant = splitMessage.shift();\n      messageArray.push(val);\n      pushIfNonEmpty(messageArray, nextConstant.trim());\n      formatted += toString(val) + nextConstant;\n    }\n    const e = new Error(formatted);\n    e.fromAssert = true;\n    e.associatedElement = firstElement;\n    e.messageArray = messageArray;\n    throw e;\n  }\n  return shouldBeTrueish;\n}\n/*eslint \"google-camelcase/google-camelcase\": 2*/\n\n/**\n * @param {*} val\n * @return {string}\n */\nfunction toString(val) {\n  if (val instanceof Element) {\n    return val.tagName.toLowerCase() + (val.id ? '#' + val.id : '');\n  }\n  return val;\n}\n\n/**\n * @param {!Array} array\n * @param {*} val\n */\nfunction pushIfNonEmpty(array, val) {\n  if (val != '') {\n    array.push(val);\n  }\n}\n","/**\n * Copyright 2015 The AMP HTML Authors. All Rights Reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS-IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/**\n * @fileoverview Factory for ./service/cid-impl.js\n */\n\nimport {getElementService} from './service';\n\n/**\n * @param {!Window} window\n * @return {!Promise<!Cid>}\n */\nexport function cidFor(window) {\n  return getElementService(window, 'cid', 'amp-analytics');\n};\n","/**\n * Copyright 2015 The AMP HTML Authors. All Rights Reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS-IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {getService} from './service';\nimport {assert} from './asserts';\nimport {parseUrl} from './url';\n\n/**\n * @param {!Window} win\n * @return {{canonicalUrl: string, pageViewId: string}} Info about the doc\n *     - canonicalUrl: The doc's canonical.\n *     - pageViewId: Id for this page view. Low entropy but should be unique\n *       for concurrent page views of a user.\n */\nexport function documentInfoFor(win) {\n  return getService(win, 'documentInfo', () => {\n    return {\n      canonicalUrl: parseUrl(assert(\n          win.document.querySelector('link[rel=canonical]'),\n              'AMP files are required to have a <link rel=canonical> tag.')\n              .href).href,\n      pageViewId: getPageViewId(win),\n    };\n  });\n}\n\n/**\n * Returns a relatively low entropy random string.\n * This should be called once per window and then cached for subsequent\n * access to the same value to be persistent per page.\n * @param {!Window} win\n * @return {string}\n */\nfunction getPageViewId(win) {\n  return String(Math.floor(win.Math.random() * 10000));\n}\n","/**\n * Copyright 2015 The AMP HTML Authors. All Rights Reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS-IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n\n/**\n * Removes the element.\n * @param {!Element} element\n */\nexport function removeElement(element) {\n  if (element.parentElement) {\n    element.parentElement.removeChild(element);\n  }\n}\n\n\n/**\n * Removes all child nodes of the specified element.\n * @param {!Element} parent\n */\nexport function removeChildren(parent) {\n  while (parent.firstChild) {\n    parent.removeChild(parent.firstChild);\n  }\n}\n\n\n/**\n * Copies all children nodes of element \"from\" to element \"to\". Child nodes\n * are deeply cloned. Notice, that this method should be used with care and\n * preferably on smaller subtrees.\n * @param {!Element} from\n * @param {!Element} to\n */\nexport function copyChildren(from, to) {\n  const frag = to.ownerDocument.createDocumentFragment();\n  for (let n = from.firstChild; n; n = n.nextSibling) {\n    frag.appendChild(n.cloneNode(true));\n  }\n  to.appendChild(frag);\n}\n\n\n/**\n * Finds the closest element that satisfies the callback from this element\n * up the DOM subtree.\n * @param {!Element} element\n * @param {function(!Element):boolean} callback\n * @return {?Element}\n */\nexport function closest(element, callback) {\n  for (let el = element; el; el = el.parentElement) {\n    if (callback(el)) {\n      return el;\n    }\n  }\n  return null;\n}\n\n\n/**\n * Finds the closest element with the specified name from this element\n * up the DOM subtree.\n * @param {!Element} element\n * @param {string} tagName\n * @return {?Element}\n */\nexport function closestByTag(element, tagName) {\n  tagName = tagName.toUpperCase();\n  return closest(element, el => {\n    return el.tagName == tagName;\n  });\n}\n\n\n/**\n * Finds the first descendant element with the specified name.\n * @param {!Element} element\n * @param {string} tagName\n * @return {?Element}\n */\nexport function elementByTag(element, tagName) {\n  const elements = element.getElementsByTagName(tagName);\n  return elements.length > 0 ? elements[0] : null;\n}\n\n\n/**\n * Finds the first child element that satisfies the callback.\n * @param {!Element} parent\n * @param {function(!Element):boolean} callback\n * @return {?Element}\n */\nexport function childElement(parent, callback) {\n  const children = parent.children;\n  for (let i = 0; i < children.length; i++) {\n    if (callback(children[i])) {\n      return children[i];\n    }\n  }\n  return null;\n}\n\n\n/**\n * Finds the first child element that has the specified attribute, optionally\n * with a value.\n * @param {!Element} parent\n * @param {string} attr\n * @param {string=} opt_value\n * @return {?Element}\n */\nexport function childElementByAttr(parent, attr, opt_value) {\n  return childElement(parent, el => {\n    if (!el.hasAttribute(attr)) {\n      return false;\n    }\n    if (opt_value !== undefined && el.getAttribute(attr) != opt_value) {\n      return false;\n    }\n    return true;\n  });\n}\n\n\n/**\n * Finds the first child element that has the specified tag name.\n * @param {!Element} parent\n * @param {string} tagName\n * @return {?Element}\n */\nexport function childElementByTag(parent, tagName) {\n  tagName = tagName.toUpperCase();\n  return childElement(parent, el => {\n    return el.tagName == tagName;\n  });\n}\n","/**\n * Copyright 2015 The AMP HTML Authors. All Rights Reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS-IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/**\n * @fileoverview Implements element layout. See https://goo.gl/9avXuT for\n * details.\n */\n\nimport {assert} from './asserts';\n\n\n/**\n * @enum {string}\n */\nexport const Layout = {\n  NODISPLAY: 'nodisplay',\n  FIXED: 'fixed',\n  FIXED_HEIGHT: 'fixed-height',\n  RESPONSIVE: 'responsive',\n  CONTAINER: 'container',\n  FILL: 'fill'\n};\n\n\n/**\n * CSS Length type. E.g. \"1px\" or \"20vh\".\n * @typedef {string}\n */\nlet LengthDef;\n\n\n/**\n * @typedef {{\n *   width: string,\n *   height: string\n * }}\n */\nlet DimensionsDef;\n\n\n/**\n * The set of elements with natural dimensions, that is, elements\n * which have a known dimension either based on their value specified here,\n * or, if the value is null, a dimension specific to the browser.\n * `hasNaturalDimensions` checks for membership in this set.\n * `getNaturalDimensions` determines the dimensions for an element in the\n *    set and caches it.\n * @type {!Object<string, ?DimensionsDef>}\n * @private  Visible for testing only!\n */\nexport const naturalDimensions_ = {\n  'AMP-PIXEL': {width: '1px', height: '1px'},\n  'AMP-ANALYTICS': {width: '1px', height: '1px'},\n  // TODO(dvoytenko): audio should have width:auto.\n  'AMP-AUDIO': null\n};\n\n\n/**\n * Elements that the progess can be shown for. This set has to be externalized\n * since the element's implementation may not be downloaded yet.\n * @enum {boolean}\n * @private  Visible for testing only!\n */\nexport const LOADING_ELEMENTS_ = {\n  'AMP-ANIM': true,\n  'AMP-BRIGHTCOVE': true,\n  'AMP-IFRAME': true,\n  'AMP-IMG': true,\n  'AMP-INSTAGRAM': true,\n  'AMP-LIST': true,\n  'AMP-PINTEREST': true,\n  'AMP-VIDEO': true\n};\n\n\n/**\n * @param {string} s\n * @return {Layout|undefined} Returns undefined in case of failure to parse\n *   the layout string.\n */\nexport function parseLayout(s) {\n  for (const k in Layout) {\n    if (Layout[k] == s) {\n      return Layout[k];\n    }\n  }\n  return undefined;\n}\n\n\n/**\n * @param {!Layout} layout\n * @return {string}\n */\nexport function getLayoutClass(layout) {\n  return '-amp-layout-' + layout;\n}\n\n\n/**\n * Whether an element with this layout inherently defines the size.\n * @param {!Layout} layout\n * @return {boolean}\n */\nexport function isLayoutSizeDefined(layout) {\n  return (layout == Layout.FIXED ||\n      layout == Layout.FIXED_HEIGHT ||\n      layout == Layout.RESPONSIVE ||\n      layout == Layout.FILL);\n}\n\n\n/**\n * Whether the tag is an internal (service) AMP tag.\n * @param {!Node|string} tag\n * @return {boolean}\n */\nexport function isInternalElement(tag) {\n  const tagName = (typeof tag == 'string') ? tag : tag.tagName;\n  return tagName && tagName.toLowerCase().indexOf('i-') == 0;\n}\n\n\n/**\n * Parses the CSS length value. If no units specified, the assumed value is\n * \"px\". Returns undefined in case of parsing error.\n * @param {string|undefined} s\n * @return {!LengthDef|undefined}\n */\nexport function parseLength(s) {\n  if (typeof s == 'number') {\n    return s + 'px';\n  }\n  if (!s) {\n    return undefined;\n  }\n  if (!/^\\d+(\\.\\d+)?(px|em|rem|vh|vw|vmin|vmax)?$/.test(s)) {\n    return undefined;\n  }\n  if (/^\\d+(\\.\\d+)?$/.test(s)) {\n    return s + 'px';\n  }\n  return s;\n}\n\n\n/**\n * Asserts that the supplied value is a CSS Length value.\n * @param {!LengthDef|string} length\n * @return {!LengthDef}\n */\nexport function assertLength(length) {\n  assert(/^\\d+(\\.\\d+)?(px|em|rem|vh|vw|vmin|vmax)$/.test(length),\n      'Invalid length value: %s', length);\n  return length;\n}\n\n\n/**\n * Returns units from the CSS length value.\n * @param {!LengthDef} length\n * @return {string}\n */\nexport function getLengthUnits(length) {\n  assertLength(length);\n  const m = assert(length.match(/[a-z]+/i),\n      'Failed to read units from %s', length);\n  return m[0];\n}\n\n\n/**\n * Returns the numeric value of a CSS length value.\n * @param {!LengthDef|string} length\n * @return {number}\n */\nexport function getLengthNumeral(length) {\n  return parseFloat(length);\n}\n\n\n/**\n * Determines whether the tagName is a known element that has natural dimensions\n * in our runtime or the browser.\n * @param {string} tagName The element tag name.\n * @return {DimensionsDef}\n */\nexport function hasNaturalDimensions(tagName) {\n  tagName = tagName.toUpperCase();\n  return naturalDimensions_[tagName] !== undefined;\n}\n\n\n/**\n * Determines the default dimensions for an element which could vary across\n * different browser implementations, like <audio> for instance.\n * This operation can only be completed for an element whitelisted by\n * `hasNaturalDimensions`.\n * @param {string} tagName The element tag name.\n * @return {DimensionsDef}\n */\nexport function getNaturalDimensions(tagName) {\n  tagName = tagName.toUpperCase();\n  assert(naturalDimensions_[tagName] !== undefined);\n  if (!naturalDimensions_[tagName]) {\n    const naturalTagName = tagName.replace(/^AMP\\-/, '');\n    const temp = document.createElement(naturalTagName);\n    // For audio, should no-op elsewhere.\n    temp.controls = true;\n    temp.style.position = 'absolute';\n    temp.style.visibility = 'hidden';\n    document.body.appendChild(temp);\n    naturalDimensions_[tagName] = {\n      width: (temp./*OK*/offsetWidth || 1) + 'px',\n      height: (temp./*OK*/offsetHeight || 1) + 'px'\n    };\n    document.body.removeChild(temp);\n  }\n  return naturalDimensions_[tagName];\n}\n\n\n/**\n * Whether the loading can be shown for the specified elemeent. This set has\n * to be externalized since the element's implementation may not be\n * downloaded yet.\n * @param {string} tagName The element tag name.\n * @return {boolean}\n */\nexport function isLoadingAllowed(tagName) {\n  return LOADING_ELEMENTS_[tagName.toUpperCase()] || false;\n}\n","/**\n * Copyright 2015 The AMP HTML Authors. All Rights Reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS-IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {getMode} from './mode';\n\n/** @const Time when this JS loaded.  */\nconst start = new Date().getTime();\n\n\n/**\n * Logging.\n * // TODO(@cramforce): Make this DCRable.\n * Add #log=1 to URL to turn on logging when in prod (providing a build with\n * logging is used and #log=0 to turn off logging in local dev.\n * @final\n */\nexport class Log {\n\n  /**\n   * @param {!Window} win\n   */\n  constructor(win) {\n    /**\n     * In tests we use the main test window instead of the iframe where\n     * the tests runs because only the former is relayed to the console.\n     * @const {!Window}\n     */\n    this.win = win.AMP_TEST ? win.parent : win;\n\n    /** @private {boolean} */\n    this.isEnabled_ = this.shouldBeEnabled_();\n  }\n\n  shouldBeEnabled_() {\n    if (!this.win.console || !this.win.console.log) {\n      return false;\n    }\n    // Search for #log=0 or log=1\n    const match = this.win.location.hash.match(/log=(\\d)/);\n    const shouldLog = match && match[1];\n    if (getMode().localDev && shouldLog != '0') {\n      return true;\n    }\n    if (this.win.location.hash && shouldLog == '1') {\n      return true;\n    }\n    return false;\n  }\n\n  /**\n   * @param {string} tag\n   * @param {string} level\n   * @param {!Array} messages\n   * @param {?} opt_error\n   */\n  msg_(tag, level, messages) {\n    if (this.isEnabled_) {\n      let fn = this.win.console.log;\n      if (level == 'ERROR') {\n        fn = this.win.console.error || fn;\n      } else if (level == 'INFO') {\n        fn = this.win.console.info || fn;\n      } else if (level == 'WARN') {\n        fn = this.win.console.warn || fn;\n      }\n      messages.unshift(new Date().getTime() - start, '[' + tag + ']');\n      fn.apply(this.win.console, messages);\n    }\n  }\n\n  /**\n   * @param {string} tag\n   * @param {...*} var_args\n   */\n  fine(tag, var_args) {\n    if (this.isEnabled_) {\n      this.msg_(tag, 'FINE', Array.prototype.slice.call(arguments, 1));\n    }\n  }\n\n  /**\n   * @param {string} tag\n   * @param {...*} var_args\n   */\n  info(tag, var_args) {\n    if (this.isEnabled_) {\n      this.msg_(tag, 'INFO', Array.prototype.slice.call(arguments, 1));\n    }\n  }\n\n  /**\n   * @param {string} tag\n   * @param {...*} var_args\n   */\n  warn(tag, var_args) {\n    if (this.isEnabled_) {\n      this.msg_(tag, 'WARN', Array.prototype.slice.call(arguments, 1));\n    }\n  }\n\n  /**\n   * @param {string} tag\n   * @param {...*} var_args\n   * @param {?} opt_error\n   */\n  error(tag, var_args) {\n    if (this.isEnabled_) {\n      this.msg_(tag, 'ERROR', Array.prototype.slice.call(arguments, 1));\n    }\n  }\n};\n\n\nexport const log = new Log(window);\n","/**\n * Copyright 2015 The AMP HTML Authors. All Rights Reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS-IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {parseQueryString} from './url';\n\n\n/**\n * @typedef {{\n *   localDev: boolean\n * }}\n */\nlet ModeDef;\n\n/** @typedef {?ModeDef} */\nlet mode = null;\n\n/**\n * Provides info about the current app.\n * @return {!ModeDef}\n */\nexport function getMode() {\n  if (mode) {\n    return mode;\n  }\n  return mode = getMode_();\n}\n\n/**\n * Set mode in a test. Pass null in afterEach function to reset.\n * @param {?ModeDef} m\n */\nexport function setModeForTesting(m) {\n  mode = m;\n}\n\n/**\n * Provides info about the current app.\n * @return {!ModeDef}\n */\nfunction getMode_() {\n  const isLocalDev = (location.hostname == 'localhost' ||\n      (location.ancestorOrigins && location.ancestorOrigins[0] &&\n          location.ancestorOrigins[0].indexOf('http://localhost:') == 0)) &&\n      // Filter out localhost running against a prod script.\n      // Because all allowed scripts are ours, we know that these can only\n      // occur during local dev.\n      !!document.querySelector('script[src*=\"/dist/\"],script[src*=\"/base/\"]');\n\n  const overrideDevelopment = parseQueryString(location.hash)['development'];\n  const development = overrideDevelopment != undefined\n      ? overrideDevelopment == '1'\n      : !!document.querySelector('script[development]');\n\n  return {\n    localDev: isLocalDev,\n    // Triggers validation\n    development: development,\n    minified: process.env.NODE_ENV == 'production',\n    test: window.AMP_TEST\n  };\n}\n","/**\n * Copyright 2015 The AMP HTML Authors. All Rights Reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS-IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {assert} from './asserts';\n\n/**\n * Holds info about a service.\n * - obj: Actual service implementation when available.\n * - promise: Promise for the obj.\n * - resolve: Function to resolve the promise with the object.\n * @typedef {{\n *   obj: (?Object),\n *   promise: (?Promise|undefined),\n *   resolve: (?function(!Object)|undefined),\n * }}\n */\nlet ServiceHolderDef;\n\n/**\n * Returns a service for the given id and window (a per-window singleton).\n * If the service is not yet available the factory function is invoked and\n * expected to return the service.\n * Users should typically wrap this as a special purpose function (e.g.\n * viewportFor(win)) for type safety and because the factory should not be\n * passed around.\n * @param {!Window} win\n * @param {string} id of the service.\n * @param {function(!Window):!Object=} opt_factory Should create the service\n *     if it does not exist yet. If the factory is not given, it is an error\n *     if the service does not exist yet.\n * @return {*}\n */\nexport function getService(win, id, opt_factory) {\n  const services = getServices(win);\n  let s = services[id];\n  if (!s) {\n    s = services[id] = {};\n  }\n  if (!s.obj) {\n    assert(opt_factory, 'Factory not given and service missing %s', id);\n    s.obj = opt_factory(win);\n    // The service may have been requested already, in which case we have a\n    // pending promise we need to fulfill.\n    if (s.resolve) {\n      s.resolve(s.obj);\n    }\n  }\n  return s.obj;\n}\n\n/**\n * Returns a promise for a service for the given id and window. Also expects\n * an element that has the actual implementation. The promise resolves when\n * the implementation loaded.\n * Users should typically wrap this as a special purpose function (e.g.\n * viewportFor(win)) for type safety and because the factory should not be\n * passed around.\n * @param {!Window} win\n * @param {string} id of the service.\n * @param {string} provideByElement Name of the custom element that provides\n *     the implementation of this service.\n * @return {!Promise<*>}\n */\nexport function getElementService(win, id, providedByElement) {\n  // Call `getElementService_` in a micro-task to ensure that `stubElements`\n  // has been called.\n  return Promise.resolve().then(() => {\n    return getElementService_(win, id, providedByElement);\n  });\n}\n\n/**\n * @param {!Window} win\n * @param {string} id of the service.\n * @param {string} provideByElement Name of the custom element that provides\n *     the implementation of this service.\n * @return {!Promise<*>}\n * @private\n */\nfunction getElementService_(win, id, providedByElement) {\n  assert(isElementScheduled(win, providedByElement),\n      'Service %s was requested to be provided through %s, ' +\n      'but %s is not loaded in the current page. To fix this ' +\n      'problem load the JavaScript file for %s in this page.',\n      id, providedByElement, providedByElement, providedByElement);\n  const services = getServices(win);\n  const s = services[id];\n  if (s) {\n    // If a service was registered with getService, we make a promise from it\n    // which we will return in future invocations.\n    if (!s.promise) {\n      s.promise = Promise.resolve(s.obj);\n    }\n    return s.promise;\n  }\n  // TODO(@cramforce): Add a check that if the element is eventually registered\n  // that the service is actually provided and this promise resolves.\n  let resolve;\n  const p = new Promise(r => {\n    resolve = r;\n  });\n  services[id] = {\n    obj: null,\n    promise: p,\n    resolve: resolve,\n  };\n\n  return p;\n}\n\n/**\n * @param {!Window} win\n * @param {string} elementName Name of an extended custom element.\n * @return {boolean} Whether this element is scheduled to be loaded.\n */\nfunction isElementScheduled(win, elementName) {\n  assert(win.ampExtendedElements, 'win.ampExtendedElements not created yet');\n  return !!win.ampExtendedElements[elementName];\n}\n\n/**\n * In order to provide better error messages we only allow to retrieve\n * services from other elements if those elements are loaded in the page.\n * This makes it possible to mark an element as loaded in a test.\n * @param {!Window} win\n * @param {string} elementName Name of an extended custom element.\n */\nexport function markElementScheduledForTesting(win, elementName) {\n  if (!win.ampExtendedElements) {\n    win.ampExtendedElements = {};\n  }\n  win.ampExtendedElements[elementName] = true;\n}\n\n/**\n * Returns the object that holds the services registered in a window.\n * @param {!Window} win\n * @return {!Object<string,!ServiceHolderDef>}\n */\nfunction getServices(win) {\n  let services = win.services;\n  if (!services) {\n    services = win.services = {};\n  }\n  return services;\n}\n\n/**\n * Resets a single service, so it gets recreated on next getService invocation.\n * @param {!Window} win\n * @param {string} id of the service.\n */\nexport function resetServiceForTesting(win, id) {\n  if (win.services) {\n    win.services[id] = null;\n  }\n}\n","/**\n * Copyright 2015 The AMP HTML Authors. All Rights Reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS-IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {assert} from './asserts';\nimport {childElementByTag} from './dom';\nimport {getService} from './service';\n\n/**\n * @fileoverview\n * For the set of decisions made on templating see:\n * {@link https://docs.google.com/document/d/1q-5MPQHnOHLF_uL7lQsGZdzuBgrPTkCy2PdRP-YCbOw/edit#}\n */\n\n\n/**\n * @typedef {function(new:!BaseTemplate, !Element)}\n */\nconst TemplateClassDef = {};\n\n/** @private @const {string} */\nconst PROP_ = '__AMP_IMPL_';\n\n/** @private @const {string} */\nconst PROP_PROMISE_ = '__AMP_WAIT_';\n\n\n/**\n * The interface that is implemented by all templates.\n */\nexport class BaseTemplate {\n\n  /** @param {!Element} element */\n  constructor(element) {\n    /** @public @const */\n    this.element = element;\n\n    this.compileCallback();\n  }\n\n  /** @protected @return {!Window} */\n  getWin() {\n    return this.element.ownerDocument.defaultView;\n  }\n\n  /**\n   * Override in subclass if the element needs to compile the template.\n   * @protected\n   */\n  compileCallback() {\n    // Subclasses may override.\n  }\n\n  /**\n   * To be implemented by subclasses.\n   * @param {!JSONObject} unusedData\n   * @return {!Element}\n   */\n  render(unusedData) {\n    throw new Error('Not implemented');\n  }\n\n  /**\n   * Helps the template implementation to unwrap the root element. The root\n   * element can be unwrapped only when it contains a single element or a\n   * single element surrounded by empty text nodes.\n   * @param {!Element} root\n   * @return {!Element}\n   * @protected @final\n   */\n  unwrap(root) {\n    let singleElement = null;\n    for (let n = root.firstChild; n != null; n = n.nextSibling) {\n      if (n.nodeType == /* TEXT */ 3) {\n        if (n.textContent.trim()) {\n          // Non-empty text node - can't unwrap.\n          singleElement = null;\n          break;\n        }\n      } else if (n.nodeType == /* COMMENT */ 8) {\n        // Ignore comments.\n      } else if (n.nodeType == /* ELEMENT */ 1) {\n        if (!singleElement) {\n          singleElement = /** @type {!Element} */ (n);\n        } else {\n          // This is not the first element - can't unwrap.\n          singleElement = null;\n          break;\n        }\n      } else {\n        singleElement = null;\n      }\n    }\n    return singleElement || root;\n  }\n}\n\n\n/**\n */\nexport class Templates {\n  /** @param {!Window} win */\n  constructor(win) {\n    /** @private @const {!Window} */\n    this.win_ = win;\n\n    /**\n     * A map from template type to template's class promise.\n     * @private @const {!Object<string, !Promise<!TemplateClassDef>>}\n     */\n    this.templateClassMap_ = {};\n\n    /**\n     * A map from template type to template's class promise. This is a transient\n     * storage. As soon as the template class loaded, the entry is removed.\n     * @private @const {!Object<string, function(!TemplateClassDef)>}\n     */\n    this.templateClassResolvers_ = {};\n\n    /** @type {!Object<string, boolean>|undefined} */\n    this.declaredTemplates_;\n  }\n\n  /**\n   * Renders the specified template element using the supplied data.\n   * @param {!Element} templateElement\n   * @param {!JSONObject} data\n   * @return {!Promise<!Element>}\n   */\n  renderTemplate(templateElement, data) {\n    return this.getImplementation_(templateElement).then(impl => {\n      return impl.render(data);\n    });\n  }\n\n  /**\n   * Renders the specified template element using the supplied array of data\n   * and returns an array of resulting elements.\n   * @param {!Element} templateElement\n   * @param {!Array<!JSONObject>} array\n   * @return {!Promise<!Array<!Element>>}\n   */\n  renderTemplateArray(templateElement, array) {\n    if (array.length == 0) {\n      return Promise.resolve([]);\n    }\n    return this.getImplementation_(templateElement).then(impl => {\n      return array.map(item => {\n        return impl.render(item);\n      });\n    });\n  }\n\n  /**\n   * Discovers the template for the specified parent and renders it using the\n   * supplied data. The template can be specified either via \"template\"\n   * attribute  or as a child \"template\" element. When specified via \"template\"\n   * attribute, the value indicates the ID of the template element.\n   * @param {!Element} parent\n   * @param {!JSONObject} data\n   * @return {!Promise<!Element>}\n   */\n  findAndRenderTemplate(parent, data) {\n    return this.renderTemplate(this.findTemplate_(parent), data);\n  }\n\n  /**\n   * Discovers the template for the specified parent and renders it using the\n   * supplied array of data. The template can be specified either via \"template\"\n   * attribute or as a child \"template\" element. When specified via \"template\"\n   * attribute, the value indicates the ID of the template element. Returns\n   * the array of the rendered elements.\n   * @param {!Element} parent\n   * @param {!Array<!JSONObject>} array\n   * @return {!Promise<!Array<!Element>>}\n   */\n  findAndRenderTemplateArray(parent, array) {\n    return this.renderTemplateArray(this.findTemplate_(parent), array);\n  }\n\n  /**\n   * The template can be specified either via \"template\" attribute or as a\n   * child \"template\" element. When specified via \"template\" attribute,\n   * the value indicates the ID of the template element.\n   * @param {!Element} parent\n   * @return {!Element}\n   * @private\n   */\n  findTemplate_(parent) {\n    let templateElement = null;\n    const templateId = parent.getAttribute('template');\n    if (templateId) {\n      templateElement = parent.ownerDocument.getElementById(templateId);\n    } else {\n      templateElement = childElementByTag(parent, 'template');\n    }\n    assert(templateElement, 'Template not found for %s', parent);\n    assert(templateElement.tagName == 'TEMPLATE',\n        'Template element must be a \"template\" tag %s', templateElement);\n    return templateElement;\n  }\n\n  /**\n   * Returns the promise that will eventually yield the template implementation\n   * for the specified template element.\n   * @param {!Element} element\n   * @return {!Promise<!BaseTemplate>}\n   * @private\n   */\n  getImplementation_(element) {\n    const impl = element[PROP_];\n    if (impl) {\n      return Promise.resolve(impl);\n    }\n\n    const type = assert(element.getAttribute('type'),\n        'Type must be specified: %s', element);\n\n    let promise = element[PROP_PROMISE_];\n    if (promise) {\n      return promise;\n    }\n\n    promise = this.waitForTemplateClass_(element, type).then(templateClass => {\n      const impl = element[PROP_] = new templateClass(element);\n      delete element[PROP_PROMISE_];\n      return impl;\n    });\n    element[PROP_PROMISE_] = promise;\n    return promise;\n  }\n\n  /**\n   * Returns the promise that will eventually yield the template class. This will\n   * wait until the actual template script has been downloaded and parsed.\n   * @param {!Element} element\n   * @param {string} type\n   * @return {!Promise<!TemplateClassDef>}\n   * @private\n   */\n  waitForTemplateClass_(element, type) {\n    if (this.templateClassMap_[type]) {\n      return this.templateClassMap_[type];\n    }\n\n    this.checkTemplateDeclared_(element, type);\n    let aResolve;\n    const promise = new Promise((resolve, unusedReject) => {\n      aResolve = resolve;\n    });\n    this.templateClassMap_[type] = promise;\n    this.templateClassResolvers_[type] = aResolve;\n    return promise;\n  }\n\n\n  /**\n   * Checks that the template type has actually been declared by a\n   * `<script custom-template=$type>` tag in the head.\n   * @param {!Element} element\n   * @param {string} type\n   * @private\n   */\n  checkTemplateDeclared_(element, type) {\n    if (!this.declaredTemplates_) {\n      this.declaredTemplates_ = this.win_.Object.create(null);\n      const scriptTags = this.win_.document.querySelectorAll(\n          'script[custom-template]');\n      for (let i = 0; i < scriptTags.length; i++) {\n        this.declaredTemplates_[scriptTags[i].getAttribute(\n            'custom-template')] = true;\n      }\n    }\n    assert(this.declaredTemplates_[type],\n        'Template must be declared for %s as <script custom-template=%s>',\n        element, type);\n  }\n\n  /**\n   * Registers an extended template. This function should typically be called\n   * through the registerTemplate method on the AMP runtime.\n   * @param {string} type\n   * @param {!TemplateClassDef} templateClass\n   * @private\n   */\n  registerTemplate_(type, templateClass) {\n    if (!this.templateClassMap_[type]) {\n      this.templateClassMap_[type] = Promise.resolve(templateClass);\n    } else {\n      const resolver = this.templateClassResolvers_[type];\n      assert(resolver, 'Duplicate template type: %s', type);\n      delete this.templateClassResolvers_[type];\n      resolver(templateClass);\n    }\n  }\n}\n\n\n/**\n * Registers an extended template. This function should typically be called\n * through the registerTemplate method on the AMP runtime.\n * @param {!Window} win\n * @param {string} type\n * @param {!TemplateClassDef} templateClass\n * @package\n */\nexport function registerExtendedTemplate(win, type, templateClass) {\n  return templatesFor(win).registerTemplate_(type, templateClass);\n}\n\n\n/**\n * @param {!Window} window\n * @return {!History}\n */\nexport function templatesFor(window) {\n  return getService(window, 'templates', () => {\n    return new Templates(window);\n  });\n};\n","/**\n * Copyright 2015 The AMP HTML Authors. All Rights Reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS-IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {cidFor} from './cid';\nimport {documentInfoFor} from './document-info';\nimport {getService} from './service';\nimport {userNotificationManagerFor} from './user-notification';\nimport {log} from './log';\nimport {parseUrl, removeFragment} from './url';\nimport {viewportFor} from './viewport';\nimport {vsyncFor} from './vsync';\n\n/** @private {string} */\nconst TAG_ = 'UrlReplacements';\n\n/**\n * This class replaces substitution variables with their values.\n */\nclass UrlReplacements {\n  /** @param {!Window} win */\n  constructor(win) {\n    /** @private @const {!Window} */\n    this.win_ = win;\n\n    /** @private {!RegExp|undefined} */\n    this.replacementExpr_;\n\n    /** @private @const {!Object<string, function(*):*>} */\n    this.replacements_ = this.win_.Object.create(null);\n\n    // Returns a random value for cache busters.\n    this.set_('RANDOM', () => {\n      return Math.random();\n    });\n\n    // Returns the canonical URL for this AMP document.\n    this.set_('CANONICAL_URL', () => {\n      return documentInfoFor(this.win_).canonicalUrl;\n    });\n\n    // Returns the host of the canonical URL for this AMP document.\n    this.set_('CANONICAL_HOST', () => {\n      const url = parseUrl(documentInfoFor(this.win_).canonicalUrl);\n      return url && url.hostname;\n    });\n\n    // Returns the path of the canonical URL for this AMP document.\n    this.set_('CANONICAL_PATH', () => {\n      const url = parseUrl(documentInfoFor(this.win_).canonicalUrl);\n      return url && url.pathname;\n    });\n\n    // Returns the referrer URL.\n    this.set_('DOCUMENT_REFERRER', () => {\n      return this.win_.document.referrer;\n    });\n\n    // Returns the title of this AMP document.\n    this.set_('TITLE', () => {\n      return this.win_.document.title;\n    });\n\n    // Returns the URL for this AMP document.\n    this.set_('AMPDOC_URL', () => {\n      return removeFragment(this.win_.location.href);\n    });\n\n    // Returns the host of the URL for this AMP document.\n    this.set_('AMPDOC_HOST', () => {\n      const url = parseUrl(this.win_.location.href);\n      return url && url.hostname;\n    });\n\n    // Returns a random string that will be the constant for the duration of\n    // single page view. It should have sufficient entropy to be unique for\n    // all the page views a single user is making at a time.\n    this.set_('PAGE_VIEW_ID', () => {\n      return documentInfoFor(this.win_).pageViewId;\n    });\n\n    this.set_('CLIENT_ID', (opt_name, opt_userNotificationId) => {\n      let consent = Promise.resolve();\n\n      // If no `opt_userNotificationId` argument is provided then\n      // assume consent is given by default.\n      if (opt_userNotificationId) {\n        consent = userNotificationManagerFor(this.win_).then(service => {\n          return service.get(opt_userNotificationId);\n        });\n      }\n\n      return cidFor(this.win_).then(cid => {\n        return cid.get(opt_name, consent);\n      });\n    });\n\n    // Returns the number of milliseconds since 1 Jan 1970 00:00:00 UTC.\n    this.set_('TIMESTAMP', () => {\n      return new Date().getTime();\n    });\n\n    // Returns the user's time-zone offset from UTC, in minutes.\n    this.set_('TIMEZONE', () => {\n      return new Date().getTimezoneOffset();\n    });\n\n    // Returns a promise resolving to viewport.getScrollTop.\n    this.set_('SCROLL_TOP', () => {\n      return vsyncFor(this.win_).measurePromise(\n        () => viewportFor(this.win_).getScrollTop());\n    });\n\n    // Returns a promise resolving to viewport.getScrollLeft.\n    this.set_('SCROLL_LEFT', () => {\n      return vsyncFor(this.win_).measurePromise(\n        () => viewportFor(this.win_).getScrollLeft());\n    });\n\n    // Returns a promise resolving to viewport.getScrollHeight.\n    this.set_('SCROLL_HEIGHT', () => {\n      return vsyncFor(this.win_).measurePromise(\n        () => viewportFor(this.win_).getScrollHeight());\n    });\n\n    // Returns screen.width.\n    this.set_('SCREEN_WIDTH', () => {\n      return this.win_.screen.width;\n    });\n\n    // Returns screen.height.\n    this.set_('SCREEN_HEIGHT', () => {\n      return this.win_.screen.height;\n    });\n  }\n\n  /**\n   * Sets the value resolver for the variable with the specified name. The\n   * value resolver may optionally take an extra parameter.\n   * @param {string} varName\n   * @param {function(*):*} resolver\n   * @return {!UrlReplacements}\n   * @private\n   */\n  set_(varName, resolver) {\n    this.replacements_[varName] = resolver;\n    this.replacementExpr_ = undefined;\n    return this;\n  }\n\n  /**\n   * Expands the provided URL by replacing all known variables with their\n   * resolved values. Optional `opt_bindings` can be used to add new variables\n   * or override existing ones.\n   * @param {string} url\n   * @param {!Object<string, *>=} opt_bindings\n   * @return {!Promise<string>}\n   */\n  expand(url, opt_bindings) {\n    const expr = this.getExpr_(opt_bindings);\n    let replacementPromise;\n    const encodeValue = val => {\n      // Value 0 is specialcased because the numeric 0 is a valid substitution\n      // value.\n      if (!val && val !== 0) {\n        val = '';\n      }\n      return encodeURIComponent(val);\n    };\n    url = url.replace(expr, (match, name, opt_strargs) => {\n      let args = [];\n      if (typeof opt_strargs == 'string') {\n        args = opt_strargs.split(',');\n      }\n      const val =\n          (args.length == 0 && opt_bindings && (name in opt_bindings)) ?\n          opt_bindings[name] :\n          this.replacements_[name].apply(this.replacements_, args);\n      // In case the produced value is a promise, we don't actually\n      // replace anything here, but do it again when the promise resolves.\n      if (val && val.then) {\n        const p = val.then(v => {\n          url = url.replace(match, encodeValue(v));\n        }, err => {\n          log.error(TAG_, 'Failed to expand: ' + name, err);\n        });\n        if (replacementPromise) {\n          replacementPromise = replacementPromise.then(() => p);\n        } else {\n          replacementPromise = p;\n        }\n        return match;\n      }\n      return encodeValue(val);\n    });\n\n    if (replacementPromise) {\n      replacementPromise = replacementPromise.then(() => url);\n    }\n\n    return replacementPromise || Promise.resolve(url);\n  }\n\n  /**\n   * @param {!Object<string, *>=} opt_bindings\n   * @return {!RegExp}\n   * @private\n   */\n  getExpr_(opt_bindings) {\n    const additionalKeys = opt_bindings ? Object.keys(opt_bindings) : null;\n    if (additionalKeys && additionalKeys.length > 0) {\n      const allKeys = Object.keys(this.replacements_);\n      additionalKeys.forEach(key => {\n        if (allKeys[key] === undefined) {\n          allKeys.push(key);\n        }\n      });\n      return this.buildExpr_(allKeys);\n    }\n    if (!this.replacementExpr_) {\n      this.replacementExpr_ = this.buildExpr_(Object.keys(this.replacements_));\n    }\n    return this.replacementExpr_;\n  }\n\n  /**\n   * @param {!Array<string>} keys\n   * @return {!RegExp}\n   * @private\n   */\n  buildExpr_(keys) {\n    const all = keys.join('|');\n    // Match the given replacement patterns, as well as optionally\n    // arguments to the replacement behind it in parantheses.\n    // Example string that match\n    // FOO_BAR\n    // FOO_BAR(arg1)\n    // FOO_BAR(arg1,arg2)\n    return new RegExp('\\\\$?(' + all + ')(?:\\\\(([0-9a-zA-Z-_,]+)\\\\))?', 'g');\n  }\n}\n\n/**\n * @param {!Window} window\n * @return {!UrlReplacements}\n */\nexport function urlReplacementsFor(window) {\n  return getService(window, 'url-replace', () => {\n    return new UrlReplacements(window);\n  });\n};\n","/**\n * Copyright 2015 The AMP HTML Authors. All Rights Reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS-IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {assert} from './asserts';\n\n\n/**\n * Returns a Location-like object for the given URL. If it is relative,\n * the URL gets resolved.\n * @param {string} url\n * @return {!Location}\n */\nexport function parseUrl(url) {\n  const a = document.createElement('a');\n  a.href = url;\n  const info = {\n    href: a.href,\n    protocol: a.protocol,\n    host: a.host,\n    hostname: a.hostname,\n    port: a.port == '0' ? '' : a.port,\n    pathname: a.pathname,\n    search: a.search,\n    hash: a.hash\n  };\n  // For data URI a.origin is equal to the string 'null' which is not useful.\n  // We instead return the actual origin which is the full URL.\n  info.origin = (a.origin && a.origin != 'null') ? a.origin : getOrigin(info);\n  assert(info.origin, 'Origin must exist');\n  return info;\n}\n\n\n/**\n * Asserts that a given url is HTTPS or protocol relative.\n * Provides an exception for localhost.\n * @param {string} urlString\n * @param {!Element} elementContext Element where the url was found.\n * @return {string}\n */\nexport function assertHttpsUrl(urlString, elementContext) {\n  const url = parseUrl(urlString);\n  assert(\n      url.protocol == 'https:' || /^(\\/\\/)/.test(urlString) ||\n      url.hostname == 'localhost' ||\n          url.hostname.lastIndexOf('.localhost') ==\n          // Poor person's endsWith\n          url.hostname.length - '.localhost'.length,\n      '%s source must start with ' +\n      '\"https://\" or \"//\" or be relative and served from ' +\n      'either https or from localhost. Invalid value: %s',\n      elementContext, urlString);\n  return urlString;\n}\n\n\n/**\n * Parses the query string of an URL. This method returns a simple key/value\n * map. If there are duplicate keys the latest value is returned.\n * @param {string} queryString\n * @return {!Object<string, string>}\n */\nexport function parseQueryString(queryString) {\n  const params = Object.create(null);\n  if (!queryString) {\n    return params;\n  }\n  if (queryString.indexOf('?') == 0 || queryString.indexOf('#') == 0) {\n    queryString = queryString.substr(1);\n  }\n  const pairs = queryString.split('&');\n  for (let i = 0; i < pairs.length; i++) {\n    const pair = pairs[i];\n    const eqIndex = pair.indexOf('=');\n    let name;\n    let value;\n    if (eqIndex != -1) {\n      name = decodeURIComponent(pair.substring(0, eqIndex)).trim();\n      value = decodeURIComponent(pair.substring(eqIndex + 1)).trim();\n    } else {\n      name = decodeURIComponent(pair).trim();\n      value = '';\n    }\n    if (name) {\n      params[name] = value;\n    }\n  }\n  return params;\n}\n\n\n/**\n * Don't use this directly, only exported for testing. The value\n * is available via the origin property of the object returned by\n * parseUrl.\n * @param {!Location} info\n * @return {string}\n * @visibleForTesting\n */\nexport function getOrigin(info) {\n  if (info.protocol == 'data:' || !info.host) {\n    return info.href;\n  }\n  return info.protocol + '//' + info.host;\n}\n\n\n/**\n * Returns the URL without fragment. If URL doesn't contain fragment, the same\n * string is returned.\n * @param {string} url\n * @return {string}\n */\nexport function removeFragment(url) {\n  const index = url.indexOf('#');\n  if (index == -1) {\n    return url;\n  }\n  return url.substring(0, index);\n}\n","/**\n * Copyright 2015 The AMP HTML Authors. All Rights Reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS-IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/**\n * @fileoverview Factory for amp-user-notification\n */\n\nimport {getElementService} from './service';\n\n\n/**\n * @param {!Window} window\n * @return {!Promise<!UserNotification>}\n */\nexport function userNotificationManagerFor(window) {\n  return getElementService(window, 'userNotificationManager',\n      'amp-user-notification');\n}\n","/**\n * Copyright 2015 The AMP HTML Authors. All Rights Reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS-IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {getService} from './service';\n\n/**\n * @param {!Window} window\n * @return {!Viewport}\n */\nexport function viewportFor(window) {\n  return getService(window, 'viewport');\n};\n","/**\n * Copyright 2015 The AMP HTML Authors. All Rights Reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS-IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {getService} from './service';\n\n\n/**\n * @param {!Window} window\n * @return {!Vsync}\n */\nexport function vsyncFor(window) {\n  return getService(window, 'vsync');\n};\n","/**\n * Copyright 2015 The AMP HTML Authors. All Rights Reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS-IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {assert} from './asserts';\nimport {getService} from './service';\n\n\n/**\n * The \"init\" argument of the Fetch API. Currently, only \"credentials: include\"\n * is implemented.\n *\n * See https://developer.mozilla.org/en-US/docs/Web/API/GlobalFetch/fetch\n *\n * @typedef {{\n *   body: (!Object|!Array|undefined),\n *   credentials: (string|undefined),\n *   headers: (!Object|undefined),\n *   method: (string|undefined)\n * }}\n */\nlet FetchInitDef;\n\n/** @private @const {!Array<string>} */\nconst allowedMethods_ = ['GET', 'POST'];\n\n/** @private @const {!Array<string>} */\nconst allowedBodyTypes_ = ['[object Object]', '[object Array]'];\n\n\n/**\n * A service that polyfills Fetch API for use within AMP.\n */\nclass Xhr {\n\n  /**\n   * @param {!Window} win\n   */\n  constructor(win) {\n    /**\n     * We want to call `fetch_` unbound from any context since it could\n     * be either the native fetch or our polyfill.\n     * @private @const {function(string, ?FetchInitDef=):!Promise<!FetchResponse>}\n     */\n    this.fetch_ = (win.fetch || fetchPolyfill).bind(null);\n  }\n\n  /**\n   * Fetches and constructs JSON object based on the fetch polyfill.\n   *\n   * See https://developer.mozilla.org/en-US/docs/Web/API/GlobalFetch/fetch\n   *\n   * @param {string} input\n   * @param {?FetchInitDef=} opt_init\n   * @return {!Promise<!JSONValue>}\n   */\n  fetchJson(input, opt_init) {\n    const init = opt_init || {};\n    init.method = normalizeMethod_(init.method);\n    setupJson_(init);\n\n    return this.fetch_(input, init).then(response => {\n      return assertSuccess(response).json();\n    });\n  }\n\n  /**\n   * Sends the request, awaits result and confirms that it was successful.\n   *\n   * See https://developer.mozilla.org/en-US/docs/Web/API/GlobalFetch/fetch\n   *\n   * @param {string} input\n   * @param {?FetchInitDef=} opt_init\n   * @return {!Promise}\n   */\n  sendSignal(input, opt_init) {\n    return this.fetch_(input, opt_init).then(response => {\n      assertSuccess(response);\n    });\n  }\n}\n\n\n/**\n * Normalized method name by uppercasing.\n * @param {string|undefined} method\n * @return {string}\n * @private\n */\nexport function normalizeMethod_(method) {\n  if (method === undefined) {\n    return 'GET';\n  }\n  return method.toUpperCase();\n}\n\n/**\n* Initialize init object with headers and stringifies the body.\n * @param {!FetchInitDef} init\n * @private\n */\nfunction setupJson_(init) {\n  assert(allowedMethods_.indexOf(init.method) != -1, 'Only one of ' +\n      allowedMethods_.join(', ') + ' is currently allowed. Got %s',\n      init.method);\n\n  init.headers = {\n    'Accept': 'application/json'\n  };\n\n  if (init.method == 'POST') {\n    const bodyType = Object.prototype.toString.call(init.body);\n\n    // Assume JSON strict mode where only objects or arrays are allowed\n    // as body.\n    assert(allowedBodyTypes_.indexOf(bodyType) > -1,\n        'body must be of type object or array. %s',\n        init.body);\n\n    init.headers['Content-Type'] = 'application/json;charset=utf-8';\n    init.body = JSON.stringify(init.body);\n  }\n}\n\n\n/**\n * A minimal polyfill of Fetch API. It only polyfills what we currently use.\n *\n * See https://developer.mozilla.org/en-US/docs/Web/API/GlobalFetch/fetch\n *\n * Notice that the \"fetch\" method itself is not exported as that would require\n * us to immediately support a much wide API.\n *\n * @param {string} input\n * @param {!FetchInitDef=} opt_init\n * @return {!Promise<!FetchResponse>}\n * @private Visible for testing\n */\nexport function fetchPolyfill(input, opt_init) {\n  assert(typeof input == 'string', 'Only URL supported: %s', input);\n  const init = opt_init || {};\n  assert(!init.credentials || init.credentials == 'include',\n      'Only credentials=include support: %s', init.credentials);\n\n  return new Promise(function(resolve, reject) {\n    const xhr = createXhrRequest(init.method || 'GET', input, init);\n\n    if (init.credentials == 'include') {\n      xhr.withCredentials = true;\n    }\n\n    xhr.onreadystatechange = () => {\n      if (xhr.readyState < /* STATUS_RECEIVED */ 2) {\n        return;\n      }\n      if (xhr.status < 100 || xhr.status > 599) {\n        xhr.onreadystatechange = null;\n        reject(new Error(`Unknown HTTP status ${xhr.status}`));\n        return;\n      }\n\n      // TODO(dvoytenko): This is currently simplified: we will wait for the\n      // whole document loading to complete. This is fine for the use cases\n      // we have now, but may need to be reimplemented later.\n      if (xhr.readyState == /* COMPLETE */ 4) {\n        resolve(new FetchResponse(xhr));\n      }\n    };\n    xhr.onerror = () => {\n      reject(new Error('Network failure'));\n    };\n    xhr.onabort = () => {\n      reject(new Error('Request aborted'));\n    };\n\n    if (init.method == 'POST') {\n      xhr.send(init.body);\n    } else {\n      xhr.send();\n    }\n  });\n}\n\n\n/**\n * @param {string} method\n * @param {string} url\n * @param {!FetchInitDef} init\n * @return {!XMLHttpRequest}\n * @private\n */\nfunction createXhrRequest(method, url, init) {\n  let xhr = new XMLHttpRequest();\n  if ('withCredentials' in xhr) {\n    xhr.open(method, url, true);\n  } else if (typeof XDomainRequest != 'undefined') {\n    // IE-specific object.\n    xhr = new XDomainRequest();\n    xhr.open(method, url);\n  } else {\n    throw new Error('CORS is not supported');\n  }\n\n  if (init.headers) {\n    Object.keys(init.headers).forEach(function(header) {\n      xhr.setRequestHeader(header, init.headers[header]);\n    });\n  }\n  return xhr;\n}\n\n\n/**\n * Returns the response if successful or otherwise throws an error.\n * @paran {!FetchResponse} response\n * @return {!FetchResponse}\n */\nfunction assertSuccess(response) {\n  if (response.status < 200 || response.status > 299) {\n    throw new Error(`HTTP error ${response.status}`);\n  }\n  return response;\n}\n\n\n/**\n * Response object in the Fetch API.\n *\n * See https://developer.mozilla.org/en-US/docs/Web/API/GlobalFetch/fetch\n */\nclass FetchResponse {\n  /**\n   * @param {!XMLHttpRequest} xhr\n   */\n  constructor(xhr) {\n    /** @private @const {!XMLHttpRequest} */\n    this.xhr_ = xhr;\n\n    /** @type {number} */\n    this.status = this.xhr_.status;\n\n    /** @type {boolean} */\n    this.bodyUsed = false;\n  }\n\n  /**\n   * Drains the response and returns the text.\n   * @return {!Promise<string>}\n   * @private\n   */\n  drainText_() {\n    assert(!this.bodyUsed, 'Body already used');\n    this.bodyUsed = true;\n    return Promise.resolve(this.xhr_.responseText);\n  }\n\n  /**\n   * Drains the response and returns the JSON object.\n   * @return {!Promise<!JSONValue>}\n   */\n  json() {\n    return this.drainText_().then(JSON.parse);\n  }\n}\n\n\n/**\n * @param {!Window} window\n * @return {!Xhr}\n */\nexport function xhrFor(window) {\n  return getService(window, 'xhr', () => {\n    return new Xhr(window);\n  });\n};\n"]}