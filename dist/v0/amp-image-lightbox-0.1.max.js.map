{"version":3,"sources":["node_modules/browserify/node_modules/browser-pack/_prelude.js","build/all/v0/amp-image-lightbox-0.1.max.js","node_modules/browserify/node_modules/process/browser.js","src/animation.js","src/asserts.js","src/curve.js","src/dom.js","src/event-helper.js","src/gesture-recognizers.js","src/gesture.js","src/history.js","src/layout-rect.js","src/layout.js","src/log.js","src/mode.js","src/motion.js","src/observable.js","src/pass.js","src/service.js","src/srcset.js","src/style.js","src/timer.js","src/transition.js","src/url.js","src/vsync.js"],"names":[],"mappings":"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","file":"amp-image-lightbox-0.1.max.js","sourceRoot":"/source/","sourcesContent":["(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require==\"function\"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error(\"Cannot find module '\"+o+\"'\");throw f.code=\"MODULE_NOT_FOUND\",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require==\"function\"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})","/**\n * Copyright 2015 The AMP HTML Authors. All Rights Reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS-IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {Animation} from '../../../src/animation';\nimport {Gestures} from '../../../src/gesture';\nimport {DoubletapRecognizer, SwipeXYRecognizer, TapRecognizer,\n    TapzoomRecognizer} from '../../../src/gesture-recognizers';\nimport {Layout} from '../../../src/layout';\nimport {assert} from '../../../src/asserts';\nimport {bezierCurve} from '../../../src/curve';\nimport {continueMotion} from '../../../src/motion';\nimport {historyFor} from '../../../src/history';\nimport {isLoaded, loadPromise} from '../../../src/event-helper';\nimport {layoutRectFromDomRect, layoutRectLtwh, moveLayoutRect}\n    from '../../../src/layout-rect';\nimport {parseSrcset} from '../../../src/srcset';\nimport {timer} from '../../../src/timer';\nimport * as dom from '../../../src/dom';\nimport * as st from '../../../src/style';\nimport * as tr from '../../../src/transition';\n\n\n/** @private @const {!Object<string, boolean>} */\nconst SUPPORTED_ELEMENTS_ = {\n  'amp-img': true,\n  'amp-anim': true\n};\n\n/** @private @const {!Curve} */\nconst ENTER_CURVE_ = bezierCurve(0.4, -0.3, 0.2, 1);\n\n/** @private @const {!Curve} */\nconst EXIT_CURVE_ = bezierCurve(0.4, 0, 0.2, 1);\n\n/** @private @const {!Curve} */\nconst PAN_ZOOM_CURVE_ = bezierCurve(0.4, 0, 0.2, 1.4);\n\n\n/**\n * This class is responsible providing all operations necessary for viewing\n * an image, such as full-bleed display, zoom and pan, etc.\n * @package  Visible for testing only!\n * TODO(dvoytenko): move to the separate file once build system is ready.\n */\nexport class ImageViewer {\n  /**\n   * @param {!AmpImageLightbox} lightbox\n   */\n  constructor(lightbox) {\n    /** @private {!AmpImageLightbox} */\n    this.lightbox_ = lightbox;\n\n    /** @private {!Element} */\n    this.viewer_ = document.createElement('div');\n    this.viewer_.classList.add('-amp-image-lightbox-viewer');\n\n    /** @private {!Element} */\n    this.image_ = document.createElement('img');\n    this.image_.classList.add('-amp-image-lightbox-viewer-image');\n    this.viewer_.appendChild(this.image_);\n\n    /** @private {?Srcset} */\n    this.srcset_ = null;\n\n    /** @private {number} */\n    this.sourceWidth_ = 0;\n\n    /** @private {number} */\n    this.sourceHeight_ = 0;\n\n    /** @private {!LayoutRect} */\n    this.viewerBox_ = layoutRectLtwh(0, 0, 0, 0);\n\n    /** @private {!LayoutRect} */\n    this.imageBox_ = layoutRectLtwh(0, 0, 0, 0);\n\n    /** @private {number} */\n    this.scale_ = 1;\n    /** @private {number} */\n    this.startScale_ = 1;\n    /** @private {number} */\n    this.maxSeenScale_ = 1;\n    /** @private {number} */\n    this.minScale_ = 1;\n    /** @private {number} */\n    this.maxScale_ = 2;\n\n    /** @private {number} */\n    this.startX_ = 0;\n    /** @private {number} */\n    this.startY_ = 0;\n    /** @private {number} */\n    this.posX_ = 0;\n    /** @private {number} */\n    this.posY_ = 0;\n    /** @private {number} */\n    this.minX_ = 0;\n    /** @private {number} */\n    this.minY_ = 0;\n    /** @private {number} */\n    this.maxX_ = 0;\n    /** @private {number} */\n    this.maxY_ = 0;\n\n    /** @private {?Motion} */\n    this.motion_ = null;\n\n    this.setupGestures_();\n  }\n\n  /**\n   * Returns the root element of the image viewer.\n   * @return {!Element}\n   */\n  getElement() {\n    return this.viewer_;\n  }\n\n  /**\n   * Returns the img element of the image viewer.\n   * @return {!Element}\n   */\n  getImage() {\n    return this.image_;\n  }\n\n  /**\n   * Returns the boundaries of the viewer.\n   * @return {!LayoutRect}\n   */\n  getViewerBox() {\n    return this.viewerBox_;\n  }\n\n  /**\n   * Returns the boundaries of the image element.\n   * @return {!LayoutRect}\n   */\n  getImageBox() {\n    return this.imageBox_;\n  }\n\n  /**\n   * Returns the boundaries of the image element with the offset if it was\n   * moved by a gesture.\n   * @return {!LayoutRect}\n   */\n  getImageBoxWithOffset() {\n    if (this.posX_ == 0 && this.posY_ == 0) {\n      return this.imageBox_;\n    }\n    return moveLayoutRect(this.imageBox_, this.posX_, this.posY_);\n  }\n\n  /**\n   * Resets the image viewer to the initial state.\n   */\n  reset() {\n    this.image_.setAttribute('src', '');\n    this.srcset_ = null;\n    this.imageBox_ = layoutRectLtwh(0, 0, 0, 0);\n    this.sourceWidth_ = 0;\n    this.sourceHeight_ = 0;\n\n    this.maxSeenScale_ = 1;\n    this.scale_ = 1;\n    this.startScale_ = 1;\n    this.maxScale_ = 2;\n\n    this.startX_ = 0;\n    this.startY_ = 0;\n    this.posX_ = 0;\n    this.posY_ = 0;\n    this.minX_ = 0;\n    this.minY_ = 0;\n    this.maxX_ = 0;\n    this.maxY_ = 0;\n\n    if (this.motion_) {\n      this.motion_.halt();\n    }\n    this.motion_ = null;\n  }\n\n  /**\n   * Initializes the image viewer to the target image element such as\n   * \"amp-img\". The target image element may or may not yet have the img\n   * element initialized.\n   * @param {!Element} sourceElement\n   * @param {?Element} sourceImage\n   */\n  init(sourceElement, sourceImage) {\n    this.sourceWidth_ = sourceElement./*OK*/offsetWidth;\n    this.sourceHeight_ = sourceElement./*OK*/offsetHeight;\n    this.srcset_ = parseSrcset(sourceElement.getAttribute('srcset') ||\n        sourceElement.getAttribute('src'));\n    if (sourceImage && isLoaded(sourceImage) && sourceImage.src) {\n      // Set src provisionally to the known loaded value for fast display.\n      // It will be updated later.\n      this.image_.setAttribute('src', sourceImage.src);\n    }\n  }\n\n  /**\n   * Measures the image viewer and image sizes and positioning.\n   * @return {!Promise}\n   */\n  measure() {\n    this.viewerBox_ = layoutRectFromDomRect(this.viewer_\n        ./*OK*/getBoundingClientRect());\n\n    const sf = Math.min(this.viewerBox_.width / this.sourceWidth_,\n        this.viewerBox_.height / this.sourceHeight_);\n    let width = Math.min(this.sourceWidth_ * sf, this.viewerBox_.width);\n    let height = Math.min(this.sourceHeight_ * sf, this.viewerBox_.height);\n\n    // TODO(dvoytenko): This is to reduce very small expansions that often\n    // look like a stutter. To be evaluated if this is still the right\n    // idea.\n    if (width - this.sourceWidth_ <= 16) {\n      width = this.sourceWidth_;\n      height = this.sourceHeight_;\n    }\n\n    this.imageBox_ = layoutRectLtwh(\n        Math.round((this.viewerBox_.width - width) / 2),\n        Math.round((this.viewerBox_.height - height) / 2),\n        Math.round(width),\n        Math.round(height));\n\n    st.setStyles(this.image_, {\n      top: st.px(this.imageBox_.top),\n      left: st.px(this.imageBox_.left),\n      width: st.px(this.imageBox_.width),\n      height: st.px(this.imageBox_.height)\n    });\n\n    // Reset zoom and pan.\n    this.startScale_ = this.scale_ = 1;\n    this.startX_ = this.posX_ = 0;\n    this.startY_ = this.posY_ = 0;\n    this.updatePanZoomBounds_(this.scale_);\n    this.updatePanZoom_();\n\n    return this.updateSrc_();\n  }\n\n  /**\n   * @return {!Promise}\n   * @private\n   */\n  updateSrc_() {\n    this.maxSeenScale_ = Math.max(this.maxSeenScale_, this.scale_);\n    const width = this.imageBox_.width * this.maxSeenScale_;\n    const src = this.srcset_.select(width, this.lightbox_.getDpr()).url;\n    if (src == this.image_.getAttribute('src')) {\n      return Promise.resolve();\n    }\n    // Notice that we will wait until the next event cycle to set the \"src\".\n    // This ensures that the already available image will show immediately\n    // and then naturally upgrade to a higher quality image.\n    return timer.promise(1).then(() => {\n      this.image_.setAttribute('src', src);\n      return loadPromise(this.image_);\n    });\n  }\n\n  /** @private */\n  setupGestures_() {\n    const gestures = Gestures.get(this.image_);\n\n    // Toggle viewer mode.\n    gestures.onGesture(TapRecognizer, () => {\n      this.lightbox_.toggleViewMode();\n    });\n\n    // Movable.\n    gestures.onGesture(SwipeXYRecognizer, e => {\n      this.onMove_(e.data.deltaX, e.data.deltaY, false);\n      if (e.data.last) {\n        this.onMoveRelease_(e.data.velocityX, e.data.velocityY);\n      }\n    });\n    gestures.onPointerDown(() => {\n      if (this.motion_) {\n        this.motion_.halt();\n      }\n    });\n\n    // Zoomable.\n    gestures.onGesture(DoubletapRecognizer, e => {\n      let newScale;\n      if (this.scale_ == 1) {\n        newScale = this.maxScale_;\n      } else {\n        newScale = this.minScale_;\n      }\n      const deltaX = this.viewerBox_.width / 2 - e.data.clientX;\n      const deltaY = this.viewerBox_.height / 2 - e.data.clientY;\n      this.onZoom_(newScale, deltaX, deltaY, true).then(() => {\n        return this.onZoomRelease_(0, 0, 0, 0, 0, 0);\n      });\n    });\n    gestures.onGesture(TapzoomRecognizer, e => {\n      this.onZoomInc_(e.data.centerClientX, e.data.centerClientY,\n          e.data.deltaX, e.data.deltaY);\n      if (e.data.last) {\n        this.onZoomRelease_(e.data.centerClientX, e.data.centerClientY,\n            e.data.deltaX, e.data.deltaY, e.data.velocityY, e.data.velocityY);\n      }\n    });\n  }\n\n  /**\n   * Returns value bound to min and max values +/- extent.\n   * @param {number} v\n   * @param {number} min\n   * @param {number} max\n   * @param {number} extent\n   * @return {number}\n   * @private\n   */\n  boundValue_(v, min, max, extent) {\n    return Math.max(min - extent, Math.min(max + extent, v));\n  }\n\n  /**\n   * Returns the scale within the allowed range with possible extent.\n   * @param {number} s\n   * @param {boolean} allowExtent\n   * @return {number}\n   * @private\n   */\n  boundScale_(s, allowExtent) {\n    return this.boundValue_(s, this.minScale_, this.maxScale_,\n        allowExtent ? 0.25 : 0);\n  }\n\n  /**\n   * Returns the X position within the allowed range with possible extent.\n   * @param {number} x\n   * @param {boolean} allowExtent\n   * @return {number}\n   * @private\n   */\n  boundX_(x, allowExtent) {\n    return this.boundValue_(x, this.minX_, this.maxX_,\n        allowExtent && this.scale_ > 1 ? this.viewerBox_.width * 0.25 : 0);\n  }\n\n  /**\n   * Returns the Y position within the allowed range with possible extent.\n   * @param {number} y\n   * @param {boolean} allowExtent\n   * @return {number}\n   * @private\n   */\n  boundY_(y, allowExtent) {\n    return this.boundValue_(y, this.minY_, this.maxY_,\n        allowExtent ? this.viewerBox_.height * 0.25 : 0);\n  }\n\n  /**\n   * Updates X/Y bounds based on the provided scale value. The min/max bounds\n   * are calculated to allow full pan of the image regardless of the scale\n   * value.\n   * @param {number} scale\n   * @private\n   */\n  updatePanZoomBounds_(scale) {\n    let maxY = 0;\n    let minY = 0;\n    const dh = this.viewerBox_.height - this.imageBox_.height * scale;\n    if (dh >= 0) {\n      minY = maxY = 0;\n    } else {\n      minY = dh / 2;\n      maxY = -minY;\n    }\n\n    let maxX = 0;\n    let minX = 0;\n    const dw = this.viewerBox_.width - this.imageBox_.width * scale;\n    if (dw >= 0) {\n      minX = maxX = 0;\n    } else {\n      minX = dw / 2;\n      maxX = -minX;\n    }\n\n    this.minX_ = minX;\n    this.minY_ = minY;\n    this.maxX_ = maxX;\n    this.maxY_ = maxY;\n  }\n\n  /**\n   * Updates pan/zoom of the image based on the current values.\n   * @private\n   */\n  updatePanZoom_() {\n    st.setStyles(this.image_, {\n      transform: st.translate(this.posX_, this.posY_) +\n          ' ' + st.scale(this.scale_)\n    });\n    if (this.scale_ != 1) {\n      this.lightbox_.toggleViewMode(true);\n    }\n  }\n\n  /**\n   * Performs a one-step or an animated motion (panning).\n   * @param {number} deltaX\n   * @param {number} deltaY\n   * @param {boolean} animate\n   * @private\n   */\n  onMove_(deltaX, deltaY, animate) {\n    const newPosX = this.boundX_(this.startX_ + deltaX, true);\n    const newPosY = this.boundY_(this.startY_ + deltaY, true);\n    this.set_(this.scale_, newPosX, newPosY, animate);\n  }\n\n  /**\n   * Performs actions once the motion gesture has been complete. The motion\n   * may continue based on the final velocity.\n   * @param {number} veloX\n   * @param {number} veloY\n   * @private\n   */\n  onMoveRelease_(veloX, veloY) {\n    const deltaY = this.posY_ - this.startY_;\n    if (this.scale_ == 1 && Math.abs(deltaY) > 10) {\n      this.lightbox_.close();\n      return;\n    }\n\n    // Continue motion.\n    this.motion_ = continueMotion(this.posX_, this.posY_, veloX, veloY,\n        (x, y) => {\n          const newPosX = this.boundX_(x, true);\n          const newPosY = this.boundY_(y, true);\n          if (Math.abs(newPosX - this.posX_) < 1 &&\n                Math.abs(newPosY - this.posY_) < 1) {\n            // Hit the wall: stop motion.\n            return false;\n          }\n          this.set_(this.scale_, newPosX, newPosY, false);\n          return true;\n        });\n\n    // Snap back.\n    this.motion_.thenAlways(() => {\n      this.motion_ = null;\n      return this.release_();\n    });\n  }\n\n  /**\n   * Performs a one-step zoom action.\n   * @param {number} centerClientX\n   * @param {number} centerClientY\n   * @param {number} deltaX\n   * @param {number} deltaY\n   * @private\n   */\n  onZoomInc_(centerClientX, centerClientY, deltaX, deltaY) {\n    const dist = Math.sqrt(deltaX * deltaX + deltaY * deltaY);\n\n    const zoomSign = Math.abs(deltaY) > Math.abs(deltaX) ?\n        Math.sign(deltaY) : Math.sign(-deltaX);\n    if (zoomSign == 0) {\n      return;\n    }\n\n    const newScale = this.startScale_ * (1 + zoomSign * dist / 100);\n    const deltaCenterX = this.viewerBox_.width / 2 - centerClientX;\n    const deltaCenterY = this.viewerBox_.height / 2 - centerClientY;\n    deltaX = Math.min(deltaCenterX, deltaCenterX * (dist / 100));\n    deltaY = Math.min(deltaCenterY, deltaCenterY * (dist / 100));\n    this.onZoom_(newScale, deltaX, deltaY, false);\n  }\n\n  /**\n   * Performs a one-step or an animated zoom action.\n   * @param {number} scale\n   * @param {number} deltaX\n   * @param {number} deltaY\n   * @param {boolean} animate\n   * @return {!Promise}\n   * @private\n   */\n  onZoom_(scale, deltaX, deltaY, animate) {\n    const newScale = this.boundScale_(scale, true);\n    if (newScale == this.scale_) {\n      return;\n    }\n\n    this.updatePanZoomBounds_(newScale);\n\n    const newPosX = this.boundX_(this.startX_ + deltaX * newScale, false);\n    const newPosY = this.boundY_(this.startY_ + deltaY * newScale, false);\n    return this.set_(newScale, newPosX, newPosY, animate);\n  }\n\n  /**\n   * Performs actions after the gesture that was performing zooming has been\n   * released. The zooming may continue based on the final velocity.\n   * @param {number} centerClientX\n   * @param {number} centerClientY\n   * @param {number} deltaX\n   * @param {number} deltaY\n   * @param {number} veloX\n   * @param {number} veloY\n   * @return {!Promise}\n   * @private\n   */\n  onZoomRelease_(centerClientX, centerClientY, deltaX, deltaY, veloX, veloY) {\n    let promise;\n    if (veloX == 0 && veloY == 0) {\n      promise = Promise.resolve();\n    } else {\n      promise = continueMotion(deltaX, deltaY, veloX, veloY, (x, y) => {\n        this.onZoomInc_(centerClientX, centerClientY, x, y);\n        return true;\n      }).thenAlways();\n    }\n\n    const relayout = this.scale_ > this.startScale_;\n    return promise.then(() => {\n      return this.release_();\n    }).then(() => {\n      if (relayout) {\n        this.updateSrc_();\n      }\n    });\n  }\n\n  /**\n   * Sets or animates pan/zoom parameters.\n   * @param {number} newScale\n   * @param {number} newPosX\n   * @param {number} newPosY\n   * @param {boolean} animate\n   * @return {!Promise}\n   * @private\n   */\n  set_(newScale, newPosX, newPosY, animate) {\n    const ds = newScale - this.scale_;\n    const dx = newPosX - this.posX_;\n    const dy = newPosY - this.posY_;\n    const dist = Math.sqrt(dx * dx + dy * dy);\n\n    let dur = 0;\n    if (animate) {\n      const maxDur = 250;\n      dur = Math.min(maxDur, Math.max(\n          maxDur * dist * 0.01,      // Moving component.\n          maxDur * Math.abs(ds)));   // Zooming component.\n    }\n\n    let promise;\n    if (dur > 16 && animate) {\n      const scaleFunc = tr.numeric(this.scale_, newScale);\n      const xFunc = tr.numeric(this.posX_, newPosX);\n      const yFunc = tr.numeric(this.posY_, newPosY);\n      promise = Animation.animate(time => {\n        this.scale_ = scaleFunc(time);\n        this.posX_ = xFunc(time);\n        this.posY_ = yFunc(time);\n        this.updatePanZoom_();\n      }, dur, PAN_ZOOM_CURVE_).thenAlways(() => {\n        this.scale_ = newScale;\n        this.posX_ = newPosX;\n        this.posY_ = newPosY;\n        this.updatePanZoom_();\n      });\n    } else {\n      this.scale_ = newScale;\n      this.posX_ = newPosX;\n      this.posY_ = newPosY;\n      this.updatePanZoom_();\n      if (animate) {\n        promise = Promise.resolve();\n      } else {\n        promise = undefined;\n      }\n    }\n\n    return promise;\n  }\n\n  /**\n   * Sets or animates pan/zoom parameters after release of the gesture.\n   * @return {!Promise}\n   * @private\n   */\n  release_() {\n    const newScale = this.boundScale_(this.scale_, false);\n    if (newScale != this.scale_) {\n      this.updatePanZoomBounds_(newScale);\n    }\n    const newPosX = this.boundX_(this.posX_ / this.scale_ * newScale, false);\n    const newPosY = this.boundY_(this.posY_ / this.scale_ * newScale, false);\n    return this.set_(newScale, newPosX, newPosY, true).then(() => {\n      this.startScale_ = this.scale_;\n      this.startX_ = this.posX_;\n      this.startY_ = this.posY_;\n    });\n  }\n}\n\n\n/**\n * This class implements \"amp-image-lightbox\" extension element.\n */\nclass AmpImageLightbox extends AMP.BaseElement {\n\n  /** @override */\n  isLayoutSupported(layout) {\n    return layout == Layout.NODISPLAY;\n  }\n\n  /** @override */\n  isReadyToBuild() {\n    return true;\n  }\n\n  /** @override */\n  buildCallback() {\n\n    /** @private {number} */\n    this.historyId_ = -1;\n\n    /** @private {boolean} */\n    this.active_ = false;\n\n    /** @private {boolean} */\n    this.entering_ = false;\n\n    /** @private {?Element} */\n    this.sourceElement_ = null;\n\n    /** @private {?Element} */\n    this.sourceImage_ = null;\n\n    /** @private {?UnlistenDef} */\n    this.unlistenViewport_ = null;\n\n    /** @private {!Element} */\n    this.container_ = document.createElement('div');\n    this.container_.classList.add('-amp-image-lightbox-container');\n    this.element.appendChild(this.container_);\n\n    /** @private {!ImageViewer} */\n    this.imageViewer_ = new ImageViewer(this);\n    this.container_.appendChild(this.imageViewer_.getElement());\n\n    /** @private {!Element} */\n    this.captionElement_ = document.createElement('div');\n    this.captionElement_.classList.add('amp-image-lightbox-caption');\n    this.captionElement_.classList.add('-amp-image-lightbox-caption');\n    this.container_.appendChild(this.captionElement_);\n\n    const gestures = Gestures.get(this.element);\n    this.element.addEventListener('click', e => {\n      if (!this.entering_ &&\n            !this.imageViewer_.getImage().contains(e.target)) {\n        this.close();\n      }\n    });\n    gestures.onGesture(TapRecognizer, () => {\n      if (!this.entering_) {\n        this.close();\n      }\n    });\n    gestures.onGesture(SwipeXYRecognizer, () => {\n      // Consume to block scroll events and side-swipe.\n    });\n  }\n\n  /** @override */\n  activate(invocation) {\n    if (this.active_) {\n      return;\n    }\n\n    const source = invocation.source;\n    assert(source && SUPPORTED_ELEMENTS_[source.tagName.toLowerCase()],\n        'Unsupported element: %s', source.tagName);\n\n    this.active_ = true;\n    this.reset_();\n    this.init_(source);\n\n    /**  @private {function(this:AmpImageLightbox, Event)}*/\n    this.boundCloseOnEscape_ = this.closeOnEscape_.bind(this);\n    this.getWin().document.documentElement.addEventListener(\n        'keydown', this.boundCloseOnEscape_);\n\n    // Prepare to enter in lightbox\n    this.requestFullOverlay();\n    this.getViewport().disableTouchZoom();\n\n    this.enter_();\n\n    this.unlistenViewport_ = this.getViewport().onChanged(() => {\n      if (this.active_) {\n        this.imageViewer_.measure();\n      }\n    });\n\n    this.getHistory_().push(this.close.bind(this)).then(historyId => {\n      this.historyId_ = historyId;\n    });\n  }\n\n  /**\n   * Handles closing the lightbox when the ESC key is pressed.\n   * @param {!Event} event.\n   * @private\n   */\n  closeOnEscape_(event) {\n    if (event.keyCode == 27) {\n      this.close();\n    }\n  }\n\n  /**\n   * Closes the lightbox.\n   */\n  close() {\n    if (!this.active_) {\n      return;\n    }\n    this.active_ = false;\n    this.entering_ = false;\n\n    this.exit_();\n\n    if (this.unlistenViewport_) {\n      this.unlistenViewport_();\n      this.unlistenViewport_ = null;\n    }\n\n    this.cancelFullOverlay();\n    this.getViewport().restoreOriginalTouchZoom();\n    if (this.historyId_ != -1) {\n      this.getHistory_().pop(this.historyId_);\n    }\n    this.getWin().document.documentElement.removeEventListener(\n        'keydown', this.boundCloseOnEscape_);\n    this.boundCloseOnEscape_ = null;\n  }\n\n  /**\n   * Toggles the view mode.\n   * @param {boolean=} opt_on\n   */\n  toggleViewMode(opt_on) {\n    if (opt_on !== undefined) {\n      this.container_.classList.toggle('-amp-image-lightbox-view-mode', opt_on);\n    } else {\n      this.container_.classList.toggle('-amp-image-lightbox-view-mode');\n    }\n  }\n\n  /**\n   * @param {!Element} sourceElement\n   * @param {!Element} sourceImage\n   * @private\n   */\n  init_(sourceElement) {\n    this.sourceElement_ = sourceElement;\n\n    // Initialize the viewer.\n    this.sourceImage_ = dom.elementByTag(sourceElement, 'img');\n    this.imageViewer_.init(this.sourceElement_, this.sourceImage_);\n\n    // Discover caption.\n    let caption = null;\n\n    // 1. Check <figure> and <figcaption>.\n    if (!caption) {\n      const figure = dom.closestByTag(sourceElement, 'figure');\n      if (figure) {\n        caption = dom.elementByTag(figure, 'figcaption');\n      }\n    }\n\n    // 2. Check \"aria-describedby\".\n    if (!caption) {\n      const describedBy = sourceElement.getAttribute('aria-describedby');\n      caption = document.getElementById(describedBy);\n    }\n\n    if (caption) {\n      dom.copyChildren(caption, this.captionElement_);\n    }\n    this.captionElement_.classList.toggle('-amp-empty', !caption);\n  }\n\n  /** @private */\n  reset_() {\n    this.imageViewer_.reset();\n    dom.removeChildren(this.captionElement_);\n    this.sourceElement_ = null;\n    this.sourceImage_ = null;\n    this.toggleViewMode(false);\n  }\n\n  /**\n   * @return {!Promise}\n   * @private\n   */\n  enter_() {\n    this.entering_ = true;\n\n    st.setStyles(this.element, {\n      opacity: 0,\n      display: ''\n    });\n    this.imageViewer_.measure();\n\n    const anim = new Animation();\n    const dur = 500;\n\n    // Lightbox background fades in.\n    anim.add(0, tr.setStyles(this.element, {\n      opacity: tr.numeric(0, 1)\n    }), 0.6, ENTER_CURVE_);\n\n    // Try to transition from the source image.\n    let transLayer = null;\n    if (this.sourceImage_ && isLoaded(this.sourceImage_) &&\n            this.sourceImage_.src) {\n      transLayer = document.createElement('div');\n      transLayer.classList.add('-amp-image-lightbox-trans');\n      document.body.appendChild(transLayer);\n\n      const rect = layoutRectFromDomRect(this.sourceImage_\n          ./*OK*/getBoundingClientRect());\n      const clone = this.sourceImage_.cloneNode(true);\n      st.setStyles(clone, {\n        position: 'absolute',\n        top: st.px(rect.top),\n        left: st.px(rect.left),\n        width: st.px(rect.width),\n        height: st.px(rect.height)\n      });\n      transLayer.appendChild(clone);\n\n      this.sourceImage_.classList.add('-amp-ghost');\n\n      // Move the image to the location given by the lightbox.\n      const imageBox = this.imageViewer_.getImageBox();\n      const dx = imageBox.left - rect.left;\n      const dy = imageBox.top - rect.top;\n      // Duration will be somewhere between 0.2 and 0.8 depending on how far\n      // the image needs to move.\n      const motionTime = Math.max(0.2, Math.min(0.8, Math.abs(dy) / 250 * 0.8));\n      anim.add(0, tr.setStyles(clone, {\n        transform: tr.translate(tr.numeric(0, dx), tr.numeric(0, dy))\n      }), motionTime, ENTER_CURVE_);\n\n      // Fade in the container. This will mostly affect the caption.\n      st.setStyles(this.container_, {opacity: 0});\n      anim.add(0.8, tr.setStyles(this.container_, {\n        opacity: tr.numeric(0, 1)\n      }), 0.1, ENTER_CURVE_);\n\n      // At the end, fade out the transition image.\n      anim.add(0.9, tr.setStyles(transLayer, {\n        opacity: tr.numeric(1, 0.01)\n      }), 0.1, EXIT_CURVE_);\n    }\n\n    return anim.start(dur).thenAlways(() => {\n      this.entering_ = false;\n      st.setStyles(this.element, {opacity: ''});\n      st.setStyles(this.container_, {opacity: ''});\n      if (transLayer) {\n        document.body.removeChild(transLayer);\n      }\n    });\n  }\n\n  /**\n   * @return {!Promise}\n   * @private\n   */\n  exit_() {\n    const image = this.imageViewer_.getImage();\n    const imageBox = this.imageViewer_.getImageBoxWithOffset();\n\n    const anim = new Animation();\n    let dur = 500;\n\n    // Lightbox background fades out.\n    anim.add(0, tr.setStyles(this.element, {\n      opacity: tr.numeric(1, 0)\n    }), 0.9, EXIT_CURVE_);\n\n    // Try to transition to the source image.\n    let transLayer = null;\n    if (isLoaded(image) && image.src && this.sourceImage_) {\n      transLayer = document.createElement('div');\n      transLayer.classList.add('-amp-image-lightbox-trans');\n      document.body.appendChild(transLayer);\n\n      const rect = layoutRectFromDomRect(this.sourceImage_\n          ./*OK*/getBoundingClientRect());\n      const newLeft = imageBox.left + (imageBox.width - rect.width) / 2;\n      const newTop = imageBox.top + (imageBox.height - rect.height) / 2;\n      const clone = image.cloneNode(true);\n      st.setStyles(clone, {\n        position: 'absolute',\n        top: st.px(newTop),\n        left: st.px(newLeft),\n        width: st.px(rect.width),\n        height: st.px(rect.height),\n        transform: ''\n      });\n      transLayer.appendChild(clone);\n\n      // Fade out the container.\n      anim.add(0, tr.setStyles(this.container_, {\n        opacity: tr.numeric(1, 0)\n      }), 0.1, EXIT_CURVE_);\n\n      // Move the image back to where it is in the article.\n      const dx = rect.left - newLeft;\n      const dy = rect.top - newTop;\n      const move = tr.setStyles(clone, {\n        transform: tr.translate(tr.numeric(0, dx), tr.numeric(0, dy))\n      });\n      // Duration will be somewhere between 0.2 and 0.8 depending on how far\n      // the image needs to move. Start the motion later too, but no later\n      // than 0.2.\n      const motionTime = Math.max(0.2, Math.min(0.8, Math.abs(dy) / 250 * 0.8));\n      anim.add(Math.min(0.8 - motionTime, 0.2), (time, complete) => {\n        move(time);\n        if (complete) {\n          this.sourceImage_.classList.remove('-amp-ghost');\n        }\n      }, motionTime, EXIT_CURVE_);\n\n      // Fade out the transition image.\n      anim.add(0.8, tr.setStyles(transLayer, {\n        opacity: tr.numeric(1, 0.01)\n      }), 0.2, EXIT_CURVE_);\n\n      // Duration will be somewhere between 300ms and 700ms depending on\n      // how far the image needs to move.\n      dur = Math.max(Math.min(Math.abs(dy) / 250 * dur, dur), 300);\n    }\n\n    return anim.start(dur).thenAlways(() => {\n      if (this.sourceImage_) {\n        this.sourceImage_.classList.remove('-amp-ghost');\n      }\n      st.setStyles(this.element, {\n        display: 'none',\n        opacity: ''\n      });\n      st.setStyles(this.container_, {opacity: ''});\n      if (transLayer) {\n        document.body.removeChild(transLayer);\n      }\n      this.reset_();\n    });\n  }\n\n  /** @private {!History} */\n  getHistory_() {\n    return historyFor(this.element.ownerDocument.defaultView);\n  }\n}\n\nAMP.registerElement('amp-image-lightbox', AmpImageLightbox, \"amp-image-lightbox{position:fixed!important;z-index:1000!important;top:0!important;left:0!important;bottom:0!important;right:0!important;margin:0!important;padding:0!important;overflow:hidden!important;-webkit-transform:translateZ(0)!important;transform:translateZ(0)!important;-ms-touch-action:none!important;touch-action:none!important;background:rgba(0,0,0,.95);color:#f2f2f2}.-amp-image-lightbox-container{position:absolute;z-index:0;top:0;left:0;right:0;bottom:0;overflow:hidden;-webkit-transform:translateZ(0);transform:translateZ(0)}.-amp-image-lightbox-trans{pointer-events:none!important;position:fixed;z-index:1001;top:0;left:0;bottom:0;right:0}.-amp-image-lightbox-caption{position:absolute!important;z-index:2!important;bottom:0!important;left:0!important;right:0!important}.-amp-image-lightbox-caption.-amp-empty,.-amp-image-lightbox-view-mode .-amp-image-lightbox-caption{visibility:hidden}.amp-image-lightbox-caption{background:rgba(0,0,0,.5);max-height:25%;padding:8px}.-amp-image-lightbox-viewer{position:absolute;z-index:1;top:0;left:0;right:0;bottom:0;overflow:hidden;-webkit-transform:translateZ(0);transform:translateZ(0)}.-amp-image-lightbox-viewer-image{position:absolute;z-index:1;display:block;-webkit-transform-origin:50% 50%;transform-origin:50% 50%}\\n/*# sourceURL=/extensions/amp-image-lightbox/0.1/amp-image-lightbox.css*/\");\n","// shim for using process in browser\n\nvar process = module.exports = {};\nvar queue = [];\nvar draining = false;\nvar currentQueue;\nvar queueIndex = -1;\n\nfunction cleanUpNextTick() {\n    draining = false;\n    if (currentQueue.length) {\n        queue = currentQueue.concat(queue);\n    } else {\n        queueIndex = -1;\n    }\n    if (queue.length) {\n        drainQueue();\n    }\n}\n\nfunction drainQueue() {\n    if (draining) {\n        return;\n    }\n    var timeout = setTimeout(cleanUpNextTick);\n    draining = true;\n\n    var len = queue.length;\n    while(len) {\n        currentQueue = queue;\n        queue = [];\n        while (++queueIndex < len) {\n            if (currentQueue) {\n                currentQueue[queueIndex].run();\n            }\n        }\n        queueIndex = -1;\n        len = queue.length;\n    }\n    currentQueue = null;\n    draining = false;\n    clearTimeout(timeout);\n}\n\nprocess.nextTick = function (fun) {\n    var args = new Array(arguments.length - 1);\n    if (arguments.length > 1) {\n        for (var i = 1; i < arguments.length; i++) {\n            args[i - 1] = arguments[i];\n        }\n    }\n    queue.push(new Item(fun, args));\n    if (queue.length === 1 && !draining) {\n        setTimeout(drainQueue, 0);\n    }\n};\n\n// v8 likes predictible objects\nfunction Item(fun, array) {\n    this.fun = fun;\n    this.array = array;\n}\nItem.prototype.run = function () {\n    this.fun.apply(null, this.array);\n};\nprocess.title = 'browser';\nprocess.browser = true;\nprocess.env = {};\nprocess.argv = [];\nprocess.version = ''; // empty string to avoid regexp issues\nprocess.versions = {};\n\nfunction noop() {}\n\nprocess.on = noop;\nprocess.addListener = noop;\nprocess.once = noop;\nprocess.off = noop;\nprocess.removeListener = noop;\nprocess.removeAllListeners = noop;\nprocess.emit = noop;\n\nprocess.binding = function (name) {\n    throw new Error('process.binding is not supported');\n};\n\nprocess.cwd = function () { return '/' };\nprocess.chdir = function (dir) {\n    throw new Error('process.chdir is not supported');\n};\nprocess.umask = function() { return 0; };\n","/**\n * Copyright 2015 The AMP HTML Authors. All Rights Reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS-IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {getCurve} from './curve';\nimport {log} from './log';\nimport {timer} from './timer';\nimport {vsyncFor} from './vsync';\n\nconst TAG_ = 'Animation';\n\nconst NOOP_CALLBACK = function() {};\n\n\n/**\n * The animation class allows construction of arbitrary animation processes.\n * The main method is \"add\" that adds a segment of animation at particular\n * time offset (delay) and duration. All animation segments are simply functions\n * of type Transition which are iterated from 0 to 1 in animation frames to\n * achieve the desired effect.\n */\nexport class Animation {\n\n  /**\n   * Creates and starts animation with a single segment. Returns AnimationPlayer\n   * object that can be used to monitor or control animation.\n   *\n   * @param {!Transition<?>} transition Transition to animate.\n   * @param {timeDef} duration Duration in milliseconds.\n   * @param {(!Curve|string)=} opt_curve Optional curve to use for animation.\n   *   Default is the linear animation.\n   * @return {!AnimationPlayer}\n   */\n  static animate(transition, duration, opt_curve) {\n    return new Animation()\n        .setCurve(opt_curve)\n        .add(0, transition, 1)\n        .start(duration);\n  }\n\n  /**\n   * @param {!Vsync=} opt_vsync\n   */\n  constructor(opt_vsync) {\n    /** @private @const */\n    this.vsync_ = opt_vsync || vsyncFor(window);\n\n    /** @private {?Curve} */\n    this.curve_ = null;\n\n    /**\n     * @private @const {!Array<!SegmentDef>}\n     */\n    this.segments_ = [];\n  }\n\n  /**\n   * Sets the default curve for the animation. Each segment is allowed to have\n   * its own curve, but this curve will be used if a segment doesn't specify\n   * its own.\n   * @param {!Curve|string} curve\n   * @return {!Animation}\n   */\n  setCurve(curve) {\n    this.curve_ = getCurve(curve);\n    return this;\n  }\n\n  /**\n   * Adds a segment to the animation. Each segment starts at offset (delay)\n   * and runs for a portion of the overall animation (duration). Note that\n   * both delay and duration and normtimeDef types which accept values from 0 to 1.\n   * Optionally, the time is pushed through a curve. If curve is not specified,\n   * the default animation curve will be used. The specified transition is\n   * animated over the specified duration from 0 to 1.\n   *\n   * @param {normtimeDef} delay\n   * @param {!Transition<?>} transition\n   * @param {normtimeDef} duration\n   * @param {(!Curve|string)=} opt_curve\n   * @return {!Animation}\n   */\n  add(delay, transition, duration, opt_curve) {\n    this.segments_.push({delay: delay, func: transition, duration: duration,\n        curve: getCurve(opt_curve)});\n    return this;\n  }\n\n  /**\n   * Starts the animation and returns the AnimationPlayer object that can be\n   * used to monitor and control the animation.\n   *\n   * @param {timeDef} duration Absolute time in milliseconds.\n   * @return {!AnimationPlayer}\n   */\n  start(duration) {\n    const player = new AnimationPlayer(this.vsync_, this.segments_, this.curve_,\n        duration);\n    player.start_();\n    return player;\n  }\n}\n\n\n/**\n * AnimationPlayer allows tracking and monitoring of the running animation.\n * Most importantly it exposes methods \"then\" and \"thenAlways\" that have the\n * semantics of a Promise and signal when the animation completed or failed.\n * Additionally, it exposes the method \"halt\" which allows to stop/reset the\n * animation.\n * @implements {IThenable}\n */\nclass AnimationPlayer {\n\n  /**\n   * @param {!Vsync} vsync\n   * @param {!Array<!SegmentDef>} segments\n   * @param {?Curve} defaultCurve\n   * @param {timeDef} duration\n   */\n  constructor(vsync, segments, defaultCurve, duration) {\n\n    /** @private @const {!Vsync} */\n    this.vsync_ = vsync;\n\n    /** @private @const {!Array<!SegmentRuntimeDef>} */\n    this.segments_ = [];\n    for (let i = 0; i < segments.length; i++) {\n      const segment = segments[i];\n      this.segments_.push({\n        delay: segment.delay,\n        func: segment.func,\n        duration: segment.duration,\n        curve: segment.curve || defaultCurve,\n        started: false,\n        completed: false\n      });\n    }\n\n    /** @private @const */\n    this.duration_ = duration;\n\n    /** @private {timeDef} */\n    this.startTime_ = 0;\n\n    /** @private {normtimeDef} */\n    this.normLinearTime_ = 0;\n\n    /** @private {normtimeDef} */\n    this.normTime_ = 0;\n\n    /** @private {boolean} */\n    this.running_ = false;\n\n    /** @private {!Object<string, *>} */\n    this.state_ = {};\n\n    /** @const {function()} */\n    this.resolve_;\n\n    /** @const {function()} */\n    this.reject_;\n\n    /** @private {!Promise} */\n    this.promise_ = new Promise((resolve, reject) => {\n      this.resolve_ = resolve;\n      this.reject_ = reject;\n    });\n\n    /** @const */\n    this.task_ = this.vsync_.createAnimTask({\n      mutate: this.stepMutate_.bind(this)\n    });\n  }\n\n  /**\n   * Chains to the animation's promise that will resolve when the animation has\n   * completed or will reject if animation has failed or was interrupted.\n   * @param {!Function=} opt_resolve\n   * @param {!Function=} opt_reject\n   * @return {!Promise}\n   */\n  then(opt_resolve, opt_reject) {\n    if (!opt_resolve && !opt_reject) {\n      return this.promise_;\n    }\n    return this.promise_.then(opt_resolve, opt_reject);\n  }\n\n  /**\n   * Callback for regardless whether the animation succeeds or fails.\n   * @param {!Function=} opt_callback\n   * @return {!Promise}\n   */\n  thenAlways(opt_callback) {\n    const callback = opt_callback || NOOP_CALLBACK;\n    return this.then(callback, callback);\n  }\n\n  /**\n   * Halts the animation. Depending on the opt_dir value, the following actions\n   * can be performed:\n   * 0: No action. The state will be as at the moment of halting (default)\n   * 1: Final state. Transitionable will be set to state = 1.\n   * -1: Reset state. Transitionable will be reset to state = 0.\n   * The animation's promise will be rejected since the transition has been\n   * interrupted.\n   * @param {number=} opt_dir\n   */\n  halt(opt_dir) {\n    this.complete_(/* success */ false, /* dir */ opt_dir || 0);\n  }\n\n  /**\n   * @private\n   */\n  start_() {\n    this.startTime_ = timer.now();\n    this.running_ = true;\n    if (this.vsync_.canAnimate()) {\n      this.task_(this.state_);\n    } else {\n      log.warn(TAG_, 'cannot animate');\n      this.complete_(/* success */ false, /* dir */ 0);\n    }\n  }\n\n  /**\n   * @param {boolean} success\n   * @param {number} dir\n   * @private\n   */\n  complete_(success, dir) {\n    if (!this.running_) {\n      return;\n    }\n    this.running_ = false;\n    if (dir != 0) {\n      // Sort in the completion order.\n      if (this.segments_.length > 1) {\n        this.segments_.sort((s1, s2) => {\n          return (s1.delay + s1.duration) - (s2.delay + s2.duration);\n        });\n      }\n      try {\n        if (dir > 0) {\n          // Natural order - all set to 1.\n          for (let i = 0; i < this.segments_.length; i++) {\n            this.segments_[i].func(1, true);\n          }\n        } else {\n          // Reverse order - all set to 0.\n          for (let i = this.segments_.length - 1; i >= 0; i--) {\n            this.segments_[i].func(0, false);\n          }\n        }\n      } catch (e) {\n        log.error(TAG_, 'completion failed: ' + e, e);\n        success = false;\n      }\n    }\n    if (success) {\n      this.resolve_();\n    } else {\n      this.reject_();\n    }\n  }\n\n  /**\n   * @param {!Object<string, *>} unusedState\n   * @private\n   */\n  stepMutate_(unusedState) {\n    if (!this.running_) {\n      return;\n    }\n    const currentTime = timer.now();\n    const normLinearTime = Math.min((currentTime - this.startTime_) /\n        this.duration_, 1);\n\n    // Start segments due to be started\n    for (let i = 0; i < this.segments_.length; i++) {\n      const segment = this.segments_[i];\n      if (!segment.started && normLinearTime >= segment.delay) {\n        segment.started = true;\n      }\n    }\n\n    // Execute all pending segments.\n    for (let i = 0; i < this.segments_.length; i++) {\n      const segment = this.segments_[i];\n      if (!segment.started || segment.completed) {\n        continue;\n      }\n      this.mutateSegment_(segment, normLinearTime);\n    }\n\n    // Complete or start next cycle.\n    if (normLinearTime == 1) {\n      this.complete_(/* success */ true, /* dir */ 0);\n    } else {\n      if (this.vsync_.canAnimate()) {\n        this.task_(this.state_);\n      } else {\n        log.warn(TAG_, 'cancel animation');\n        this.complete_(/* success */ false, /* dir */ 0);\n      }\n    }\n  }\n\n  /**\n   * @param {!SegmentRuntimeDef} segment\n   * @param {number} totalLinearTime\n   */\n  mutateSegment_(segment, totalLinearTime) {\n    let normLinearTime;\n    let normTime;\n    if (segment.duration > 0) {\n      normLinearTime = Math.min((totalLinearTime - segment.delay) /\n          segment.duration, 1);\n      normTime = normLinearTime;\n      if (segment.curve && normTime != 1) {\n        try {\n          normTime = segment.curve(normLinearTime);\n        } catch (e) {\n          log.error(TAG_, 'step curve failed: ' + e, e);\n          this.complete_(/* success */ false, /* dir */ 0);\n          return;\n        }\n      }\n    } else {\n      normLinearTime = 1;\n      normTime = 1;\n    }\n    if (normLinearTime == 1) {\n      segment.completed = true;\n    }\n    try {\n      segment.func(normTime, segment.completed);\n    } catch (e) {\n      log.error(TAG_, 'step mutate failed: ' + e, e);\n      this.complete_(/* success */ false, /* dir */ 0);\n      return;\n    }\n  }\n}\n\n\n/**\n * @typedef {{\n *   delay: normtimeDef,\n *   func: !Transition,\n *   duration: normtimeDef,\n *   curve: ?Curve\n * }}\n */\nclass SegmentDef {}\n\n\n/**\n * @typedef {{\n *   delay: normtimeDef,\n *   func: !Transition,\n *   duration: normtimeDef,\n *   curve: ?Curve,\n *   started: boolean,\n *   completed: boolean\n * }}\n */\nclass SegmentRuntimeDef {}\n","/**\n * Copyright 2015 The AMP HTML Authors. All Rights Reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS-IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n\n\n/**\n * Throws an error if the first argument isn't trueish.\n *\n * Supports argument substitution into the message via %s placeholders.\n *\n * Throws an error object that has two extra properties:\n * - associatedElement: This is the first element provided in the var args.\n *   It can be used for improved display of error messages.\n * - messageArray: The elements of the substituted message as non-stringified\n *   elements in an array. When e.g. passed to console.error this yields\n *   native displays of things like HTML elements.\n *\n * @param {T} shouldBeTrueish The value to assert. The assert fails if it does\n *     not evaluate to true.\n * @param {string} message The assertion message\n * @param {...*} var_args Arguments substituted into %s in the message.\n * @return {T} The value of shouldBeTrueish.\n * @template T\n */\n/*eslint \"google-camelcase/google-camelcase\": 0*/\nexport function assert(shouldBeTrueish, message, var_args) {\n  let firstElement;\n  if (!shouldBeTrueish) {\n    message = message || 'Assertion failed';\n    const splitMessage = message.split('%s');\n    const first = splitMessage.shift();\n    let formatted = first;\n    const messageArray = [];\n    pushIfNonEmpty(messageArray, first);\n    for (let i = 2; i < arguments.length; i++) {\n      const val = arguments[i];\n      if (val && val.tagName) {\n        firstElement = val;\n      }\n      const nextConstant = splitMessage.shift();\n      messageArray.push(val);\n      pushIfNonEmpty(messageArray, nextConstant.trim());\n      formatted += toString(val) + nextConstant;\n    }\n    const e = new Error(formatted);\n    e.fromAssert = true;\n    e.associatedElement = firstElement;\n    e.messageArray = messageArray;\n    throw e;\n  }\n  return shouldBeTrueish;\n}\n/*eslint \"google-camelcase/google-camelcase\": 2*/\n\n/**\n * @param {*} val\n * @return {string}\n */\nfunction toString(val) {\n  if (val instanceof Element) {\n    return val.tagName.toLowerCase() + (val.id ? '#' + val.id : '');\n  }\n  return val;\n}\n\n/**\n * @param {!Array} array\n * @param {*} val\n */\nfunction pushIfNonEmpty(array, val) {\n  if (val != '') {\n    array.push(val);\n  }\n}\n","/**\n * Copyright 2015 The AMP HTML Authors. All Rights Reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS-IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n\n/**\n * A CurveDef is a function that returns a normtime value (0 to 1) for another\n * normtime value.\n * @typedef {function(normtime):normtime}\n */\nclass CurveDef {};\n\n\n/**\n * Returns a cubic bezier curve.\n * @param {number} x1 X coordinate of the first control point.\n * @param {number} y1 Y coordinate of the first control point.\n * @param {number} x2 X coordinate of the second control point.\n * @param {number} y2 Y coordinate of the second control point.\n * @return {!CurveDef}\n */\nexport function bezierCurve(x1, y1, x2, y2) {\n  const bezier = new Bezier(0, 0, x1, y1, x2, y2, 1, 1);\n  return bezier.solveYValueFromXValue.bind(bezier);\n}\n\n\n/**\n * Thanks to\n * https://closure-library.googlecode.com/git-history/docs/local_closure_goog_math_bezier.js.source.html\n */\nclass Bezier {\n\n  /**\n   * @param {number} x0 X coordinate of the start point.\n   * @param {number} y0 Y coordinate of the start point.\n   * @param {number} x1 X coordinate of the first control point.\n   * @param {number} y1 Y coordinate of the first control point.\n   * @param {number} x2 X coordinate of the second control point.\n   * @param {number} y2 Y coordinate of the second control point.\n   * @param {number} x3 X coordinate of the end point.\n   * @param {number} y3 Y coordinate of the end point.\n   */\n  constructor(x0, y0, x1, y1, x2, y2, x3, y3) {\n    /**\n     * X coordinate of the first point.\n     * @type {number}\n     */\n    this.x0 = x0;\n\n    /**\n     * Y coordinate of the first point.\n     * @type {number}\n     */\n    this.y0 = y0;\n\n    /**\n     * X coordinate of the first control point.\n     * @type {number}\n     */\n    this.x1 = x1;\n\n    /**\n     * Y coordinate of the first control point.\n     * @type {number}\n     */\n    this.y1 = y1;\n\n    /**\n     * X coordinate of the second control point.\n     * @type {number}\n     */\n    this.x2 = x2;\n\n    /**\n     * Y coordinate of the second control point.\n     * @type {number}\n     */\n    this.y2 = y2;\n\n    /**\n     * X coordinate of the end point.\n     * @type {number}\n     */\n    this.x3 = x3;\n\n    /**\n     * Y coordinate of the end point.\n     * @type {number}\n     */\n    this.y3 = y3;\n  }\n\n  /**\n   * Computes the y coordinate of a point on the curve given its x coordinate.\n   * @param {number} xVal The x coordinate of the point on the curve.\n   * @return {number} The y coordinate of the point on the curve.\n   */\n  solveYValueFromXValue(xVal) {\n    return this.getPointY(this.solvePositionFromXValue(xVal));\n  }\n\n  /**\n   * Computes the position t of a point on the curve given its x coordinate.\n   * That is, for an input xVal, finds t s.t. getPointX(t) = xVal.\n   * As such, the following should always be true up to some small epsilon:\n   * t ~ solvePositionFromXValue(getPointX(t)) for t in [0, 1].\n   * @param {number} xVal The x coordinate of the point to find on the curve.\n   * @return {number} The position t.\n   */\n  solvePositionFromXValue(xVal) {\n    // Desired precision on the computation.\n    const epsilon = 1e-6;\n\n    // Initial estimate of t using linear interpolation.\n    let t = (xVal - this.x0) / (this.x3 - this.x0);\n    if (t <= 0) {\n      return 0;\n    } else if (t >= 1) {\n      return 1;\n    }\n\n    // Try gradient descent to solve for t. If it works, it is very fast.\n    let tMin = 0;\n    let tMax = 1;\n    for (let i = 0; i < 8; i++) {\n      const value = this.getPointX(t);\n      const derivative = (this.getPointX(t + epsilon) - value) / epsilon;\n      if (Math.abs(value - xVal) < epsilon) {\n        return t;\n      } else if (Math.abs(derivative) < epsilon) {\n        break;\n      } else {\n        if (value < xVal) {\n          tMin = t;\n        } else {\n          tMax = t;\n        }\n        t -= (value - xVal) / derivative;\n      }\n    }\n\n    // If the gradient descent got stuck in a local minimum, e.g. because\n    // the derivative was close to 0, use a Dichotomy refinement instead.\n    // We limit the number of iterations to 8.\n    for (let i = 0; Math.abs(value - xVal) > epsilon && i < 8; i++) {\n      if (value < xVal) {\n        tMin = t;\n        t = (t + tMax) / 2;\n      } else {\n        tMax = t;\n        t = (t + tMin) / 2;\n      }\n      value = this.getPointX(t);\n    }\n    return t;\n  }\n\n  /**\n   * Computes the curve's X coordinate at a point between 0 and 1.\n   * @param {number} t The point on the curve to find.\n   * @return {number} The computed coordinate.\n   */\n  getPointX(t) {\n    // Special case start and end.\n    if (t == 0) {\n      return this.x0;\n    } else if (t == 1) {\n      return this.x3;\n    }\n\n    // Step one - from 4 points to 3\n    let ix0 = this.lerp(this.x0, this.x1, t);\n    let ix1 = this.lerp(this.x1, this.x2, t);\n    const ix2 = this.lerp(this.x2, this.x3, t);\n\n    // Step two - from 3 points to 2\n    ix0 = this.lerp(ix0, ix1, t);\n    ix1 = this.lerp(ix1, ix2, t);\n\n    // Final step - last point\n    return this.lerp(ix0, ix1, t);\n  }\n\n  /**\n   * Computes the curve's Y coordinate at a point between 0 and 1.\n   * @param {number} t The point on the curve to find.\n   * @return {number} The computed coordinate.\n   */\n  getPointY(t) {\n    // Special case start and end.\n    if (t == 0) {\n      return this.y0;\n    } else if (t == 1) {\n      return this.y3;\n    }\n\n    // Step one - from 4 points to 3\n    let iy0 = this.lerp(this.y0, this.y1, t);\n    let iy1 = this.lerp(this.y1, this.y2, t);\n    const iy2 = this.lerp(this.y2, this.y3, t);\n\n    // Step two - from 3 points to 2\n    iy0 = this.lerp(iy0, iy1, t);\n    iy1 = this.lerp(iy1, iy2, t);\n\n    // Final step - last point\n    return this.lerp(iy0, iy1, t);\n  }\n\n  /**\n   * Performs linear interpolation between values a and b. Returns the value\n   * between a and b proportional to x (when x is between 0 and 1. When x is\n   * outside this range, the return value is a linear extrapolation).\n   * @param {number} a A number.\n   * @param {number} b A number.\n   * @param {number} x The proportion between a and b.\n   * @return {number} The interpolated value between a and b.\n   */\n  lerp(a, b, x) {\n    return a + x * (b - a);\n  }\n};\n\n\n/**\n * A collection of common curves.\n * See https://developer.mozilla.org/en-US/docs/Web/CSS/timing-function\n * @enum {!CurveDef}\n */\nexport const Curves = {\n  /**\n   * linear\n   * @param {number} n\n   * @return {number}\n   */\n  LINEAR: function(n) {return n;},\n\n  /**\n   * ease\n   */\n  EASE: bezierCurve(0.25, 0.1, 0.25, 1.0),\n\n  /**\n   * ease-out: slow out, fast in\n   */\n  EASE_IN: bezierCurve(0.42, 0.0, 1.0, 1.0),\n\n  /**\n   * ease-out: fast out, slow in\n   */\n  EASE_OUT: bezierCurve(0.0, 0.0, 0.58, 1.0),\n\n  /**\n   * ease-in-out\n   */\n  EASE_IN_OUT: bezierCurve(0.42, 0.0, 0.58, 1.0)\n};\n\n\n/**\n * @const {!Object<string, !CurveDef>}\n */\nconst NAME_MAP = {\n  'linear': Curves.LINEAR,\n  'ease': Curves.EASE,\n  'ease-in': Curves.EASE_IN,\n  'ease-out': Curves.EASE_OUT,\n  'ease-in-out': Curves.EASE_IN_OUT\n};\n\n\n/**\n * If the argument is a string, this methods matches an existing curve by name.\n * @param {?CurveDef|string|undefined} curve\n * @return {?CurveDef}\n */\nexport function getCurve(curve) {\n  if (!curve) {\n    return null;\n  }\n  if (typeof curve == 'string') {\n    return NAME_MAP[curve];\n  }\n  return curve;\n}\n","/**\n * Copyright 2015 The AMP HTML Authors. All Rights Reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS-IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n\n/**\n * Removes the element.\n * @param {!Element} element\n */\nexport function removeElement(element) {\n  if (element.parentElement) {\n    element.parentElement.removeChild(element);\n  }\n}\n\n\n/**\n * Removes all child nodes of the specified element.\n * @param {!Element} parent\n */\nexport function removeChildren(parent) {\n  while (parent.firstChild) {\n    parent.removeChild(parent.firstChild);\n  }\n}\n\n\n/**\n * Copies all children nodes of element \"from\" to element \"to\". Child nodes\n * are deeply cloned. Notice, that this method should be used with care and\n * preferably on smaller subtrees.\n * @param {!Element} from\n * @param {!Element} to\n */\nexport function copyChildren(from, to) {\n  const frag = to.ownerDocument.createDocumentFragment();\n  for (let n = from.firstChild; n; n = n.nextSibling) {\n    frag.appendChild(n.cloneNode(true));\n  }\n  to.appendChild(frag);\n}\n\n\n/**\n * Finds the closest element that satisfies the callback from this element\n * up the DOM subtree.\n * @param {!Element} element\n * @param {function(!Element):boolean} callback\n * @return {?Element}\n */\nexport function closest(element, callback) {\n  for (let el = element; el; el = el.parentElement) {\n    if (callback(el)) {\n      return el;\n    }\n  }\n  return null;\n}\n\n\n/**\n * Finds the closest element with the specified name from this element\n * up the DOM subtree.\n * @param {!Element} element\n * @param {string} tagName\n * @return {?Element}\n */\nexport function closestByTag(element, tagName) {\n  tagName = tagName.toUpperCase();\n  return closest(element, el => {\n    return el.tagName == tagName;\n  });\n}\n\n\n/**\n * Finds the first descendant element with the specified name.\n * @param {!Element} element\n * @param {string} tagName\n * @return {?Element}\n */\nexport function elementByTag(element, tagName) {\n  const elements = element.getElementsByTagName(tagName);\n  return elements.length > 0 ? elements[0] : null;\n}\n\n\n/**\n * Finds the first child element that satisfies the callback.\n * @param {!Element} parent\n * @param {function(!Element):boolean} callback\n * @return {?Element}\n */\nexport function childElement(parent, callback) {\n  const children = parent.children;\n  for (let i = 0; i < children.length; i++) {\n    if (callback(children[i])) {\n      return children[i];\n    }\n  }\n  return null;\n}\n\n\n/**\n * Finds the first child element that has the specified attribute, optionally\n * with a value.\n * @param {!Element} parent\n * @param {string} attr\n * @param {string=} opt_value\n * @return {?Element}\n */\nexport function childElementByAttr(parent, attr, opt_value) {\n  return childElement(parent, el => {\n    if (!el.hasAttribute(attr)) {\n      return false;\n    }\n    if (opt_value !== undefined && el.getAttribute(attr) != opt_value) {\n      return false;\n    }\n    return true;\n  });\n}\n\n\n/**\n * Finds the first child element that has the specified tag name.\n * @param {!Element} parent\n * @param {string} tagName\n * @return {?Element}\n */\nexport function childElementByTag(parent, tagName) {\n  tagName = tagName.toUpperCase();\n  return childElement(parent, el => {\n    return el.tagName == tagName;\n  });\n}\n","/**\n * Copyright 2015 The AMP HTML Authors. All Rights Reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS-IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {timer} from './timer';\n\n\n/**\n * Listens for the specified event on the element and removes the listener\n * as soon as event has been received.\n * @param {!EventTarget} element\n * @param {string} eventType\n * @param {function(Event)} listener\n * @param {boolean=} opt_capture\n * @return {!UnlistenDef}\n */\nexport function listenOnce(element, eventType, listener, opt_capture) {\n  const capture = opt_capture || false;\n  let unlisten;\n  const proxy = event => {\n    listener(event);\n    unlisten();\n  };\n  unlisten = () => {\n    element.removeEventListener(eventType, proxy, capture);\n  };\n  element.addEventListener(eventType, proxy, capture);\n  return unlisten;\n}\n\n\n/**\n * Returns  a promise that will resolve as soon as the specified event has\n * fired on the element. Optionally, opt_timeout can be specified that will\n * reject the promise if the event has not fired by then.\n * @param {!EventTarget} element\n * @param {string} eventType\n * @param {boolean=} opt_capture\n * @param {number=} opt_timeout\n * @return {!Promise<!Event>}\n */\nexport function listenOncePromise(element, eventType, opt_capture,\n    opt_timeout) {\n  let unlisten;\n  const eventPromise = new Promise((resolve, unusedReject) => {\n    unlisten = listenOnce(element, eventType, resolve, opt_capture);\n  });\n  return racePromise_(eventPromise, unlisten, opt_timeout);\n}\n\n\n/**\n * Whether the specified element has been loaded already.\n * @param {!Element} element\n * @return {boolean}\n */\nexport function isLoaded(element) {\n  return element.complete || element.readyState == 'complete';\n}\n\n\n/**\n * Returns a promise that will resolve or fail based on the element's 'load'\n * and 'error' events. Optionally this method takes a timeout, which will reject\n * the promise if the resource has not loaded by then.\n * @param {!Element} element\n * @param {number=} opt_timeout\n * @return {!Promise<!Element>}\n */\nexport function loadPromise(element, opt_timeout) {\n  let unlistenLoad;\n  let unlistenError;\n  const loadingPromise = new Promise((resolve, reject) => {\n    if (isLoaded(element)) {\n      resolve(element);\n    } else {\n      // Listen once since IE 5/6/7 fire the onload event continuously for\n      // animated GIFs.\n      if (element.tagName === 'AUDIO' || element.tagName === 'VIDEO') {\n        unlistenLoad = listenOnce(element, 'loadstart', () => resolve(element));\n      } else {\n        unlistenLoad = listenOnce(element, 'load', () => resolve(element));\n      }\n      unlistenError = listenOnce(element, 'error', reject);\n    }\n  });\n  return racePromise_(loadingPromise, () => {\n    // It's critical that all listeners are removed.\n    if (unlistenLoad) {\n      unlistenLoad();\n    }\n    if (unlistenError) {\n      unlistenError();\n    }\n  }, opt_timeout);\n}\n\n\n/**\n * @param {!Promise<TYPE>} promise\n * @param {Unlisten|undefined} unlisten\n * @param {number|undefined} timeout\n * @return {!Promise<TYPE>}\n * @template TYPE\n */\nfunction racePromise_(promise, unlisten, timeout) {\n  let racePromise;\n  if (timeout === undefined) {\n    // Timeout is not specified: return promise.\n    racePromise = promise;\n  } else {\n    // Timeout has been specified: add a timeout condition.\n    racePromise = timer.timeoutPromise(timeout || 0, promise);\n  }\n  if (!unlisten) {\n    return racePromise;\n  }\n  return racePromise.then(result => {\n    unlisten();\n    return result;\n  }, reason => {\n    unlisten();\n    throw reason;\n  });\n}\n","/**\n * Copyright 2015 The AMP HTML Authors. All Rights Reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS-IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {GestureRecognizer} from './gesture';\nimport {calcVelocity} from './motion';\nimport {timer} from './timer';\n\n\n/**\n * A \"tap\" gesture.\n * @typedef {{\n *   clientX: number,\n *   clientY: number\n * }}\n */\nlet TapDef;\n\n\n/**\n * Recognizes \"tap\" gestures.\n * @extends {GestureRecognizer<TapDef>}\n */\nexport class TapRecognizer extends GestureRecognizer {\n  /**\n   * @param {!Gestures} manager\n   */\n  constructor(manager) {\n    super('tap', manager);\n\n    /** @private {number} */\n    this.startX_ = 0;\n\n    /** @private {number} */\n    this.startY_ = 0;\n\n    /** @private {number} */\n    this.lastX_ = 0;\n\n    /** @private {number} */\n    this.lastY_ = 0;\n  }\n\n  /** @override */\n  onTouchStart(e) {\n    const touches = e.touches;\n    if (!touches || touches.length != 1) {\n      return false;\n    }\n    this.startX_ = touches[0].clientX;\n    this.startY_ = touches[0].clientY;\n    return true;\n  }\n\n  /** @override */\n  onTouchMove(e) {\n    const touches = e.changedTouches || e.touches;\n    if (touches && touches.length == 1) {\n      this.lastX_ = touches[0].clientX;\n      this.lastY_ = touches[0].clientY;\n      const dx = Math.abs(this.lastX_ - this.startX_) >= 8;\n      const dy = Math.abs(this.lastY_ - this.startY_) >= 8;\n      if (dx || dy) {\n        return false;\n      }\n    }\n    return true;\n  }\n\n  /** @override */\n  onTouchEnd(unusedE) {\n    this.signalReady(0);\n  }\n\n  /** @override */\n  acceptStart() {\n    this.signalEmit({clientX: this.lastX_, clientY: this.lastY_}, null);\n    this.signalEnd();\n  }\n}\n\n\n\n/**\n * A \"doubletap\" gesture.\n * @typedef {{\n *   clientX: number,\n *   clientY: number\n * }}\n */\nlet DoubletapDef;\n\n\n/**\n * Recognizes a \"doubletap\" gesture. This gesture will block a single \"tap\"\n * for about 300ms while it's expecting the second \"tap\".\n * @extends {GestureRecognizer<DoubletapDef>}\n */\nexport class DoubletapRecognizer extends GestureRecognizer {\n  /**\n   * @param {!Gestures} manager\n   */\n  constructor(manager) {\n    super('doubletap', manager);\n\n    /** @private {number} */\n    this.startX_ = 0;\n\n    /** @private {number} */\n    this.startY_ = 0;\n\n    /** @private {number} */\n    this.lastX_ = 0;\n\n    /** @private {number} */\n    this.lastY_ = 0;\n\n    /** @private {number} */\n    this.tapCount_ = 0;\n  }\n\n  /** @override */\n  onTouchStart(e) {\n    if (this.tapCount_ > 1) {\n      return false;\n    }\n    const touches = e.touches;\n    if (!touches || touches.length != 1) {\n      return false;\n    }\n    this.startX_ = touches[0].clientX;\n    this.startY_ = touches[0].clientY;\n    return true;\n  }\n\n  /** @override */\n  onTouchMove(e) {\n    const touches = e.changedTouches || e.touches;\n    if (touches && touches.length == 1) {\n      this.lastX_ = touches[0].clientX;\n      this.lastY_ = touches[0].clientY;\n      const dx = Math.abs(this.lastX_ - this.startX_) >= 8;\n      const dy = Math.abs(this.lastY_ - this.startY_) >= 8;\n      if (dx || dy) {\n        this.acceptCancel();\n        return false;\n      }\n    }\n    return true;\n  }\n\n  /** @override */\n  onTouchEnd(unusedE) {\n    this.tapCount_++;\n    if (this.tapCount_ < 2) {\n      this.signalPending(300);\n    } else {\n      this.signalReady(0);\n    }\n  }\n\n  /** @override */\n  acceptStart() {\n    this.tapCount_ = 0;\n    this.signalEmit({clientX: this.lastX_, clientY: this.lastY_}, null);\n    this.signalEnd();\n  }\n\n  /** @override */\n  acceptCancel() {\n    this.tapCount_ = 0;\n  }\n}\n\n\n\n/**\n * A \"swipe-xy\", \"swipe-x\" or \"swipe-y\" gesture. A number of these gestures\n * may be emitted for a single touch series.\n * @typedef {{\n *   first: boolean,\n *   last: boolean,\n *   deltaX: number,\n *   deltaY: number,\n *   velocityX: number,\n *   velocityY: number\n * }}\n */\nlet SwipeDef;\n\n\n/**\n * Recognizes swipe gestures. This gesture will yield about 10ms to other\n * gestures.\n * @extends {GestureRecognizer<SwipeDef>}\n */\nclass SwipeRecognizer extends GestureRecognizer {\n  /**\n   * @param {!Gestures} manager\n   */\n  constructor(type, manager, horiz, vert) {\n    super(type, manager);\n\n    /** @private {boolean} */\n    this.horiz_ = horiz;\n\n    /** @private {boolean} */\n    this.vert_ = vert;\n\n    /** @private {boolean} */\n    this.eventing_ = false;\n\n    /** @private {number} */\n    this.startX_ = 0;\n\n    /** @private {number} */\n    this.startY_ = 0;\n\n    /** @private {number} */\n    this.lastX_ = 0;\n\n    /** @private {number} */\n    this.lastY_ = 0;\n\n    /** @private {number} */\n    this.prevX_ = 0;\n\n    /** @private {number} */\n    this.prevY_ = 0;\n\n    /** @private {time} */\n    this.startTime_ = 0;\n\n    /** @private {time} */\n    this.lastTime_ = 0;\n\n    /** @private {time} */\n    this.prevTime_ = 0;\n\n    /** @private {number} */\n    this.velocityX_ = 0;\n\n    /** @private {number} */\n    this.velocityY_ = 0;\n  }\n\n  /** @override */\n  onTouchStart(e) {\n    const touches = e.touches;\n    if (!touches || touches.length != 1) {\n      return false;\n    }\n    this.startTime_ = timer.now();\n    this.startX_ = touches[0].clientX;\n    this.startY_ = touches[0].clientY;\n    return true;\n  }\n\n  /** @override */\n  onTouchMove(e) {\n    const touches = e.changedTouches || e.touches;\n    if (touches && touches.length == 1) {\n      const x = touches[0].clientX;\n      const y = touches[0].clientY;\n      this.lastX_ = x;\n      this.lastY_ = y;\n      if (this.eventing_) {\n        this.emit_(false, false, e);\n      } else {\n        const dx = Math.abs(x - this.startX_);\n        const dy = Math.abs(y - this.startY_);\n        // Swipe is penalized slightly since it's one of the least demanding\n        // gesture, thus -10 in signalReady.\n        if (this.horiz_ && this.vert_) {\n          if (dx >= 8 || dy >= 8) {\n            this.signalReady(-10);\n          }\n        } else if (this.horiz_) {\n          if (dx >= 8 && dx > dy) {\n            this.signalReady(-10);\n          } else if (dy >= 8) {\n            return false;\n          }\n        } else if (this.vert_) {\n          if (dy >= 8 && dy > dx) {\n            this.signalReady(-10);\n          } else if (dx >= 8) {\n            return false;\n          }\n        } else {\n          return false;\n        }\n      }\n    }\n    return true;\n  }\n\n  /** @override */\n  onTouchEnd(e) {\n    this.end_(e);\n  }\n\n  /** @override */\n  acceptStart() {\n    this.eventing_ = true;\n    // Reset start coordinates to where the gesture began to avoid visible\n    // jump, but preserve them as \"prev\" coordinates to calculate the right\n    // velocity.\n    this.prevX_ = this.startX_;\n    this.prevY_ = this.startY_;\n    this.prevTime_ = this.startTime_;\n    this.startX_ = this.lastX_;\n    this.startY_ = this.lastY_;\n    this.emit_(true, false, null);\n  }\n\n  /** @override */\n  acceptCancel() {\n    this.eventing_ = false;\n  }\n\n  /**\n   * @param {boolean} first\n   * @param {boolean} last\n   * @param {?Event} event\n   * @private\n   */\n  emit_(first, last, event) {\n    this.lastTime_ = timer.now();\n    const deltaTime = this.lastTime_ - this.prevTime_;\n    // It's often that `touchend` arrives on the next frame. These should\n    // be ignored to avoid a significant velocity downgrade.\n    if (!last && deltaTime > 4 || last && deltaTime > 16) {\n      this.velocityX_ = calcVelocity(this.lastX_ - this.prevX_, deltaTime,\n          this.velocityX_);\n      this.velocityY_ = calcVelocity(this.lastY_ - this.prevY_, deltaTime,\n          this.velocityY_);\n      this.velocityX_ = Math.abs(this.velocityX_) > 1e-4 ? this.velocityX_ : 0;\n      this.velocityY_ = Math.abs(this.velocityY_) > 1e-4 ? this.velocityY_ : 0;\n      this.prevX_ = this.lastX_;\n      this.prevY_ = this.lastY_;\n      this.prevTime_ = this.lastTime_;\n    }\n\n    this.signalEmit({\n      first: first,\n      last: last,\n      time: this.lastTime_,\n      deltaX: this.horiz_ ? this.lastX_ - this.startX_ : 0,\n      deltaY: this.vert_ ? this.lastY_ - this.startY_ : 0,\n      velocityX: this.horiz_ ? this.velocityX_ : 0,\n      velocityY: this.vert_ ? this.velocityY_ : 0\n    }, event);\n  }\n\n  /**\n   * @param {?Event} event\n   * @private\n   */\n  end_(event) {\n    if (this.eventing_) {\n      this.eventing_ = false;\n      this.emit_(false, true, event);\n      this.signalEnd();\n    }\n  }\n}\n\n\n/**\n * Recognizes \"swipe-xy\" gesture. Yields about 10ms to other gestures.\n */\nexport class SwipeXYRecognizer extends SwipeRecognizer {\n  /**\n   * @param {!Gestures} manager\n   */\n  constructor(manager) {\n    super('swipe-xy', manager, true, true);\n  }\n}\n\n\n/**\n * Recognizes \"swipe-x\" gesture. Yields about 10ms to other gestures.\n */\nexport class SwipeXRecognizer extends SwipeRecognizer {\n  /**\n   * @param {!Gestures} manager\n   */\n  constructor(manager) {\n    super('swipe-x', manager, true, false);\n  }\n}\n\n\n/**\n * Recognizes \"swipe-y\" gesture. Yields about 10ms to other gestures.\n */\nexport class SwipeYRecognizer extends SwipeRecognizer {\n  /**\n   * @param {!Gestures} manager\n   */\n  constructor(manager) {\n    super('swipe-y', manager, false, true);\n  }\n}\n\n\n\n/**\n * A \"tapzoom\" gesture. It has a center, delta off the center center and\n * the velocity of moving away from the center.\n * @typedef {{\n *   first: boolean,\n *   last: boolean,\n *   centerClientX: number,\n *   centerClientY: number,\n *   deltaX: number,\n *   deltaY: number,\n *   velocityX: number,\n *   velocityY: number\n * }}\n */\nlet TapzoomDef;\n\n\n/**\n * Recognizes a \"tapzoom\" gesture. This gesture will block other gestures\n * for about 400ms after first \"tap\" while it's expecting swipe.\n * @extends {GestureRecognizer<TapzoomDef>}\n */\nexport class TapzoomRecognizer extends GestureRecognizer {\n  /**\n   * @param {!Gestures} manager\n   */\n  constructor(manager) {\n    super('tapzoom', manager);\n\n    /** @private {boolean} */\n    this.eventing_ = false;\n\n    /** @private {number} */\n    this.startX_ = 0;\n\n    /** @private {number} */\n    this.startY_ = 0;\n\n    /** @private {number} */\n    this.lastX_ = 0;\n\n    /** @private {number} */\n    this.lastY_ = 0;\n\n    /** @private {number} */\n    this.tapX_ = 0;\n\n    /** @private {number} */\n    this.tapY_ = 0;\n\n    /** @private {number} */\n    this.tapCount_ = 0;\n\n    /** @private {number} */\n    this.prevX_ = 0;\n\n    /** @private {number} */\n    this.prevY_ = 0;\n\n    /** @private {time} */\n    this.startTime_ = 0;\n\n    /** @private {time} */\n    this.lastTime_ = 0;\n\n    /** @private {time} */\n    this.prevTime_ = 0;\n\n    /** @private {number} */\n    this.velocityX_ = 0;\n\n    /** @private {number} */\n    this.velocityY_ = 0;\n  }\n\n  /** @override */\n  onTouchStart(e) {\n    if (this.eventing_) {\n      return false;\n    }\n    const touches = e.touches;\n    if (!touches || touches.length != 1) {\n      return false;\n    }\n    this.startX_ = touches[0].clientX;\n    this.startY_ = touches[0].clientY;\n    return true;\n  }\n\n  /** @override */\n  onTouchMove(e) {\n    const touches = e.changedTouches || e.touches;\n    if (touches && touches.length == 1) {\n      this.lastX_ = touches[0].clientX;\n      this.lastY_ = touches[0].clientY;\n      if (this.eventing_) {\n        this.emit_(false, false, e);\n      } else {\n        const dx = Math.abs(this.lastX_ - this.startX_) >= 8;\n        const dy = Math.abs(this.lastY_ - this.startY_) >= 8;\n        if (dx || dy) {\n          if (this.tapCount_ == 0) {\n            this.acceptCancel();\n            return false;\n          } else {\n            this.signalReady(0);\n          }\n        }\n      }\n    }\n    return true;\n  }\n\n  /** @override */\n  onTouchEnd(e) {\n    if (this.eventing_) {\n      this.end_(e);\n      return;\n    }\n\n    this.tapCount_++;\n    if (this.tapCount_ == 1) {\n      this.signalPending(400);\n      this.tapX_ = this.lastX_;\n      this.tapY_ = this.lastY_;\n      return;\n    }\n\n    this.acceptCancel();\n  }\n\n  /** @override */\n  acceptStart() {\n    this.tapCount_ = 0;\n    this.eventing_ = true;\n    this.emit_(true, false, null);\n  }\n\n  /** @override */\n  acceptCancel() {\n    this.tapCount_ = 0;\n    this.eventing_ = false;\n  }\n\n  /**\n   * @param {boolean} first\n   * @param {boolean} last\n   * @param {?Event} event\n   * @private\n   */\n  emit_(first, last, event) {\n    this.lastTime_ = timer.now();\n    if (first) {\n      this.startTime_ = this.lastTime_;\n      this.velocityX_ = this.velocityY_ = 0;\n    } else if (this.lastTime_ - this.prevTime_ > 2) {\n      this.velocityX_ = calcVelocity(this.lastX_ - this.prevX_,\n          this.lastTime_ - this.prevTime_, this.velocityX_);\n      this.velocityY_ = calcVelocity(this.lastY_ - this.prevY_,\n          this.lastTime_ - this.prevTime_, this.velocityY_);\n    }\n    this.prevX_ = this.lastX_;\n    this.prevY_ = this.lastY_;\n    this.prevTime_ = this.lastTime_;\n\n    this.signalEmit({\n      first: first,\n      last: last,\n      centerClientX: this.startX_,\n      centerClientY: this.startY_,\n      deltaX: this.lastX_ - this.startX_,\n      deltaY: this.lastY_ - this.startY_,\n      velocityX: this.velocityX_,\n      velocityY: this.velocityY_\n    }, event);\n  }\n\n  /**\n   * @param {?Event} event\n   * @private\n   */\n  end_(event) {\n    if (this.eventing_) {\n      this.eventing_ = false;\n      this.emit_(false, true, event);\n      this.signalEnd();\n    }\n  }\n}\n\n\n\n/**\n * A \"pinch\" gesture. It has a center, delta off the center center and\n * the velocity of moving away from the center. \"dir\" component of `1`\n * indicates that it's a expand motion and `-1` indicates pinch motion.\n * @typedef {{\n *   first: boolean,\n *   last: boolean,\n *   centerClientX: number,\n *   centerClientY: number,\n *   dir: number,\n *   deltaX: number,\n *   deltaY: number,\n *   velocityX: number,\n *   velocityY: number\n * }}\n */\nlet PinchDef;\n\n\n/**\n * Recognizes a \"pinch\" gesture.\n * @extends {GestureRecognizer<PinchDef>}\n */\nexport class PinchRecognizer extends GestureRecognizer {\n  /**\n   * @param {!Gestures} manager\n   */\n  constructor(manager) {\n    super('pinch', manager);\n\n    /** @private {boolean} */\n    this.eventing_ = false;\n\n    /** @private {number} */\n    this.startX1_ = 0;\n    /** @private {number} */\n    this.startY1_ = 0;\n\n    /** @private {number} */\n    this.startX2_ = 0;\n    /** @private {number} */\n    this.startY2_ = 0;\n\n    /** @private {number} */\n    this.lastX1_ = 0;\n    /** @private {number} */\n    this.lastY1_ = 0;\n\n    /** @private {number} */\n    this.lastX2_ = 0;\n    /** @private {number} */\n    this.lastY2_ = 0;\n\n    /** @private {number} */\n    this.prevDeltaX_ = 0;\n    /** @private {number} */\n    this.prevDeltaY_ = 0;\n\n    /** @private {number} */\n    this.centerClientX_ = 0;\n    /** @private {number} */\n    this.centerClientY_ = 0;\n\n    /** @private {time} */\n    this.startTime_ = 0;\n    /** @private {time} */\n    this.lastTime_ = 0;\n    /** @private {time} */\n    this.prevTime_ = 0;\n\n    /** @private {number} */\n    this.velocityX_ = 0;\n    /** @private {number} */\n    this.velocityY_ = 0;\n  }\n\n  /** @override */\n  onTouchStart(e) {\n    const touches = e.touches;\n    if (!touches || touches.length != 2) {\n      return false;\n    }\n    this.startTime_ = timer.now();\n    this.startX1_ = touches[0].clientX;\n    this.startY1_ = touches[0].clientY;\n    this.startX2_ = touches[1].clientX;\n    this.startY2_ = touches[1].clientY;\n    return true;\n  }\n\n  /** @override */\n  onTouchMove(e) {\n    const touches = e.touches;\n    if (!touches || touches.length != 2) {\n      return false;\n    }\n    this.lastX1_ = touches[0].clientX;\n    this.lastY1_ = touches[0].clientY;\n    this.lastX2_ = touches[1].clientX;\n    this.lastY2_ = touches[1].clientY;\n    if (this.eventing_) {\n      this.emit_(false, false, e);\n    } else {\n      const dx1 = this.lastX1_ - this.startX1_;\n      const dy1 = this.lastY1_ - this.startY1_;\n      const dx2 = this.lastX2_ - this.startX2_;\n      const dy2 = this.lastY2_ - this.startY2_;\n      // Fingers should move in opposite directions and go over the threshold.\n      if (dx1 * dx2 <= 0 && dy1 * dy2 <= 0) {\n        if (Math.abs(dx1 - dx2) >= 8 || Math.abs(dy1 - dy2) >= 8) {\n          this.signalReady(0);\n        }\n      } else if (Math.abs(dx1 + dx2) >= 8 || Math.abs(dy1 + dy2) >= 8) {\n        // Moving in the same direction over a threshold.\n        return false;\n      }\n    }\n    return true;\n  }\n\n  /** @override */\n  onTouchEnd(e) {\n    this.end_(e);\n  }\n\n  /** @override */\n  acceptStart() {\n    this.eventing_ = true;\n    this.prevTime_ = this.startTime_;\n    this.prevDeltaX_ = 0;\n    this.prevDeltaY_ = 0;\n    this.centerClientX_ = (this.startX1_ + this.startX2_) * 0.5;\n    this.centerClientY_ = (this.startY1_ + this.startY2_) * 0.5;\n    this.emit_(true, false, null);\n  }\n\n  /** @override */\n  acceptCancel() {\n    this.eventing_ = false;\n  }\n\n  /**\n   * @param {boolean} first\n   * @param {boolean} last\n   * @param {?Event} event\n   * @private\n   */\n  emit_(first, last, event) {\n    this.lastTime_ = timer.now();\n    const deltaTime = this.lastTime_ - this.prevTime_;\n    const deltaX = this.deltaX_();\n    const deltaY = this.deltaY_();\n    // It's often that `touchend` arrives on the next frame. These should\n    // be ignored to avoid a significant velocity downgrade.\n    if (!last && deltaTime > 4 || last && deltaTime > 16) {\n      this.velocityX_ = calcVelocity(deltaX - this.prevDeltaX_, deltaTime,\n          this.velocityX_);\n      this.velocityY_ = calcVelocity(deltaY - this.prevDeltaY_, deltaTime,\n          this.velocityY_);\n      this.velocityX_ = Math.abs(this.velocityX_) > 1e-4 ? this.velocityX_ : 0;\n      this.velocityY_ = Math.abs(this.velocityY_) > 1e-4 ? this.velocityY_ : 0;\n      this.prevDeltaX_ = deltaX;\n      this.prevDeltaY_ = deltaY;\n      this.prevTime_ = this.lastTime_;\n    }\n\n    const startSq = this.sqDist_(this.startX1_, this.startX2_,\n        this.startY1_, this.startY2_);\n    const lastSq = this.sqDist_(this.lastX1_, this.lastX2_,\n        this.lastY1_, this.lastY2_);\n    this.signalEmit({\n      first: first,\n      last: last,\n      time: this.lastTime_,\n      centerClientX: this.centerClientX_,\n      centerClientY: this.centerClientY_,\n      dir: Math.sign(lastSq - startSq),\n      deltaX: deltaX * 0.5,\n      deltaY: deltaY * 0.5,\n      velocityX: this.velocityX_ * 0.5,\n      velocityY: this.velocityY_ * 0.5\n    }, event);\n  }\n\n  /**\n   * @param {?Event} event\n   * @private\n   */\n  end_(event) {\n    if (this.eventing_) {\n      this.eventing_ = false;\n      this.emit_(false, true, event);\n      this.signalEnd();\n    }\n  }\n\n  /**\n   * @param {number} x1\n   * @param {number} x2\n   * @param {number} y1\n   * @param {number} y2\n   * @return {number}\n   * @private\n   */\n  sqDist_(x1, x2, y1, y2) {\n    return (x1 - x2) * (x1 - x2) + (y1 - y2) * (y1 - y2);\n  }\n\n  /**\n   * @return {number}\n   * @private\n   */\n  deltaX_() {\n    return Math.abs((this.lastX1_ - this.startX1_) -\n        (this.lastX2_ - this.startX2_));\n  }\n\n  /**\n   * @return {number}\n   * @private\n   */\n  deltaY_() {\n    return Math.abs((this.lastY1_ - this.startY1_) -\n        (this.lastY2_ - this.startY2_));\n  }\n}\n","/**\n * Copyright 2015 The AMP HTML Authors. All Rights Reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS-IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {Observable} from './observable';\nimport {assert} from './asserts';\nimport {Pass} from './pass';\nimport {timer} from './timer';\n\nconst PROP_ = '__AMP_Gestures';\n\n\n/**\n * A gesture object contains the type and data of the gesture such as\n * a tap or a double-tap or a swipe. See {@link GestureRecognizer} for\n * more details.\n * @struct\n * @const\n * @template DATA\n */\nexport class Gesture {\n  /**\n   * @param {string} type The gesture's string type.\n   * @param {DATA} data The data of the gesture.\n   * @param {time} time The time that the gesture has been emitted.\n   * @param {?Event} event An optional browser event that resulted in the\n   *   gesture.\n   */\n  constructor(type, data, time, event) {\n    /** @const {string} */\n    this.type = type;\n    /** @const {DATA} */\n    this.data = data;\n    /** @const {time} */\n    this.time = time;\n    /** @const {?Event} */\n    this.event = event;\n  }\n}\n\n\n/**\n * Gestures object manages all gestures on a particular element. It listens\n * to all pointer events and delegates them to individual gesture recognizers.\n * When a recognizer has recognized a gesture and ready to start emitting it\n * it requests permission to do so from this class which resolves conflicts\n * between competing recognizers to decide which gesture should go forward.\n */\nexport class Gestures {\n\n  /**\n   * Creates if not yet created and returns the shared Gestures instance for\n   * the specified element.\n   * @param {!Element} element\n   * @return {!Gestures}\n   */\n  static get(element) {\n    let res = element[PROP_];\n    if (!res) {\n      res = new Gestures(element);\n      element[PROP_] = res;\n    }\n    return res;\n  }\n\n  /**\n   * @param {!Element} element\n   */\n  constructor(element) {\n    /** @private {!Element} */\n    this.element_ = element;\n\n    /** @private {!Array<!GestureRecognizer>} */\n    this.recognizers_ = [];\n\n    /** @private {!Array<boolean>} */\n    this.tracking_ = [];\n\n    /** @private {!Array<time>} */\n    this.ready_ = [];\n\n    /** @private {!Array<time>} */\n    this.pending_ = [];\n\n    /** @private {?GestureRecognizer} */\n    this.eventing_ = null;\n\n    /**\n     * This variable indicates that the eventing has stopped on this\n     * event cycle.\n     * @private {boolean}\n     */\n    this.wasEventing_ = false;\n\n    /** @private {!Pass} */\n    this.pass_ = new Pass(this.doPass_.bind(this));\n\n    /** @private {!Observable} */\n    this.pointerDownObservable_ = new Observable();\n\n    /**\n     * Observers for each type of registered gesture types.\n     * @private {!Object<string, !Observable<!Gesture>>}\n     */\n    this.overservers_ = Object.create(null);\n\n    /** @private @const {function(!Event)} */\n    this.boundOnTouchStart_ = this.onTouchStart_.bind(this);\n    /** @private @const {function(!Event)} */\n    this.boundOnTouchEnd_ = this.onTouchEnd_.bind(this);\n    /** @private @const {function(!Event)} */\n    this.boundOnTouchMove_ = this.onTouchMove_.bind(this);\n    /** @private @const {function(!Event)} */\n    this.boundOnTouchCancel_ = this.onTouchCancel_.bind(this);\n\n    this.element_.addEventListener('touchstart', this.boundOnTouchStart_);\n    this.element_.addEventListener('touchend', this.boundOnTouchEnd_);\n    this.element_.addEventListener('touchmove', this.boundOnTouchMove_);\n    this.element_.addEventListener('touchcancel', this.boundOnTouchCancel_);\n  }\n\n  /**\n   * Unsubscribes from all pointer events.\n   */\n  cleanup() {\n    this.element_.removeEventListener('touchstart', this.boundOnTouchStart_);\n    this.element_.removeEventListener('touchend', this.boundOnTouchEnd_);\n    this.element_.removeEventListener('touchmove', this.boundOnTouchMove_);\n    this.element_.removeEventListener('touchcancel', this.boundOnTouchCancel_);\n    this.pass_.cancel();\n  }\n\n  /**\n   * Subscribes to a gesture emitted by the specified recognizer. For a first\n   * gesture handler registered in this method the recognizer is installed\n   * and from that point on it participates in the event processing.\n   *\n   * @param {function(new:GestureRecognizer<DATA>)} recognizerConstr\n   * @param {function(!Gesture<!DATA>)} handler\n   * @return {!UnlistenDef}\n   * @template DATA\n   */\n  onGesture(recognizerConstr, handler) {\n    const recognizer = new recognizerConstr(this);\n    const type = recognizer.getType();\n    let overserver = this.overservers_[type];\n    if (!overserver) {\n      this.recognizers_.push(recognizer);\n      overserver = new Observable();\n      this.overservers_[type] = overserver;\n    }\n    return overserver.add(handler);\n  }\n\n  /**\n   * Subscribes to pointer down events, such as \"touchstart\" or \"mousedown\".\n   * @param {!Function} handler\n   * @return {!UnlistenDef}\n   */\n  onPointerDown(handler) {\n    return this.pointerDownObservable_.add(handler);\n  }\n\n  /**\n   * Handles all \"touchstart\" events and dispatches them to the tracking\n   * recognizers.\n   * @param {!Event} event\n   * @private\n   */\n  onTouchStart_(event) {\n    const now = timer.now();\n    this.wasEventing_ = false;\n\n    this.pointerDownObservable_.fire(event);\n\n    for (let i = 0; i < this.recognizers_.length; i++) {\n      if (this.ready_[i]) {\n        // If the recognizer is in the \"ready\" state, it won't receive\n        // any more touch series until it's allowed to emit.\n        continue;\n      }\n      if (this.pending_[i] && this.pending_[i] < now) {\n        // Pending state expired. Reset.\n        this.stopTracking_(i);\n      }\n      if (this.recognizers_[i].onTouchStart(event)) {\n        // When a recognizer is interested in the touch series it returns \"true\"\n        // from its onTouchStart method. For this recognizer we start tracking\n        // the whole series of touch events from touchstart to touchend. Other\n        // recognizers will not receive them unless they return \"true\" from\n        // onTouchStart.\n        this.startTracking_(i);\n      }\n    }\n\n    this.afterEvent_(event);\n  }\n\n  /**\n   * Handles all \"touchmove\" events and dispatches them to the tracking\n   * recognizers.\n   * @param {!Event} event\n   * @private\n   */\n  onTouchMove_(event) {\n    const now = timer.now();\n\n    for (let i = 0; i < this.recognizers_.length; i++) {\n      if (!this.tracking_[i]) {\n        // The whole touch series are ignored for non-tracking recognizers.\n        continue;\n      }\n      if (this.pending_[i] && this.pending_[i] < now) {\n        // Pending state expired. Reset.\n        this.stopTracking_(i);\n        continue;\n      }\n      if (!this.recognizers_[i].onTouchMove(event)) {\n        // Recognizer lost interest in the series. Reset.\n        this.stopTracking_(i);\n      }\n    }\n\n    this.afterEvent_(event);\n  }\n\n  /**\n   * Handles all \"touchend\" events and dispatches them to the tracking\n   * recognizers.\n   * @param {!Event} event\n   * @private\n   */\n  onTouchEnd_(event) {\n    const now = timer.now();\n\n    for (let i = 0; i < this.recognizers_.length; i++) {\n      if (!this.tracking_[i]) {\n        // The whole touch series are ignored for non-tracking recognizers.\n        continue;\n      }\n      if (this.pending_[i] && this.pending_[i] < now) {\n        // Pending state expired. Reset.\n        this.stopTracking_(i);\n        continue;\n      }\n      this.recognizers_[i].onTouchEnd(event);\n      if (!this.pending_[i] || this.pending_[i] < now) {\n        this.stopTracking_(i);\n      }\n    }\n\n    this.afterEvent_(event);\n  }\n\n  /**\n   * Handles all \"touchcancel\" events. Cancels all tracking/emitting\n   * recognizers.\n   * @param {!Event} event\n   * @private\n   */\n  onTouchCancel_(event) {\n    for (let i = 0; i < this.recognizers_.length; i++) {\n      this.cancelEventing_(i);\n    }\n    this.afterEvent_(event);\n  }\n\n  /**\n   * Callback for a gesture recognizer to communicate that it's ready to\n   * start emitting gestures. Gestures instance may or may not allow the\n   * recognizer to proceed.\n   * @param {!GestureRecognizer} recognizer\n   * @param {number} offset\n   * @private\n   */\n  signalReady_(recognizer, offset) {\n    // Somebody got here first.\n    if (this.eventing_) {\n      recognizer.acceptCancel();\n      return;\n    }\n\n    // Set the recognizer as ready and wait for the pass to\n    // make the decision.\n    const now = timer.now();\n    for (let i = 0; i < this.recognizers_.length; i++) {\n      if (this.recognizers_[i] == recognizer) {\n        this.ready_[i] = now + offset;\n        this.pending_[i] = 0;\n      }\n    }\n    this.passAfterEvent_ = true;\n  }\n\n  /**\n   * Callback for a gesture recognizer to communicate that it's close to\n   * start emitting gestures, but needs more time to see more events. Once\n   * this time expires the recognizer should either signal readiness or it\n   * will be canceled.\n   * @param {!GestureRecognizer} recognizer\n   * @param {number} offset\n   * @private\n   */\n  signalPending_(recognizer, timeLeft) {\n    // Somebody got here first.\n    if (this.eventing_) {\n      recognizer.acceptCancel();\n      return;\n    }\n\n    const now = timer.now();\n    for (let i = 0; i < this.recognizers_.length; i++) {\n      if (this.recognizers_[i] == recognizer) {\n        this.pending_[i] = now + timeLeft;\n      }\n    }\n  }\n\n  /**\n   * Callback for a gesture recognizer to communicate that it's done\n   * emitting gestures.\n   * @param {!GestureRecognizer} recognizer\n   * @private\n   */\n  signalEnd_(recognizer) {\n    if (this.eventing_ == recognizer) {\n      this.eventing_ = null;\n      this.wasEventing_ = true;\n    }\n  }\n\n  /**\n   * Callback for a gesture emit the gesture. Only the currently emitting\n   * recognizer is allowed to emit gestures.\n   * @param {!GestureRecognizer} recognizer\n   * @param {*} data\n   * @param {?Event} event\n   * @private\n   */\n  signalEmit_(recognizer, data, event) {\n    assert(this.eventing_ == recognizer,\n        'Recognizer is not currently allowed: %s', recognizer.getType());\n    const overserver = this.overservers_[recognizer.getType()];\n    if (overserver) {\n      overserver.fire(new Gesture(recognizer.getType(), data, timer.now(),\n          event));\n    }\n  }\n\n  /**\n   * @param {!Event} event\n   * @private\n   */\n  afterEvent_(event) {\n    let cancelEvent = !!this.eventing_ || this.wasEventing_;\n    this.wasEventing_ = false;\n    if (!cancelEvent) {\n      const now = timer.now();\n      for (let i = 0; i < this.recognizers_.length; i++) {\n        if (this.ready_[i] ||\n                this.pending_[i] && this.pending_[i] >= now) {\n          cancelEvent = true;\n          break;\n        }\n      }\n    }\n    if (cancelEvent) {\n      event.stopPropagation();\n      event.preventDefault();\n    }\n    if (this.passAfterEvent_) {\n      this.passAfterEvent_ = false;\n      this.doPass_();\n    }\n  }\n\n  /**\n   * The pass that decides which recognizers can start emitting and which\n   * are canceled.\n   * @param {!Event} event\n   * @private\n   */\n  doPass_() {\n    const now = timer.now();\n\n    // The \"most ready\" recognizer is the youngest in the \"ready\" set.\n    // Otherwise we wouldn't wait for it at all.\n    let readyIndex = -1;\n    for (let i = 0; i < this.recognizers_.length; i++) {\n      if (!this.ready_[i]) {\n        if (this.pending_[i] && this.pending_[i] < now) {\n          // Pending state expired. Reset.\n          this.stopTracking_(i);\n        }\n        continue;\n      }\n      if (readyIndex == -1 || this.ready_[i] > this.ready_[readyIndex]) {\n        readyIndex = i;\n      }\n    }\n\n    if (readyIndex == -1) {\n      // Nothing to do.\n      return;\n    }\n\n    // Look for conflicts.\n    let waitTime = 0;\n    for (let i = 0; i < this.recognizers_.length; i++) {\n      if (this.ready_[i] || !this.tracking_[i]) {\n        continue;\n      }\n      waitTime = Math.max(waitTime, this.pending_[i] - now);\n    }\n\n    if (waitTime < 2) {\n      // We waited long enough.\n      this.startEventing_(readyIndex);\n      return;\n    }\n\n    // Some conflicts: have to wait to see who wins.\n    this.pass_.schedule(waitTime);\n  }\n\n  /**\n   * This recognizer is given \"go ahead\" and all others are canceled.\n   * @param {number} index\n   * @private\n   */\n  startEventing_(index) {\n    const recognizer = this.recognizers_[index];\n    for (let i = 0; i < this.recognizers_.length; i++) {\n      if (i != index) {\n        this.cancelEventing_(i);\n      }\n    }\n    this.ready_[index] = 0;\n    this.pending_[index] = 0;\n    this.eventing_ = recognizer;\n    recognizer.acceptStart();\n  }\n\n  /**\n   * @param {number} index\n   * @private\n   */\n  startTracking_(index) {\n    this.tracking_[index] = true;\n    this.pending_[index] = 0;\n  }\n\n  /**\n   * @param {number} index\n   * @private\n   */\n  stopTracking_(index) {\n    this.tracking_[index] = false;\n    this.pending_[index] = 0;\n    if (!this.ready_[index]) {\n      this.recognizers_[index].acceptCancel();\n    }\n  }\n\n  /**\n   * @param {number} index\n   * @private\n   */\n  cancelEventing_(index) {\n    this.ready_[index] = 0;\n    this.stopTracking_(index);\n  }\n}\n\n\n/**\n * The gesture recognizer receives the pointer events from Gestures instance.\n * Based on these events, it can \"recognize\" the gesture it's responsible for,\n * request to start emitting and emit gestures. Gestures instances manages\n * several competing recognizers and decides which ones get to emit gestures\n * and which do not.\n *\n * The recognizer can be in several main states:\n * 1. Tracking state. In this state the recognizer is receiving the series of\n *    touch events from touchstart to touchend. To get into this state the\n *    recognizer has to return \"true\" from the {@link onTouchStart}.\n * 2. Pending state (optional). The recognizer matched part of the gesture,\n *    but needs more time to get track more events. It requests more time\n *    by calling {@link signalPending}, By the end of this time the recognizer\n *    has either matched the gesture or has been canceled.\n * 3. Ready state. The recognizer matched the whole gesture and ready to start\n *    emitting. It communicates to the Gestures this readiness by calling\n *    {@link signalReady}.\n * 5. Emitting state. If Gestures decides to go ahead with this recognizer, it\n *    will call {@link acceptStart} method. Otherwise, it will call\n *    {@link acceptCancel} method. Once in the emitting state, the recognizer\n *    can emit any number of events by calling {@link signalEmit}.\n * 6. Complete state. Once done, the recognizer can call {@link signalEnd} to\n *    communicate that it's done.\n *\n * @template DATA\n */\nexport class GestureRecognizer {\n\n  /**\n   * @param {string} type\n   * @param {!Gestures} manager\n   */\n  constructor(type, manager) {\n    /** @private @const {string} */\n    this.type_ = type;\n\n    /** @private @const {!Gestures} */\n    this.manager_ = manager;\n  }\n\n  /**\n   * Returns the type of the gesture emitted by the instance of this class.\n   * It has to be unique in the scope of the Gestures instance.\n   * @return {string}\n   */\n  getType() {\n    return this.type_;\n  }\n\n  /**\n   * The recognizer can call this method to communicate that it's ready to\n   * start emitting the gesture. Optionally it can pass a zero, positive or\n   * negative offset - a time on how much the gesture should be penalized or\n   * given advantage in conflict resolution. The recognizer at this point is\n   * in the \"ready\" state.\n   * @param {time} offset\n   */\n  signalReady(offset) {\n    this.manager_.signalReady_(this, offset);\n  }\n\n  /**\n   * The recognizer can call this method to communicate that it needs more\n   * time (timeLeft) to match the gesture. By the end of this time the\n   * recognizer has to either transit to the ready state using\n   * {@link signalReady} or it will be canceled. The recognizer is in the\n   * \"pending\" state.\n   * @param {time} timeLeft\n   */\n  signalPending(timeLeft) {\n    this.manager_.signalPending_(this, timeLeft);\n  }\n\n  /**\n   * The recognizer can call this method to communicate that it's done\n   * emitting the gestures. It will return to the waiting state. Recognizer\n   * can only call this method if it has previously received the\n   * {@link acceptStart} call.\n   */\n  signalEnd() {\n    this.manager_.signalEnd_(this);\n  }\n\n  /**\n   * The recognizer can call this method to emit the gestures while in the\n   * \"emitting\" state. Recognizer can only call this method if it has\n   * previously received the {@link acceptStart} call.\n   * @param {!DATA} data\n   * @param {?Event} event\n   */\n  signalEmit(data, event) {\n    this.manager_.signalEmit_(this, data, event);\n  }\n\n  /**\n   * The Gestures instance calls this method to allow the recognizer to start\n   * emitting the gestures. At this point the recognizer is in the \"emitting\"\n   * state. It will be in this state until it calls {@link signalEnd} or\n   * the {@link acceptCancel} is called by the Gestures instance.\n   */\n  acceptStart() {\n  }\n\n  /**\n   * The Gestures instance calls this method to reset the recognizer. At this\n   * point the recognizer is in the initial waiting state.\n   */\n  acceptCancel() {\n  }\n\n  /**\n   * The Gestures instance calls this method for each \"touchstart\" event. If\n   * the recognizer wants to receive other touch events in the series, it has\n   * to return \"true\".\n   * @param {!Event} unusedEvent\n   * @return {boolean}\n   */\n  onTouchStart(unusedEvent) {\n    return false;\n  }\n\n  /**\n   * The Gestures instance calls this method for each \"touchmove\" event. If\n   * the recognizer wants to continue receiving touch events in the series,\n   * it has to return \"true\".\n   * @param {!Event} unusedEvent\n   * @return {boolean}\n   */\n  onTouchMove(unusedEvent) {\n    return false;\n  }\n\n  /**\n   * The Gestures instance calls this method for the \"touchend\" event.\n   * Somewhere within this touch series the recognizer has to call\n   * {@link signalReady} or {@link signalPending} or it will be reset for the\n   * next touch series.\n   * @param {!Event} unusedEvent\n   */\n  onTouchEnd(unusedEvent) {\n  }\n}\n","/**\n * Copyright 2015 The AMP HTML Authors. All Rights Reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS-IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n\nimport {getService} from './service';\n\n\n/**\n * Returns service implemented in service/history-impl.\n * @param {!Window} window\n * @return {!History}\n */\nexport function historyFor(window) {\n  return getService(window, 'history');\n};\n","/**\n * Copyright 2015 The AMP HTML Authors. All Rights Reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS-IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n\n/**\n * The structure that combines position and size for an element. The exact\n * interpretation of position and size depends on the use case.\n *\n * @typedef {{\n *   top: number,\n *   bottom: number,\n *   left: number,\n *   right: number,\n *   width: number,\n *   height: number\n * }}\n */\nlet LayoutRectDef;\n\n\n/**\n * Creates a layout rect based on the left, top, width and height parameters\n * in that order.\n * @param {number} left\n * @param {number} top\n * @param {number} width\n * @param {number} height\n * @return {!LayoutRectDef}\n */\nexport function layoutRectLtwh(left, top, width, height) {\n  return {\n    left: left,\n    top: top,\n    width: width,\n    height: height,\n    bottom: top + height,\n    right: left + width\n  };\n}\n\n\n/**\n * Creates a layout rect based on the DOMRect, e.g. obtained from calling\n * getBoundingClientRect.\n * @param {!DOMRect} rect\n * @return {!LayoutRectDef}\n */\nexport function layoutRectFromDomRect(rect) {\n  return {\n    left: rect.left,\n    top: rect.top,\n    width: rect.width,\n    height: rect.height,\n    bottom: rect.top + rect.height,\n    right: rect.left + rect.width\n  };\n}\n\n\n/**\n * Returns true if the specified two rects overlap by a single pixel.\n * @param {!LayoutRectDef} r1\n * @param {!LayoutRectDef} r2\n * @return {boolean}\n */\nexport function layoutRectsOverlap(r1, r2) {\n  return (r1.top <= r2.bottom && r2.top <= r1.bottom &&\n      r1.left <= r2.right && r2.left <= r1.right);\n}\n\n\n/**\n * Returns the intersection between a, b or null if there is none.\n * @param {!LayoutRectDef} a\n * @param {!LayoutRectDef} b\n * @return {?LayoutRectDef}\n */\nexport function rectIntersection(a, b) {\n  const x0 = Math.max(a.left, b.left);\n  const x1 = Math.min(a.left + a.width, b.left + b.width);\n\n  if (x0 <= x1) {\n    const y0 = Math.max(a.top, b.top);\n    const y1 = Math.min(a.top + a.height, b.top + b.height);\n\n    if (y0 <= y1) {\n      return layoutRectLtwh(x0, y0, x1 - x0, y1 - y0);\n    }\n  }\n  return null;\n}\n\n\n/**\n * Expand the layout rect using multiples of width and height.\n * @param {!LayoutRectDef} rect Original rect.\n * @param {number} dw Expansion in width, specified as a multiple of width.\n * @param {number} dh Expansion in height, specified as a multiple of height.\n * @return {!LayoutRectDef}\n */\nexport function expandLayoutRect(rect, dw, dh) {\n  return {\n    top: rect.top - rect.height * dh,\n    bottom: rect.bottom + rect.height * dh,\n    left: rect.left - rect.width * dw,\n    right: rect.right + rect.width * dw,\n    width: rect.width * (1 + dw * 2),\n    height: rect.height * (1 + dh * 2)\n  };\n}\n\n\n/**\n * Moves the layout rect using dx and dy.\n * @param {!LayoutRectDef} rect Original rect.\n * @param {number} dx Move horizontally with this value.\n * @param {number} dy Move vertically with this value.\n * @return {!LayoutRectDef}\n */\nexport function moveLayoutRect(rect, dx, dy) {\n  if (dx == 0 && dy == 0) {\n    return rect;\n  }\n  return layoutRectLtwh(rect.left + dx, rect.top + dy,\n      rect.width, rect.height);\n}\n","/**\n * Copyright 2015 The AMP HTML Authors. All Rights Reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS-IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/**\n * @fileoverview Implements element layout. See https://goo.gl/9avXuT for\n * details.\n */\n\nimport {assert} from './asserts';\n\n\n/**\n * @enum {string}\n */\nexport const Layout = {\n  NODISPLAY: 'nodisplay',\n  FIXED: 'fixed',\n  FIXED_HEIGHT: 'fixed-height',\n  RESPONSIVE: 'responsive',\n  CONTAINER: 'container',\n  FILL: 'fill'\n};\n\n\n/**\n * CSS Length type. E.g. \"1px\" or \"20vh\".\n * @typedef {string}\n */\nlet LengthDef;\n\n\n/**\n * @typedef {{\n *   width: string,\n *   height: string\n * }}\n */\nlet DimensionsDef;\n\n\n/**\n * The set of elements with natural dimensions, that is, elements\n * which have a known dimension either based on their value specified here,\n * or, if the value is null, a dimension specific to the browser.\n * `hasNaturalDimensions` checks for membership in this set.\n * `getNaturalDimensions` determines the dimensions for an element in the\n *    set and caches it.\n * @type {!Object<string, ?DimensionsDef>}\n * @private  Visible for testing only!\n */\nexport const naturalDimensions_ = {\n  'AMP-PIXEL': {width: '1px', height: '1px'},\n  'AMP-ANALYTICS': {width: '1px', height: '1px'},\n  // TODO(dvoytenko): audio should have width:auto.\n  'AMP-AUDIO': null\n};\n\n\n/**\n * Elements that the progess can be shown for. This set has to be externalized\n * since the element's implementation may not be downloaded yet.\n * @enum {boolean}\n * @private  Visible for testing only!\n */\nexport const LOADING_ELEMENTS_ = {\n  'AMP-ANIM': true,\n  'AMP-BRIGHTCOVE': true,\n  'AMP-IFRAME': true,\n  'AMP-IMG': true,\n  'AMP-INSTAGRAM': true,\n  'AMP-LIST': true,\n  'AMP-PINTEREST': true,\n  'AMP-VIDEO': true\n};\n\n\n/**\n * @param {string} s\n * @return {Layout|undefined} Returns undefined in case of failure to parse\n *   the layout string.\n */\nexport function parseLayout(s) {\n  for (const k in Layout) {\n    if (Layout[k] == s) {\n      return Layout[k];\n    }\n  }\n  return undefined;\n}\n\n\n/**\n * @param {!Layout} layout\n * @return {string}\n */\nexport function getLayoutClass(layout) {\n  return '-amp-layout-' + layout;\n}\n\n\n/**\n * Whether an element with this layout inherently defines the size.\n * @param {!Layout} layout\n * @return {boolean}\n */\nexport function isLayoutSizeDefined(layout) {\n  return (layout == Layout.FIXED ||\n      layout == Layout.FIXED_HEIGHT ||\n      layout == Layout.RESPONSIVE ||\n      layout == Layout.FILL);\n}\n\n\n/**\n * Whether the tag is an internal (service) AMP tag.\n * @param {!Node|string} tag\n * @return {boolean}\n */\nexport function isInternalElement(tag) {\n  const tagName = (typeof tag == 'string') ? tag : tag.tagName;\n  return tagName && tagName.toLowerCase().indexOf('i-') == 0;\n}\n\n\n/**\n * Parses the CSS length value. If no units specified, the assumed value is\n * \"px\". Returns undefined in case of parsing error.\n * @param {string|undefined} s\n * @return {!LengthDef|undefined}\n */\nexport function parseLength(s) {\n  if (typeof s == 'number') {\n    return s + 'px';\n  }\n  if (!s) {\n    return undefined;\n  }\n  if (!/^\\d+(\\.\\d+)?(px|em|rem|vh|vw|vmin|vmax)?$/.test(s)) {\n    return undefined;\n  }\n  if (/^\\d+(\\.\\d+)?$/.test(s)) {\n    return s + 'px';\n  }\n  return s;\n}\n\n\n/**\n * Asserts that the supplied value is a CSS Length value.\n * @param {!LengthDef|string} length\n * @return {!LengthDef}\n */\nexport function assertLength(length) {\n  assert(/^\\d+(\\.\\d+)?(px|em|rem|vh|vw|vmin|vmax)$/.test(length),\n      'Invalid length value: %s', length);\n  return length;\n}\n\n\n/**\n * Returns units from the CSS length value.\n * @param {!LengthDef} length\n * @return {string}\n */\nexport function getLengthUnits(length) {\n  assertLength(length);\n  const m = assert(length.match(/[a-z]+/i),\n      'Failed to read units from %s', length);\n  return m[0];\n}\n\n\n/**\n * Returns the numeric value of a CSS length value.\n * @param {!LengthDef|string} length\n * @return {number}\n */\nexport function getLengthNumeral(length) {\n  return parseFloat(length);\n}\n\n\n/**\n * Determines whether the tagName is a known element that has natural dimensions\n * in our runtime or the browser.\n * @param {string} tagName The element tag name.\n * @return {DimensionsDef}\n */\nexport function hasNaturalDimensions(tagName) {\n  tagName = tagName.toUpperCase();\n  return naturalDimensions_[tagName] !== undefined;\n}\n\n\n/**\n * Determines the default dimensions for an element which could vary across\n * different browser implementations, like <audio> for instance.\n * This operation can only be completed for an element whitelisted by\n * `hasNaturalDimensions`.\n * @param {string} tagName The element tag name.\n * @return {DimensionsDef}\n */\nexport function getNaturalDimensions(tagName) {\n  tagName = tagName.toUpperCase();\n  assert(naturalDimensions_[tagName] !== undefined);\n  if (!naturalDimensions_[tagName]) {\n    const naturalTagName = tagName.replace(/^AMP\\-/, '');\n    const temp = document.createElement(naturalTagName);\n    // For audio, should no-op elsewhere.\n    temp.controls = true;\n    temp.style.position = 'absolute';\n    temp.style.visibility = 'hidden';\n    document.body.appendChild(temp);\n    naturalDimensions_[tagName] = {\n      width: (temp./*OK*/offsetWidth || 1) + 'px',\n      height: (temp./*OK*/offsetHeight || 1) + 'px'\n    };\n    document.body.removeChild(temp);\n  }\n  return naturalDimensions_[tagName];\n}\n\n\n/**\n * Whether the loading can be shown for the specified elemeent. This set has\n * to be externalized since the element's implementation may not be\n * downloaded yet.\n * @param {string} tagName The element tag name.\n * @return {boolean}\n */\nexport function isLoadingAllowed(tagName) {\n  return LOADING_ELEMENTS_[tagName.toUpperCase()] || false;\n}\n","/**\n * Copyright 2015 The AMP HTML Authors. All Rights Reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS-IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {getMode} from './mode';\n\n/** @const Time when this JS loaded.  */\nconst start = new Date().getTime();\n\n\n/**\n * Logging.\n * // TODO(@cramforce): Make this DCRable.\n * Add #log=1 to URL to turn on logging when in prod (providing a build with\n * logging is used and #log=0 to turn off logging in local dev.\n * @final\n */\nexport class Log {\n\n  /**\n   * @param {!Window} win\n   */\n  constructor(win) {\n    /**\n     * In tests we use the main test window instead of the iframe where\n     * the tests runs because only the former is relayed to the console.\n     * @const {!Window}\n     */\n    this.win = win.AMP_TEST ? win.parent : win;\n\n    /** @private {boolean} */\n    this.isEnabled_ = this.shouldBeEnabled_();\n  }\n\n  shouldBeEnabled_() {\n    if (!this.win.console || !this.win.console.log) {\n      return false;\n    }\n    // Search for #log=0 or log=1\n    const match = this.win.location.hash.match(/log=(\\d)/);\n    const shouldLog = match && match[1];\n    if (getMode().localDev && shouldLog != '0') {\n      return true;\n    }\n    if (this.win.location.hash && shouldLog == '1') {\n      return true;\n    }\n    return false;\n  }\n\n  /**\n   * @param {string} tag\n   * @param {string} level\n   * @param {!Array} messages\n   * @param {?} opt_error\n   */\n  msg_(tag, level, messages) {\n    if (this.isEnabled_) {\n      let fn = this.win.console.log;\n      if (level == 'ERROR') {\n        fn = this.win.console.error || fn;\n      } else if (level == 'INFO') {\n        fn = this.win.console.info || fn;\n      } else if (level == 'WARN') {\n        fn = this.win.console.warn || fn;\n      }\n      messages.unshift(new Date().getTime() - start, '[' + tag + ']');\n      fn.apply(this.win.console, messages);\n    }\n  }\n\n  /**\n   * @param {string} tag\n   * @param {...*} var_args\n   */\n  fine(tag, var_args) {\n    if (this.isEnabled_) {\n      this.msg_(tag, 'FINE', Array.prototype.slice.call(arguments, 1));\n    }\n  }\n\n  /**\n   * @param {string} tag\n   * @param {...*} var_args\n   */\n  info(tag, var_args) {\n    if (this.isEnabled_) {\n      this.msg_(tag, 'INFO', Array.prototype.slice.call(arguments, 1));\n    }\n  }\n\n  /**\n   * @param {string} tag\n   * @param {...*} var_args\n   */\n  warn(tag, var_args) {\n    if (this.isEnabled_) {\n      this.msg_(tag, 'WARN', Array.prototype.slice.call(arguments, 1));\n    }\n  }\n\n  /**\n   * @param {string} tag\n   * @param {...*} var_args\n   * @param {?} opt_error\n   */\n  error(tag, var_args) {\n    if (this.isEnabled_) {\n      this.msg_(tag, 'ERROR', Array.prototype.slice.call(arguments, 1));\n    }\n  }\n};\n\n\nexport const log = new Log(window);\n","/**\n * Copyright 2015 The AMP HTML Authors. All Rights Reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS-IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {parseQueryString} from './url';\n\n\n/**\n * @typedef {{\n *   localDev: boolean\n * }}\n */\nlet ModeDef;\n\n/** @typedef {?ModeDef} */\nlet mode = null;\n\n/**\n * Provides info about the current app.\n * @return {!ModeDef}\n */\nexport function getMode() {\n  if (mode) {\n    return mode;\n  }\n  return mode = getMode_();\n}\n\n/**\n * Set mode in a test. Pass null in afterEach function to reset.\n * @param {?ModeDef} m\n */\nexport function setModeForTesting(m) {\n  mode = m;\n}\n\n/**\n * Provides info about the current app.\n * @return {!ModeDef}\n */\nfunction getMode_() {\n  const isLocalDev = (location.hostname == 'localhost' ||\n      (location.ancestorOrigins && location.ancestorOrigins[0] &&\n          location.ancestorOrigins[0].indexOf('http://localhost:') == 0)) &&\n      // Filter out localhost running against a prod script.\n      // Because all allowed scripts are ours, we know that these can only\n      // occur during local dev.\n      !!document.querySelector('script[src*=\"/dist/\"],script[src*=\"/base/\"]');\n\n  const overrideDevelopment = parseQueryString(location.hash)['development'];\n  const development = overrideDevelopment != undefined\n      ? overrideDevelopment == '1'\n      : !!document.querySelector('script[development]');\n\n  return {\n    localDev: isLocalDev,\n    // Triggers validation\n    development: development,\n    minified: process.env.NODE_ENV == 'production',\n    test: window.AMP_TEST\n  };\n}\n","/**\n * Copyright 2015 The AMP HTML Authors. All Rights Reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS-IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {timer} from './timer';\nimport {vsyncFor} from './vsync';\n\n/** @const {!Funtion} */\nconst NOOP_CALLBACK_ = function() {};\n\n/** @const {number} */\nconst MIN_VELOCITY_ = 0.02;\n\n/** @const {number} */\nconst FRAME_CONST_ = 16.67;\n\n/** @const {number} */\nconst EXP_FRAME_CONST_ = Math.round(-FRAME_CONST_ / Math.log(0.95));\n\n/**\n * Depreciation factor of 1/100 of a millisecond. This is how much previous\n * velocity is depreciated when calculating the new velocity.\n * @const {number}\n */\nconst VELOCITY_DEPR_FACTOR_ = FRAME_CONST_ * 2;\n\n\n/**\n * Calculates velocity for an object traveling the distance deltaV in the\n * time deltaTime given the previous velocity prevVelocity. The calculation\n * assumes a basic informational depreciation of previous velocity.\n * @param {number} deltaV\n * @param {time} deltaTime\n * @param {number} prevVelocity\n * @return {number}\n */\nexport function calcVelocity(deltaV, deltaTime, prevVelocity) {\n  if (deltaTime < 1) {\n    deltaTime = 1;\n  }\n\n  // Calculate speed and speed depreciation.\n  const speed = deltaV / deltaTime;\n\n  // Depreciation is simply an informational quality. It basically means:\n  // we can't ignore the velocity we knew recently, but we'd only consider\n  // it proportionally to how long ago we've seen it. Currently, this\n  // depreciation factor is 1/100 of a millisecond. New average velocity is\n  // calculated by weighing toward the new velocity and away from old\n  // velocity based on the depreciation.\n  const depr = 0.5 + Math.min(deltaTime / VELOCITY_DEPR_FACTOR_, 0.5);\n  return speed * depr + prevVelocity * (1 - depr);\n}\n\n\n/**\n * Returns a motion process that will yield when the velocity has run down to\n * zerp. For each iteration, the velocity is depreciated and the coordinates\n * are advanced from start X/Y to the destination according to velocity\n * vectors. For each such iteration the callback is called with the new x and y.\n * @param {number} startX Start X coordinate.\n * @param {number} startY Start Y coordinate.\n * @param {number} veloX Starting X velocity.\n * @param {number} veloY Starting Y velocity.\n * @param {function(number, number):boolean} callback The callback for each\n *   step of the deceleration motion.\n * @param {!Vsync=} opt_vsync Mostly for testing only.\n * @return {!Motion}\n */\nexport function continueMotion(startX, startY, veloX, veloY, callback,\n    opt_vsync) {\n  return new Motion(startX, startY, veloX, veloY, callback, opt_vsync).start_();\n}\n\n\n/**\n * Motion process that allows tracking and monitoring of the running motion.\n * Most importantly it exposes methods \"then\" and \"thenAlways\" that have the\n * semantics of a Promise and signal when the motion has completed or failed.\n * Additionally, it exposes the method \"halt\" which allows to stop/reset the\n * motion.\n * @implements {IThenable}\n */\nclass Motion {\n  /**\n   * @param {number} startX Start X coordinate.\n   * @param {number} startY Start Y coordinate.\n   * @param {number} veloX Starting X velocity.\n   * @param {number} veloY Starting Y velocity.\n   * @param {function(number, number):boolean} callback The callback for each\n   *   step of the deceleration motion.\n   * @param {!Vsync=} opt_vsync\n   */\n  constructor(startX, startY, veloX, veloY, callback, opt_vsync) {\n    /** @private @const */\n    this.vsync_ = opt_vsync || vsyncFor(window);\n\n    /** @private @const */\n    this.callback_ = callback;\n\n    /** @private {number} */\n    this.lastX_ = startX;\n\n    /** @private {number} */\n    this.lastY_ = startY;\n\n    /** @private {number} */\n    this.maxVelocityX_ = veloX;\n\n    /** @private {number} */\n    this.maxVelocityY_ = veloY;\n\n    /** @private {number} */\n    this.velocityX_ = 0;\n\n    /** @private {number} */\n    this.velocityY_ = 0;\n\n    /** @private {time} */\n    this.startTime_ = timer.now();\n\n    /** @private {time} */\n    this.lastTime_ = this.startTime_;\n\n    /** @private {!Function} */\n    this.resolve_;\n\n    /** @private {!Function} */\n    this.reject_;\n\n    /** @private {!Promise} */\n    this.promise_ = new Promise((resolve, reject) => {\n      this.resolve_ = resolve;\n      this.reject_ = reject;\n    });\n  }\n\n  /** @private */\n  start_() {\n    this.continuing_ = true;\n    if (Math.abs(this.maxVelocityX_) <= MIN_VELOCITY_ &&\n            Math.abs(this.maxVelocityY_) <= MIN_VELOCITY_) {\n      this.fireMove_();\n      this.completeContinue_(true);\n    } else {\n      this.runContinuing_();\n    }\n    return this;\n  }\n\n  /**\n   * Halts the motion. The motion promise will be rejected since the motion\n   * has been interrupted.\n   */\n  halt() {\n    if (this.continuing_) {\n      this.completeContinue_(false);\n    }\n  }\n\n  /**\n   * Chains to the motion's promise that will resolve when the motion has\n   * completed or will reject if motion has failed or was interrupted.\n   * @param {!Function=} opt_resolve\n   * @param {!Function=} opt_reject\n   * @return {!Promise}\n   */\n  then(opt_resolve, opt_reject) {\n    if (!opt_resolve && !opt_reject) {\n      return this.promise_;\n    }\n    return this.promise_.then(opt_resolve, opt_reject);\n  }\n\n  /**\n   * Callback for regardless whether the motion succeeds or fails.\n   * @param {!Function=} opt_callback\n   * @return {!Promise}\n   */\n  thenAlways(opt_callback) {\n    const callback = opt_callback || NOOP_CALLBACK_;\n    return this.then(callback, callback);\n  }\n\n  /**\n   * @return {!Promise}\n   * @private\n   */\n  runContinuing_() {\n    this.velocityX_ = this.maxVelocityX_;\n    this.velocityY_ = this.maxVelocityY_;\n    const boundStep = this.stepContinue_.bind(this);\n    const boundComplete = this.completeContinue_.bind(this, true);\n    return this.vsync_.runAnimMutateSeries(boundStep, 5000)\n        .then(boundComplete, boundComplete);\n  }\n\n  /**\n   * Returns \"true\" to continue and \"false\" to stop motion process.\n   * @param {time} timeSinceStart\n   * @param {time} timeSincePrev\n   * @return {boolean}\n   * @private\n   */\n  stepContinue_(timeSinceStart, timeSincePrev) {\n    if (!this.continuing_) {\n      return false;\n    }\n\n    this.lastTime_ = timer.now();\n    this.lastX_ += timeSincePrev * this.velocityX_;\n    this.lastY_ += timeSincePrev * this.velocityY_;\n    if (!this.fireMove_()) {\n      return false;\n    }\n\n    const decel = Math.exp(-timeSinceStart / EXP_FRAME_CONST_);\n    this.velocityX_ = this.maxVelocityX_ * decel;\n    this.velocityY_ = this.maxVelocityY_ * decel;\n    return (Math.abs(this.velocityX_) > MIN_VELOCITY_ ||\n        Math.abs(this.velocityY_) > MIN_VELOCITY_);\n  }\n\n  /**\n   * @param {boolean} success\n   * @private\n   */\n  completeContinue_(success) {\n    if (!this.continuing_) {\n      return;\n    }\n    this.continuing_ = false;\n    this.lastTime_ = timer.now();\n    this.fireMove_();\n    if (success) {\n      this.resolve_();\n    } else {\n      this.reject_();\n    }\n  }\n\n  /** @private */\n  fireMove_() {\n    return this.callback_(this.lastX_, this.lastY_);\n  }\n}\n","/**\n * Copyright 2015 The AMP HTML Authors. All Rights Reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS-IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n\n/**\n * This type signifies a callback that can be called to remove the listener.\n * @typedef {function()}\n */\nclass UnlistenDef {}\n\n\n/**\n * This class helps to manage observers. Observers can be added, removed or\n * fired through and instance of this class.\n * @template TYPE\n */\nexport class Observable {\n\n  constructor() {\n    /** @const {!Array<function(TYPE)>} */\n    this.handlers_ = [];\n  }\n\n  /**\n   * Adds the observer to this instance.\n   * @param {function(TYPE)} handler Observer's handler.\n   * @return {!UnlistenDef}\n   */\n  add(handler) {\n    this.handlers_.push(handler);\n    return () => {\n      this.remove(handler);\n    };\n  }\n\n  /**\n   * Removes the observer from this instance.\n   * @param {function(TYPE)} handler Observer's instance.\n   */\n  remove(handler) {\n    for (let i = 0; i < this.handlers_.length; i++) {\n      if (handler == this.handlers_[i]) {\n        this.handlers_.splice(i, 1);\n        break;\n      }\n    }\n  }\n\n  /**\n   * Fires an event. All observers are called.\n   * @param {TYPE} event\n   */\n  fire(event) {\n    this.handlers_.forEach(handler => {\n      handler(event);\n    });\n  }\n\n  /**\n   * Returns number of handlers. Mostly needed for tests.\n   * @return {number}\n   */\n  getHandlerCount() {\n    return this.handlers_.length;\n  }\n}\n","/**\n * Copyright 2015 The AMP HTML Authors. All Rights Reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS-IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {timer} from './timer';\n\n\n/**\n * Pass class helps to manage single-pass process. A pass is scheduled using\n * delay method. Only one pass can be pending at a time. If no pass is pending\n * the process is considered to be \"idle\".\n */\nexport class Pass {\n\n  /**\n   * Creates a new Pass instance.\n   * @param {function()} handler Handler to be executed when pass is triggered.\n   * @param {number=} opt_defaultDelay Default delay to be used when schedule\n   *   is called without one.\n   */\n  constructor(handler, opt_defaultDelay) {\n    /** @private @const {function()} */\n    this.handler_ = handler;\n\n    /** @private @const {number|string} */\n    this.defaultDelay_ = opt_defaultDelay || 0;\n\n    /** @private {number|string} */\n    this.scheduled_ = -1;\n\n    /** @private {number} */\n    this.nextTime_ = 0;\n\n    /** @private {boolean} */\n    this.running_ = false;\n  }\n\n  /**\n   * Whether or not a pass is currently pending.\n   * @return {boolean}\n   */\n  isPending() {\n    return this.scheduled_ != -1;\n  }\n\n  /**\n   * Tries to schedule a new pass optionally with specified delay. If the new\n   * requested pass is requested before the pending pass, the pending pass is\n   * canceled. If the new pass is requested after the pending pass, the newly\n   * requested pass is ignored.\n   *\n   * Returns {@code true} if the pass has been scheduled and {@code false} if\n   * ignored.\n   *\n   * @param {number=} opt_delay Delay to schedule the pass. If not specified\n   *   the default delay is used, falling back to 0.\n   * @return {boolean}\n   */\n  schedule(opt_delay) {\n    let delay = opt_delay || this.defaultDelay_;\n    if (this.running_ && delay < 10) {\n      // If we get called recursively, wait at least 10ms for the next\n      // execution.\n      delay = 10;\n    }\n    const nextTime = timer.now() + delay;\n    // Schedule anew if nothing is scheduled currently of if the new time is\n    // sooner then previously requested.\n    if (this.scheduled_ == -1 || nextTime - this.nextTime_ < -10) {\n      if (this.scheduled_ != -1) {\n        timer.cancel(this.scheduled_);\n      }\n      this.nextTime_ = nextTime;\n      this.scheduled_ = timer.delay(() => {\n        this.scheduled_ = -1;\n        this.nextTime_ = 0;\n        this.running_ = true;\n        this.handler_();\n        this.running_ = false;\n      }, delay);\n      return true;\n    }\n    return false;\n  }\n\n  /**\n   * Cancels the pending pass if any.\n   */\n  cancel() {\n    if (this.scheduled_ != -1) {\n      timer.cancel(this.scheduled_);\n      this.scheduled_ = -1;\n    }\n  }\n}\n","/**\n * Copyright 2015 The AMP HTML Authors. All Rights Reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS-IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {assert} from './asserts';\n\n/**\n * Holds info about a service.\n * - obj: Actual service implementation when available.\n * - promise: Promise for the obj.\n * - resolve: Function to resolve the promise with the object.\n * @typedef {{\n *   obj: (?Object),\n *   promise: (?Promise|undefined),\n *   resolve: (?function(!Object)|undefined),\n * }}\n */\nlet ServiceHolderDef;\n\n/**\n * Returns a service for the given id and window (a per-window singleton).\n * If the service is not yet available the factory function is invoked and\n * expected to return the service.\n * Users should typically wrap this as a special purpose function (e.g.\n * viewportFor(win)) for type safety and because the factory should not be\n * passed around.\n * @param {!Window} win\n * @param {string} id of the service.\n * @param {function(!Window):!Object=} opt_factory Should create the service\n *     if it does not exist yet. If the factory is not given, it is an error\n *     if the service does not exist yet.\n * @return {*}\n */\nexport function getService(win, id, opt_factory) {\n  const services = getServices(win);\n  let s = services[id];\n  if (!s) {\n    s = services[id] = {};\n  }\n  if (!s.obj) {\n    assert(opt_factory, 'Factory not given and service missing %s', id);\n    s.obj = opt_factory(win);\n    // The service may have been requested already, in which case we have a\n    // pending promise we need to fulfill.\n    if (s.resolve) {\n      s.resolve(s.obj);\n    }\n  }\n  return s.obj;\n}\n\n/**\n * Returns a promise for a service for the given id and window. Also expects\n * an element that has the actual implementation. The promise resolves when\n * the implementation loaded.\n * Users should typically wrap this as a special purpose function (e.g.\n * viewportFor(win)) for type safety and because the factory should not be\n * passed around.\n * @param {!Window} win\n * @param {string} id of the service.\n * @param {string} provideByElement Name of the custom element that provides\n *     the implementation of this service.\n * @return {!Promise<*>}\n */\nexport function getElementService(win, id, providedByElement) {\n  // Call `getElementService_` in a micro-task to ensure that `stubElements`\n  // has been called.\n  return Promise.resolve().then(() => {\n    return getElementService_(win, id, providedByElement);\n  });\n}\n\n/**\n * @param {!Window} win\n * @param {string} id of the service.\n * @param {string} provideByElement Name of the custom element that provides\n *     the implementation of this service.\n * @return {!Promise<*>}\n * @private\n */\nfunction getElementService_(win, id, providedByElement) {\n  assert(isElementScheduled(win, providedByElement),\n      'Service %s was requested to be provided through %s, ' +\n      'but %s is not loaded in the current page. To fix this ' +\n      'problem load the JavaScript file for %s in this page.',\n      id, providedByElement, providedByElement, providedByElement);\n  const services = getServices(win);\n  const s = services[id];\n  if (s) {\n    // If a service was registered with getService, we make a promise from it\n    // which we will return in future invocations.\n    if (!s.promise) {\n      s.promise = Promise.resolve(s.obj);\n    }\n    return s.promise;\n  }\n  // TODO(@cramforce): Add a check that if the element is eventually registered\n  // that the service is actually provided and this promise resolves.\n  let resolve;\n  const p = new Promise(r => {\n    resolve = r;\n  });\n  services[id] = {\n    obj: null,\n    promise: p,\n    resolve: resolve,\n  };\n\n  return p;\n}\n\n/**\n * @param {!Window} win\n * @param {string} elementName Name of an extended custom element.\n * @return {boolean} Whether this element is scheduled to be loaded.\n */\nfunction isElementScheduled(win, elementName) {\n  assert(win.ampExtendedElements, 'win.ampExtendedElements not created yet');\n  return !!win.ampExtendedElements[elementName];\n}\n\n/**\n * In order to provide better error messages we only allow to retrieve\n * services from other elements if those elements are loaded in the page.\n * This makes it possible to mark an element as loaded in a test.\n * @param {!Window} win\n * @param {string} elementName Name of an extended custom element.\n */\nexport function markElementScheduledForTesting(win, elementName) {\n  if (!win.ampExtendedElements) {\n    win.ampExtendedElements = {};\n  }\n  win.ampExtendedElements[elementName] = true;\n}\n\n/**\n * Returns the object that holds the services registered in a window.\n * @param {!Window} win\n * @return {!Object<string,!ServiceHolderDef>}\n */\nfunction getServices(win) {\n  let services = win.services;\n  if (!services) {\n    services = win.services = {};\n  }\n  return services;\n}\n\n/**\n * Resets a single service, so it gets recreated on next getService invocation.\n * @param {!Window} win\n * @param {string} id of the service.\n */\nexport function resetServiceForTesting(win, id) {\n  if (win.services) {\n    win.services[id] = null;\n  }\n}\n","/**\n * Copyright 2015 The AMP HTML Authors. All Rights Reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS-IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {assert} from './asserts';\n\n\n/**\n * A single source within a srcset. Only one: width or DPR can be specified at\n * a time.\n * @typedef {{\n *   url: string,\n *   width: (number|undefined),\n *   dpr: (number|undefined)\n * }}\n */\nlet SrcsetSourceDef;\n\n\n/**\n * Parses the text representation of srcset into Srcset object.\n * See https://developer.mozilla.org/en-US/docs/Web/HTML/Element/img#Attributes.\n * See http://www.w3.org/html/wg/drafts/html/master/semantics.html#attr-img-srcset.\n * @param {string} s\n * @return {!Srcset}\n */\nexport function parseSrcset(s) {\n  // General grammar: (URL [NUM[w|x]],)*\n  // Example 1: \"image1.png 100w, image2.png 50w\"\n  // Example 2: \"image1.png 2x, image2.png\"\n  // Example 3: \"image1,100w.png 100w, image2.png 50w\"\n  const sSources = s.match(\n      /\\s*([^\\s]*)(\\s+(-?(\\d+(\\.(\\d+)?)?|\\.\\d+)[a-zA-Z]))?(\\s*,)?/g);\n  assert(sSources.length > 0, 'srcset has to have at least one source');\n  const sources = [];\n  sSources.forEach(sSource => {\n    sSource = sSource.trim();\n    if (sSource.substr(-1) == ',') {\n      sSource = sSource.substr(0, sSource.length - 1).trim();\n    }\n    const parts = sSource.split(/\\s+/, 2);\n    if (parts.length == 0 ||\n          parts.length == 1 && !parts[0] ||\n          parts.length == 2 && !parts[0] && !parts[1]) {\n      return;\n    }\n    const url = parts[0].trim();\n    if (parts.length == 1 || parts.length == 2 && !parts[1]) {\n      // If no \"w\" or \"x\" specified, we assume it's \"1x\".\n      sources.push({url: url, dpr: 1});\n    } else {\n      const spec = parts[1].trim().toLowerCase();\n      const lastChar = spec.substring(spec.length - 1);\n      if (lastChar == 'w') {\n        sources.push({url: url, width: parseFloat(spec)});\n      } else if (lastChar == 'x') {\n        sources.push({url: url, dpr: parseFloat(spec)});\n      }\n    }\n  });\n  return new Srcset(sources);\n};\n\n\n/**\n * A srcset object contains one or more sources.\n *\n * There are two types of sources: width-based and DPR-based. Only one type\n * of sources allowed to be specified within a single srcset. Depending on a\n * usecase, the components are free to choose any source that best corresponds\n * to the required rendering quality and network and CPU conditions. See\n * \"select\" method for details on how this selection is performed.\n *\n * See https://developer.mozilla.org/en-US/docs/Web/HTML/Element/img#Attributes\n */\nexport class Srcset {\n\n  /**\n   * @param {!Array<!SrcsetSourceDef>} sources\n   */\n  constructor(sources) {\n    assert(sources.length > 0, 'Srcset must have at least one source');\n    /** @private @const {!Array<!SrcsetSourceDef>} */\n    this.sources_ = sources;\n\n    // Only one type of source specified can be used - width or DPR.\n    let hasWidth = false;\n    let hasDpr = false;\n    this.sources_.forEach(source => {\n      assert((source.width || source.dpr) && (!source.width || !source.dpr),\n          'Either dpr or width must be specified');\n      hasWidth = hasWidth || !!source.width;\n      hasDpr = hasDpr || !!source.dpr;\n    });\n    assert(!hasWidth || !hasDpr,\n        'Srcset cannot have both width and dpr sources');\n\n    // Source and assert duplicates.\n    if (hasWidth) {\n      this.sources_.sort((s1, s2) => {\n        assert(s1.width != s2.width, 'Duplicate width: %s', s1.width);\n        return s2.width - s1.width;\n      });\n    } else {\n      this.sources_.sort((s1, s2) => {\n        assert(s1.dpr != s2.dpr, 'Duplicate dpr: %s', s1.dpr);\n        return s2.dpr - s1.dpr;\n      });\n    }\n\n    /** @private @const {boolean} */\n    this.widthBased_ = hasWidth;\n\n    /** @private @const {boolean} */\n    this.dprBased_ = hasDpr;\n  }\n\n  /**\n   * Performs selection for specified width and DPR. Here, width is the width\n   * in screen pixels and DPR is the device-pixel-ratio or pixel density of\n   * the device. Depending on the circumstances, such as low network conditions,\n   * it's possible to manipulate the result of this method by passing a lower\n   * DPR value.\n   *\n   * The source selection depends on whether this is width-based or DPR-based\n   * srcset.\n   *\n   * In a width-based source, the source's width is the physical width of a\n   * resource (e.g. an image). Depending on the provided DPR, this width is\n   * converted to the screen pixels as following:\n   *   pixelWidth = sourceWidth / DPR\n   *\n   * Then, the source closest to the requested \"width\" is selected using\n   * the \"pixelWidth\". The slight preference is given to the bigger sources to\n   * ensure the most optimal quality.\n   *\n   * In a DPR-based source, the source's DPR is used to return the source that\n   * is closest to the requested DPR.\n   *\n   * Based on\n   * http://www.w3.org/html/wg/drafts/html/master/semantics.html#attr-img-srcset.\n   * @param {number} width\n   * @param {number} dpr\n   * @return {!SrcsetSourceDef}\n   */\n  select(width, dpr) {\n    assert(width, 'width=%s', width);\n    assert(dpr, 'dpr=%s', dpr);\n    let index = -1;\n    if (this.widthBased_) {\n      index = this.selectByWidth_(width, dpr);\n    } else if (this.dprBased_) {\n      index = this.selectByDpr_(width, dpr);\n    }\n    if (index != -1) {\n      return this.sources_[index];\n    }\n    return this.getLast();\n  }\n\n  /**\n   * @param {number} width\n   * @param {number} dpr\n   * @return {number}\n   * @private\n   */\n  selectByWidth_(width, dpr) {\n    let minIndex = -1;\n    let minWidth = 1000000;\n    let minScore = 1000000;\n    for (let i = 0; i < this.sources_.length; i++) {\n      const source = this.sources_[i];\n      let sourceWidth;\n      if (source.width) {\n        sourceWidth = source.width / dpr;\n      } else {\n        // Default source: no width: assume values are half of of the\n        // minimum values seen.\n        sourceWidth = minWidth / 2;\n      }\n      minWidth = Math.min(minWidth, sourceWidth);\n      // The calculation is slightly biased toward higher width by offsetting\n      // score by negative 0.2.\n      const score = Math.abs((sourceWidth - width) / width - 0.2);\n      if (score < minScore) {\n        minScore = score;\n        minIndex = i;\n      }\n    }\n    return minIndex;\n  }\n\n  /**\n   * @param {number} width\n   * @param {number} dpr\n   * @return {number}\n   * @private\n   */\n  selectByDpr_(_width, dpr) {\n    let minIndex = -1;\n    let minScore = 1000000;\n    for (let i = 0; i < this.sources_.length; i++) {\n      const source = this.sources_[i];\n      // Default DPR = 1.\n      const sourceDpr = source.dpr || 1;\n      const score = Math.abs(sourceDpr - dpr);\n      if (score < minScore) {\n        minScore = score;\n        minIndex = i;\n      }\n    }\n    return minIndex;\n  }\n\n  /**\n   * Returns the last source in the srcset, which is the default source.\n   * @return {!SrcsetSourceDef}\n   */\n  getLast() {\n    return this.sources_[this.sources_.length - 1];\n  }\n}\n","/**\n * Copyright 2015 The AMP HTML Authors. All Rights Reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS-IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n\n// Note: loaded by 3p system. Cannot rely on babel polyfills.\n\n/** @private @const {!Object<string>} */\nconst propertyNameCache_ = Object.create(null);\n\n/** @private @const {!Array<string>} */\nconst vendorPrefixes_ = ['Webkit', 'webkit', 'Moz', 'moz', 'ms', 'O', 'o'];\n\n\n/**\n * @export\n * @param {string} camelCase camel cased string\n * @return {string} title cased string\n */\nexport function camelCaseToTitleCase(camelCase) {\n  return camelCase.charAt(0).toUpperCase() + camelCase.slice(1);\n}\n\n/**\n * Checks the object if a prefixed version of a property exists and returns\n * it or returns an empty string.\n * @private\n * @param {!Object} object\n * @param {string} titleCase the title case version of a css property name\n * @return {string} the prefixed property name or null.\n */\nfunction getVendorJsPropertyName_(object, titleCase) {\n  for (let i = 0; i < vendorPrefixes_.length; i++) {\n    const propertyName = vendorPrefixes_[i] + titleCase;\n    if (object[propertyName] !== undefined) {\n      return propertyName;\n    }\n  }\n  return '';\n}\n\n/**\n * Returns the possibly prefixed JavaScript property name of a style property\n * (ex. WebkitTransitionDuration) given a camelCase'd version of the property\n * (ex. transitionDuration).\n * @export\n * @param {!Object} object\n * @param {string} camelCase the camel cased version of a css property name\n * @param {boolean=} opt_bypassCache bypass the memoized cache of property\n *   mapping\n * @return {string}\n */\nexport function getVendorJsPropertyName(object, camelCase, opt_bypassCache) {\n  let propertyName = propertyNameCache_[camelCase];\n  if (!propertyName || opt_bypassCache) {\n    propertyName = camelCase;\n    if (object[camelCase] === undefined) {\n      const titleCase = camelCaseToTitleCase(camelCase);\n      const prefixedPropertyName = getVendorJsPropertyName_(object, titleCase);\n\n      if (object[prefixedPropertyName] !== undefined) {\n        propertyName = prefixedPropertyName;\n      }\n    }\n    if (!opt_bypassCache) {\n      propertyNameCache_[camelCase] = propertyName;\n    }\n  }\n  return propertyName;\n}\n\n\n/**\n * Sets the CSS style of the specified element with optional units, e.g. \"px\".\n * @param {!Element} element\n * @param {string} property\n * @param {*} value\n * @param {string=} opt_units\n * @param {boolean=} opt_bypassCache\n */\nexport function setStyle(element, property, value, opt_units, opt_bypassCache) {\n  const propertyName = getVendorJsPropertyName(element.style, property,\n      opt_bypassCache);\n  if (propertyName) {\n    element.style[propertyName] = opt_units ? value + opt_units : value;\n  }\n}\n\n\n/**\n * Returns the value of the CSS style of the specified element.\n * @param {!Element} element\n * @param {string} property\n * @param {boolean=} opt_bypassCache\n * @return {*}\n */\nexport function getStyle(element, property, opt_bypassCache) {\n  const propertyName = getVendorJsPropertyName(element.style, property,\n      opt_bypassCache);\n  if (!propertyName) {\n    return undefined;\n  }\n  return element.style[propertyName];\n}\n\n\n/**\n * Sets the CSS styles of the specified element. The styles\n * a specified as a map from CSS property names to their values.\n * @param {!Element} element\n * @param {!Object<string, *>} styles\n */\nexport function setStyles(element, styles) {\n  for (const k in styles) {\n    setStyle(element, k, styles[k]);\n  }\n}\n\n\n/**\n * Shows or hides the specified element.\n * @param {!Element} element\n * @param {boolean=} opt_display\n */\nexport function toggle(element, opt_display) {\n  if (opt_display === undefined) {\n    opt_display = !(element.style.display != 'none');\n  }\n  element.style.display = opt_display ? '' : 'none';\n}\n\n\n/**\n * Returns a pixel value.\n * @param {number} value\n * @return {string}\n */\nexport function px(value) {\n  return value + 'px';\n}\n\n\n/**\n * Returns a \"translateX\" for CSS \"transform\" property.\n * @param {number|string} value\n * @return {string}\n */\nexport function translateX(value) {\n  if (typeof value == 'string') {\n    return `translateX(${value})`;\n  }\n  return `translateX(${px(value)})`;\n}\n\n\n/**\n * Returns a \"translateX\" for CSS \"transform\" property.\n * @param {number|string} x\n * @param {(number|string)=} opt_y\n * @return {string}\n */\nexport function translate(x, opt_y) {\n  if (typeof x == 'number') {\n    x = px(x);\n  }\n  if (opt_y === undefined) {\n    return `translate(${x})`;\n  }\n  if (typeof opt_y == 'number') {\n    opt_y = px(opt_y);\n  }\n  return `translate(${x},${opt_y})`;\n}\n\n\n/**\n * Returns a \"scale\" for CSS \"transform\" property.\n * @param {number|string} value\n * @return {string}\n */\nexport function scale(value) {\n  return `scale(${value})`;\n}\n","/**\n * Copyright 2015 The AMP HTML Authors. All Rights Reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS-IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/**\n * Helper with all things Timer.\n */\nexport class Timer {\n\n  /**\n   * @param {!Window} win\n   */\n  constructor(win) {\n    /** @const {!Window} */\n    this.win = win;\n\n    /** @private @const {!Promise}  */\n    this.resolved_ = Promise.resolve();\n\n    this.taskCount_ = 0;\n\n    this.canceled_ = {};\n\n    /** @const {number} */\n    this.startTime_ = this.now();\n  }\n\n  /**\n   * Returns the current EPOC time in milliseconds.\n   * @return {number}\n   */\n  now() {\n    // TODO(dvoytenko): when can we use Date.now?\n    return Number(new Date());\n  }\n\n /**\n  * Returns time since start in milliseconds.\n  * @return {number}\n  */\n  timeSinceStart() {\n    return this.now() - this.startTime_;\n  }\n\n  /**\n   * Runs the provided callback after the specified delay. This uses a micro\n   * task for 0 or no specified time. This means that the delay will actually\n   * be close to 0 and this will NOT yield to the event queue.\n   *\n   * Returns the timer ID that can be used to cancel the timer (cancel method).\n   * @param {!function()} callback\n   * @param {number=} opt_delay\n   * @return {number|string}\n   */\n  delay(callback, opt_delay) {\n    if (!opt_delay) {\n      // For a delay of zero,  schedule a promise based micro task since\n      // they are predictably fast.\n      const id = 'p' + this.taskCount_++;\n      this.resolved_.then(() => {\n        if (this.canceled_[id]) {\n          delete this.canceled_[id];\n          return;\n        }\n        callback();\n      });\n      return id;\n    }\n    return this.win.setTimeout(callback, opt_delay);\n  }\n\n  /**\n   * Cancels the previously scheduled callback.\n   * @param {number|string} timeoutId\n   */\n  cancel(timeoutId) {\n    if (typeof timeoutId == 'string') {\n      this.canceled_[timeoutId] = true;\n      return;\n    }\n    this.win.clearTimeout(timeoutId);\n  }\n\n  /**\n   * Returns a promise that will resolve after the delay. Optionally, the\n   * resolved value can be provided as opt_result argument.\n   * @param {number=} opt_delay\n   * @param {RESULT=} opt_result\n   * @return {!Promise<RESULT>}\n   * @template RESULT\n   */\n  promise(opt_delay, opt_result) {\n    let timerKey = null;\n    return new Promise((resolve, reject) => {\n      timerKey = this.delay(() => {\n        timerKey = -1;\n        resolve(opt_result);\n      }, opt_delay);\n      if (timerKey == -1) {\n        reject(new Error('Failed to schedule timer.'));\n      }\n    }).catch(error => {\n      // Clear the timer. The most likely reason is \"cancel\" signal.\n      if (timerKey != -1) {\n        this.cancel(timerKey);\n      }\n      return Promise.reject(error);\n    });\n  }\n\n  /**\n   * Returns a promise that will fail after the specified delay. Optionally,\n   * this method can take opt_racePromise parameter. In this case, the\n   * resulting promise will either fail when the specified delay expires or\n   * will resolve based on the opt_racePromise, whichever happens first.\n   * @param {number} delay\n   * @param {!Promise<RESULT>|undefined} opt_racePromise\n   * @return {!Promise<RESULT>}\n   * @template RESULT\n   */\n  timeoutPromise(delay, opt_racePromise) {\n    let timerKey = null;\n    const delayPromise = new Promise((_resolve, reject) => {\n      timerKey = this.delay(() => {\n        timerKey = -1;\n        reject('timeout');\n      }, delay);\n      if (timerKey == -1) {\n        reject(new Error('Failed to schedule timer.'));\n      }\n    }).catch(error => {\n      // Clear the timer. The most likely reason is \"cancel\" signal.\n      if (timerKey != -1) {\n        this.cancel(timerKey);\n      }\n      return Promise.reject(error);\n    });\n    if (!opt_racePromise) {\n      return delayPromise;\n    }\n    // Avoids Promise->race due to presubmit check against it.\n    return new Promise((resolve, reject) => {\n      delayPromise.then(resolve, reject);\n      opt_racePromise.then(resolve, reject);\n    });\n  }\n}\n\n\nexport const timer = new Timer(window);\n","/**\n * Copyright 2015 The AMP HTML Authors. All Rights Reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS-IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {getCurve} from './curve';\nimport * as st from './style';\n\n\n/**\n * TransitionDef function that accepts normtime, typically between 0 and 1 and\n * performs an arbitrary animation action. Notice that sometimes normtime can\n * dip above 1 or below 0. This is an acceptable case for some curves. The\n * second argument is a boolean value that equals \"true\" for the completed\n * transition and \"false\" for ongoing.\n * @typedef {function(normtime, boolean):RESULT}\n * @template RESULT\n */\nclass TransitionDef {}\n\n\nexport const NOOP = function(unusedTime) {return null;};\n\n\n/**\n * Returns a transition that combines a number of other transitions and\n * invokes them all in parallel.\n * @param {!Array<!TransitionDef>} transitions\n * @return {!TransitionDef<void>}\n */\nexport function all(transitions) {\n  return (time, complete) => {\n    for (let i = 0; i < transitions.length; i++) {\n      const tr = transitions[i];\n      tr(time, complete);\n    }\n  };\n}\n\n\n/**\n * Returns the specified transition with the time curved via specified curve\n * function.\n * @param {!TransitionDef<RESULT>} transition\n * @param {!Curve|string} curve\n * @return {!TransitionDef<RESULT>}\n * @template RESULT\n */\nexport function withCurve(transition, curve) {\n  curve = getCurve(curve);\n  return (time, complete) => {\n    return transition(complete ? 1 : curve(time), complete);\n  };\n}\n\n\n/**\n * A transition that sets the CSS style of the specified element. The styles\n * a specified as a map from CSS property names to transition functions for\n * each of these properties.\n * @param {!Element} element\n * @param {!Object<string, !TransitionDef>} styles\n * @return {!TransitionDef<void>}\n */\nexport function setStyles(element, styles) {\n  return (time, complete) => {\n    for (const k in styles) {\n      st.setStyle(element, k, styles[k](time, complete));\n    }\n  };\n}\n\n\n/**\n * A basic numeric interpolation.\n * @param {number} start\n * @param {number} end\n * @return {!TransitionDef<number>}\n */\nexport function numeric(start, end) {\n  return time => {\n    return start + (end - start) * time;\n  };\n}\n\n\n/**\n * Spring numeric interpolation.\n * @param {number} start\n * @param {number} end\n * @param {number} extended\n * @param {number} threshold\n * @return {!TransitionDef<number>}\n */\nexport function spring(start, end, extended, threshold) {\n  if (end == extended) {\n    return time => {\n      return numeric(start, end)(time);\n    };\n  }\n  return time => {\n    if (time < threshold) {\n      return start + (extended - start) * (time / threshold);\n    }\n    return extended + (end - extended) * ((time - threshold) /\n        (1 - threshold));\n  };\n}\n\n\n/**\n * Adds \"px\" units.\n * @param {!TransitionDef<number>} transition\n * @return {!TransitionDef<string>}\n */\nexport function px(transition) {\n  return time => {\n    return transition(time) + 'px';\n  };\n}\n\n\n/**\n * A transition for \"translateX\" of CSS \"transform\" property.\n * @param {!TransitionDef<number|string>} transition\n * @return {!TransitionDef<string>}\n */\nexport function translateX(transition) {\n  return time => {\n    const res = transition(time);\n    if (typeof res == 'string') {\n      return `translateX(${res})`;\n    }\n    return `translateX(${res}px)`;\n  };\n}\n\n\n/**\n * A transition for \"translate(x, y)\" of CSS \"transform\" property.\n * @param {!TransitionDef<number|string>} transitionX\n * @param {!TransitionDef<number|string>|undefined} opt_transitionY\n * @return {!TransitionDef<string>}\n */\nexport function translate(transitionX, opt_transitionY) {\n  return time => {\n    let x = transitionX(time);\n    if (typeof x == 'number') {\n      x = st.px(x);\n    }\n    if (!opt_transitionY) {\n      return `translate(${x})`;\n    }\n\n    let y = opt_transitionY(time);\n    if (typeof y == 'number') {\n      y = st.px(y);\n    }\n    return `translate(${x},${y})`;\n  };\n}\n\n\n/**\n * A transition for \"scale\" of CSS \"transform\" property.\n * @param {!TransitionDef<number|string>} transition\n * @return {!TransitionDef<string>}\n */\nexport function scale(transition) {\n  return time => {\n    return `scale(${transition(time)})`;\n  };\n}\n","/**\n * Copyright 2015 The AMP HTML Authors. All Rights Reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS-IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {assert} from './asserts';\n\n\n/**\n * Returns a Location-like object for the given URL. If it is relative,\n * the URL gets resolved.\n * @param {string} url\n * @return {!Location}\n */\nexport function parseUrl(url) {\n  const a = document.createElement('a');\n  a.href = url;\n  const info = {\n    href: a.href,\n    protocol: a.protocol,\n    host: a.host,\n    hostname: a.hostname,\n    port: a.port == '0' ? '' : a.port,\n    pathname: a.pathname,\n    search: a.search,\n    hash: a.hash\n  };\n  // For data URI a.origin is equal to the string 'null' which is not useful.\n  // We instead return the actual origin which is the full URL.\n  info.origin = (a.origin && a.origin != 'null') ? a.origin : getOrigin(info);\n  assert(info.origin, 'Origin must exist');\n  return info;\n}\n\n\n/**\n * Asserts that a given url is HTTPS or protocol relative.\n * Provides an exception for localhost.\n * @param {string} urlString\n * @param {!Element} elementContext Element where the url was found.\n * @return {string}\n */\nexport function assertHttpsUrl(urlString, elementContext) {\n  const url = parseUrl(urlString);\n  assert(\n      url.protocol == 'https:' || /^(\\/\\/)/.test(urlString) ||\n      url.hostname == 'localhost' ||\n          url.hostname.lastIndexOf('.localhost') ==\n          // Poor person's endsWith\n          url.hostname.length - '.localhost'.length,\n      '%s source must start with ' +\n      '\"https://\" or \"//\" or be relative and served from ' +\n      'either https or from localhost. Invalid value: %s',\n      elementContext, urlString);\n  return urlString;\n}\n\n\n/**\n * Parses the query string of an URL. This method returns a simple key/value\n * map. If there are duplicate keys the latest value is returned.\n * @param {string} queryString\n * @return {!Object<string, string>}\n */\nexport function parseQueryString(queryString) {\n  const params = Object.create(null);\n  if (!queryString) {\n    return params;\n  }\n  if (queryString.indexOf('?') == 0 || queryString.indexOf('#') == 0) {\n    queryString = queryString.substr(1);\n  }\n  const pairs = queryString.split('&');\n  for (let i = 0; i < pairs.length; i++) {\n    const pair = pairs[i];\n    const eqIndex = pair.indexOf('=');\n    let name;\n    let value;\n    if (eqIndex != -1) {\n      name = decodeURIComponent(pair.substring(0, eqIndex)).trim();\n      value = decodeURIComponent(pair.substring(eqIndex + 1)).trim();\n    } else {\n      name = decodeURIComponent(pair).trim();\n      value = '';\n    }\n    if (name) {\n      params[name] = value;\n    }\n  }\n  return params;\n}\n\n\n/**\n * Don't use this directly, only exported for testing. The value\n * is available via the origin property of the object returned by\n * parseUrl.\n * @param {!Location} info\n * @return {string}\n * @visibleForTesting\n */\nexport function getOrigin(info) {\n  if (info.protocol == 'data:' || !info.host) {\n    return info.href;\n  }\n  return info.protocol + '//' + info.host;\n}\n\n\n/**\n * Returns the URL without fragment. If URL doesn't contain fragment, the same\n * string is returned.\n * @param {string} url\n * @return {string}\n */\nexport function removeFragment(url) {\n  const index = url.indexOf('#');\n  if (index == -1) {\n    return url;\n  }\n  return url.substring(0, index);\n}\n","/**\n * Copyright 2015 The AMP HTML Authors. All Rights Reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS-IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {getService} from './service';\n\n\n/**\n * @param {!Window} window\n * @return {!Vsync}\n */\nexport function vsyncFor(window) {\n  return getService(window, 'vsync');\n};\n"]}